System.register(["./index-573a3f51.js","./index-afb0c019.js","./collision-matrix-f2760dca.js","./array-collision-matrix-9005c23d.js","./physics-framework.js","./deprecated-7d3dca77.js","./director-b74238a1.js","./util-ada7c9ac.js","./node-event-4f5034aa.js","./pipeline-state-manager-0224ea41.js","./buffer-barrier-65f53aec.js","./mesh-f309934f.js","./skeleton-e0385d21.js","./terrain-asset-e50afb9c.js","./base.js","./deprecated-8eb5eea0.js","./builtin-pipelines-d2876cc8.js","./deprecated-219c6f74.js","./camera-component-ae452a1f.js","./model-renderer-460ecd33.js","./renderer-6fa5ea92.js","./instantiate-0ba21f61.js","./touch-e635ba64.js","./move-65638bd1.js","./capsule-a7c0d711.js"],(function(e){"use strict";var t,i,o,n,r,s,a,l,d,h,c,u,f,p,y,g,_,w,v,B,S,b,m,C;return{setters:[function(o){t=o.P,i=o.s,e("CharacterControllerContact",o.q)},function(e){o=e.t,n=e.o,r=e.Q,s=e.bF,a=e.c7,l=e.bW,d=e.bC,h=e.c5,c=e.d,u=e.e,f=e.B,p=e.cV,y=e.c4,g=e.cW},function(e){_=e.P,w=e.c,v=e.E},function(e){B=e.A},function(){},function(e){S=e.g,b=e.G},function(e){m=e.aU},function(e){C=e.m},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var e=function(){function e(){this.collisionFilterGroup=t.PhysicsGroup.DEFAULT,this.collisionFilterMask=-1}var i=e.prototype;return i.getGroup=function(){return this.collisionFilterGroup},i.setGroup=function(e){this.collisionFilterGroup=e},i.addGroup=function(e){this.collisionFilterGroup|=e},i.removeGroup=function(e){this.collisionFilterGroup&=~e},i.getMask=function(){return this.collisionFilterMask},i.setMask=function(e){this.collisionFilterMask=e},i.addMask=function(e){this.collisionFilterMask|=e},i.removeMask=function(e){this.collisionFilterMask&=~e},e}(),k=new o,M=new n,x=new n,A=new r,G=function(e){function i(t,o){var n;return(n=e.call(this)||this)._id=void 0,n.index=-1,n.ref=0,n.node=void 0,n.world=void 0,n.shapes=[],n.wrappedBody=null,n._id=i.idCounter++,n.node=t,n.world=o,n}s(i,e),i.getSharedBody=function(e,o,n){var r,s=e.uuid;if(i.sharedBodesMap.has(s))r=i.sharedBodesMap.get(s);else{r=new i(e,o);var a=_.DEFAULT,l=t.instance.collisionMatrix[a];r.collisionFilterGroup=a,r.collisionFilterMask=l,i.sharedBodesMap.set(e.uuid,r)}if(n){r.wrappedBody=n;var d=n.rigidBody.group,h=t.instance.collisionMatrix[d];r.collisionFilterGroup=d,r.collisionFilterMask=h}return r};var o=i.prototype;return o.intersects=function(e){for(var t=0;t<this.shapes.length;t++)for(var i=this.shapes[t],o=0;o<e.shapes.length;o++){var n=e.shapes[o];(i.collider.needTriggerEvent||n.collider.needTriggerEvent)&&a.resolve(i.worldShape,n.worldShape)&&(this.world.shapeArr.push(i),this.world.shapeArr.push(n))}},o.addShape=function(e){this.shapes.indexOf(e)<0&&this.shapes.push(e)},o.removeShape=function(e){var t=this.shapes.indexOf(e);t>=0&&l(this.shapes,t)},o.syncSceneToPhysics=function(){if(this.node.hasChangedFlags){this.node.getWorldMatrix(k),M.set(this.node.worldPosition),A.set(this.node.worldRotation),x.set(this.node.worldScale);for(var e=0;e<this.shapes.length;e++)this.shapes[e].transform(k,M,A,x)}},o.syncInitial=function(){this.node.getWorldMatrix(k),M.set(this.node.worldPosition),A.set(this.node.worldRotation),x.set(this.node.worldScale);for(var e=0;e<this.shapes.length;e++)this.shapes[e].transform(k,M,A,x)},o.destroy=function(){i.sharedBodesMap.delete(this.node.uuid),this.node=null,this.world=null,this.shapes=null},d(i,[{key:"id",get:function(){return this._id}},{key:"enabled",set:function(e){e?this.index<0&&(this.index=this.world.bodies.length,this.world.addSharedBody(this),this.syncInitial()):this.index>=0&&0===this.shapes.length&&(this.index=-1,this.world.removeSharedBody(this))}},{key:"reference",set:function(e){e?this.ref++:this.ref--,0===this.ref&&this.destroy()}}]),i}(e);G.sharedBodesMap=new Map,G.idCounter=0;var F=new n,P={type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:{}},E=new h,D=function(){function e(){this.shapeArr=[],this.bodies=[],this._shapeArrPrev=[],this._collisionMatrix=new B,this._collisionMatrixPrev=new B,this._debugLineCount=0,this._MAX_DEBUG_LINE_COUNT=16384,this._debugDrawFlags=w.NONE,this._debugConstraintSize=.3,this._aabbColor=new f(0,255,255,255),this._wireframeColor=new f(255,0,255,255)}var t=e.prototype;return t.sweepBox=function(){return c(9640),!1},t.sweepBoxClosest=function(){return c(9640),!1},t.sweepSphere=function(){return c(9640),!1},t.sweepSphereClosest=function(){return c(9640),!1},t.sweepCapsule=function(){return c(9640),!1},t.sweepCapsuleClosest=function(){return c(9640),!1},t.setGravity=function(){},t.setAllowSleep=function(){},t.setDefaultMaterial=function(){},t.destroy=function(){this.bodies.length&&u("You should destroy all physics component first.")},t.step=function(){var e=this._shapeArrPrev;this._shapeArrPrev=this.shapeArr,this.shapeArr=e,this.shapeArr.length=0;for(var t=0;t<this.bodies.length;t++)for(var i=this.bodies[t],o=t+1;o<this.bodies.length;o++){var n=this.bodies[o];0!=(i.collisionFilterGroup&n.collisionFilterMask)&&0!=(n.collisionFilterGroup&i.collisionFilterMask)&&i.intersects(n)}this._debugDraw()},t.syncSceneToPhysics=function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].syncSceneToPhysics()},t.syncAfterEvents=function(){this.syncSceneToPhysics()},t.emitEvents=function(){this.emitTriggerEvent()},t.raycastClosest=function(e,t,i){for(var o=1/0,r=t.maxDistance,s=t.mask,l=0;l<this.bodies.length;l++){var d=this.bodies[l];if(d.collisionFilterGroup&s)for(var h=0;h<d.shapes.length;h++){var c=d.shapes[h],u=a.resolve(e,c.worldShape);0===u||u>r||o>u&&(o=u,n.normalize(F,e.d),n.scaleAndAdd(F,e.o,F,u),i._assign(F,u,c.collider,n.ZERO))}}return!(o===1/0)},t.raycast=function(e,t,i,o){for(var r=t.maxDistance,s=t.mask,l=0;l<this.bodies.length;l++){var d=this.bodies[l];if(d.collisionFilterGroup&s)for(var h=0;h<d.shapes.length;h++){var c=d.shapes[h],u=a.resolve(e,c.worldShape);if(!(0===u||u>r)){var f=i.add();e.computeHit(F,u),f._assign(F,u,c.collider,n.ZERO),o.push(f)}}}return o.length>0},t.getSharedBody=function(e,t){return G.getSharedBody(e,this,t)},t.addSharedBody=function(e){this.bodies.indexOf(e)<0&&this.bodies.push(e)},t.removeSharedBody=function(e){var t=this.bodies.indexOf(e);t>=0&&l(this.bodies,t)},t.emitTriggerEvent=function(){for(var e,t,i=0;i<this.shapeArr.length;i+=2)e=this.shapeArr[i],t=this.shapeArr[i+1],P.selfCollider=e.collider,P.otherCollider=t.collider,this._collisionMatrix.set(e.id,t.id,!0),this._collisionMatrixPrev.get(e.id,t.id)?P.type="onTriggerStay":P.type="onTriggerEnter",e.collider&&e.collider.emit(P.type,P),P.selfCollider=t.collider,P.otherCollider=e.collider,t.collider&&t.collider.emit(P.type,P);for(var o=0;o<this._shapeArrPrev.length;o+=2)e=this._shapeArrPrev[o],t=this._shapeArrPrev[o+1],this._collisionMatrixPrev.get(e.id,t.id)&&(this._collisionMatrix.get(e.id,t.id)||(P.type="onTriggerExit",P.selfCollider=e.collider,P.otherCollider=t.collider,e.collider&&e.collider.emit(P.type,P),P.selfCollider=t.collider,P.otherCollider=e.collider,t.collider&&t.collider.emit(P.type,P),this._collisionMatrix.set(e.id,t.id,!1)));var n=this._collisionMatrixPrev.matrix;this._collisionMatrixPrev.matrix=this._collisionMatrix.matrix,this._collisionMatrix.matrix=n,this._collisionMatrix.reset()},t._getDebugRenderer=function(){var e,t=null===(e=m.root.mainWindow)||void 0===e?void 0:e.cameras;return t?0===t.length?null:t[0]?(t[0].initGeometryRenderer(),t[0].geometryRenderer):null:null},t._debugDraw=function(){var e=this._getDebugRenderer();if(e&&(this._debugLineCount=0,this._debugDrawFlags&w.AABB))for(var t=0;t<this.bodies.length;t++)for(var i=this.bodies[t],o=0;o<i.shapes.length;o++){var n=i.shapes[o];this._debugLineCount+12<this._MAX_DEBUG_LINE_COUNT&&(this._debugLineCount+=12,n.getAABB(E),e.addBoundingBox(E,this._aabbColor))}},d(e,[{key:"impl",get:function(){return this}},{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(e){this._debugDrawFlags=e}},{key:"debugDrawConstraintSize",get:function(){return this._debugConstraintSize},set:function(e){this._debugConstraintSize=e}}]),e}(),j=function(){function e(){this._rigidBody=void 0,this._sharedBody=void 0}var i=e.prototype;return i.initialize=function(e){this._rigidBody=e,this._sharedBody=t.instance.physicsWorld.getSharedBody(this._rigidBody.node,this),this._sharedBody.reference=!0},i.onEnable=function(){this._sharedBody.enabled=!0},i.onDisable=function(){this._sharedBody.enabled=!1},i.onDestroy=function(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null},i.setMass=function(){},i.setType=function(){},i.setLinearDamping=function(){},i.setAngularDamping=function(){},i.useGravity=function(){},i.useCCD=function(){},i.isUsingCCD=function(){return!1},i.setLinearFactor=function(){},i.setAngularFactor=function(){},i.setAllowSleep=function(){},i.wakeUp=function(){},i.sleep=function(){},i.clearState=function(){},i.clearForces=function(){},i.clearVelocity=function(){},i.setSleepThreshold=function(){},i.getSleepThreshold=function(){return 0},i.getLinearVelocity=function(){},i.setLinearVelocity=function(){},i.getAngularVelocity=function(){},i.setAngularVelocity=function(){},i.applyForce=function(){},i.applyLocalForce=function(){},i.applyImpulse=function(){},i.applyLocalImpulse=function(){},i.applyTorque=function(){},i.applyLocalTorque=function(){},i.setGroup=function(e){this._sharedBody.setGroup(e)},i.getGroup=function(){return this._sharedBody.getGroup()},i.addGroup=function(e){this._sharedBody.addGroup(e)},i.removeGroup=function(e){this._sharedBody.removeGroup(e)},i.setMask=function(e){this._sharedBody.setMask(e)},i.getMask=function(){return this._sharedBody.getMask()},i.addMask=function(e){this._sharedBody.addMask(e)},i.removeMask=function(e){this._sharedBody.removeMask(e)},d(e,[{key:"impl",get:function(){return this}},{key:"isAwake",get:function(){return!0}},{key:"isSleepy",get:function(){return!1}},{key:"isSleeping",get:function(){return!1}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"sharedBody",get:function(){return this._sharedBody}}]),e}(),T=function(){function e(){this.id=e.idCounter++,this._sharedBody=void 0,this._collider=void 0,this._localShape=void 0,this._worldShape=void 0}var i=e.prototype;return i.getAABB=function(){},i.getBoundingSphere=function(){},i.updateEventListener=function(){},i.setMaterial=function(){},i.setAsTrigger=function(){},i.setCenter=function(e){n.copy(this._localShape.center,e)},i.initialize=function(e){this._collider=e,this._sharedBody=t.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0},i.onLoad=function(){this.setCenter(this._collider.center)},i.onEnable=function(){this._sharedBody.addShape(this),this._sharedBody.enabled=!0},i.onDisable=function(){this._sharedBody.removeShape(this),this._sharedBody.enabled=!1},i.onDestroy=function(){this._sharedBody.reference=!1,this._collider=null,this._localShape=null,this._worldShape=null},i.transform=function(e,t,i,o){this._localShape.transform(e,t,i,o,this._worldShape)},i.getGroup=function(){return this._sharedBody.getGroup()},i.setGroup=function(e){this._sharedBody.setGroup(e)},i.addGroup=function(e){this._sharedBody.addGroup(e)},i.removeGroup=function(e){this._sharedBody.removeGroup(e)},i.getMask=function(){return this._sharedBody.getMask()},i.setMask=function(e){this._sharedBody.setMask(e)},i.addMask=function(e){this._sharedBody.addMask(e)},i.removeMask=function(e){this._sharedBody.removeMask(e)},d(e,[{key:"attachedRigidBody",get:function(){return null}},{key:"localShape",get:function(){return this._localShape}},{key:"worldShape",get:function(){return this._worldShape}},{key:"impl",get:function(){return this._worldShape}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"collider",get:function(){return this._collider}}]),e}();T.idCounter=0;var L=new n,R=new n,O=function(e){function t(){var t;return(t=e.call(this)||this)._localShape=new p,t._worldShape=new p,t}s(t,e);var i=t.prototype;return i.updateSize=function(){n.multiplyScalar(this.localObb.halfExtents,this.collider.size,.5),n.multiply(this.worldObb.halfExtents,this.localObb.halfExtents,this.collider.node.worldScale)},i.onLoad=function(){e.prototype.onLoad.call(this),this.updateSize()},i.getAABB=function(e){this.worldObb.getBoundary(L,R),h.fromPoints(e,L,R)},d(t,[{key:"localObb",get:function(){return this._localShape}},{key:"worldObb",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),t}(T),z=new n,U=new n,I=function(e){s(i,e);var t=i.prototype;function i(t){var i;return void 0===t&&(t=.5),(i=e.call(this)||this)._localShape=new y(0,0,0,t),i._worldShape=new y(0,0,0,t),i}return t.updateRadius=function(){this.localSphere.radius=this.collider.radius;var e=C(this.collider.node.worldScale);this.worldSphere.radius=this.localSphere.radius*e},t.onLoad=function(){e.prototype.onLoad.call(this),this.updateRadius()},t.getAABB=function(e){this.worldSphere.getBoundary(z,U),h.fromPoints(e,z,U)},d(i,[{key:"localSphere",get:function(){return this._localShape}},{key:"worldSphere",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),i}(T),N=new n,W=new n,V=function(e){function t(t,i,o){var n;void 0===t&&(t=.5),void 0===i&&(i=2),void 0===o&&(o=v.Y_AXIS);var r=(i-2*t)/2,s=r<0?0:r;return(n=e.call(this)||this)._localShape=new g(t,s,o),n._worldShape=new g(t,s,o),n}s(t,e);var i=t.prototype;return i.setRadius=function(e){this.localCapsule.radius=e,this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},i.setCylinderHeight=function(e){this.localCapsule.halfHeight=e/2,this.localCapsule.updateCache(),this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},i.setDirection=function(e){this.localCapsule.axis=e,this.localCapsule.updateCache(),this.worldCapsule.axis=e,this.worldCapsule.updateCache(),this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},i.onLoad=function(){e.prototype.onLoad.call(this),this.setRadius(this.collider.radius),this.setDirection(this.collider.direction)},i.getAABB=function(e){e.center.set(this.worldCapsule.center),e.halfExtents.set(0,0,0),N.set(this.worldCapsule.radius,this.worldCapsule.radius,this.worldCapsule.radius),n.add(W,this.worldCapsule.ellipseCenter0,N),e.mergePoint(W),n.subtract(W,this.worldCapsule.ellipseCenter0,N),e.mergePoint(W),n.add(W,this.worldCapsule.ellipseCenter1,N),e.mergePoint(W),n.subtract(W,this.worldCapsule.ellipseCenter1,N),e.mergePoint(W)},d(t,[{key:"localCapsule",get:function(){return this._localShape}},{key:"worldCapsule",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),t}(T);S.once(b.EVENT_PRE_SUBSYSTEM_INIT,(function(){i.register("builtin",{RigidBody:j,BoxShape:O,SphereShape:I,PhysicsWorld:D,CapsuleShape:V})}))}}}));
