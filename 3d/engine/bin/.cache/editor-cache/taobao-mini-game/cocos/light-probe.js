System.register(["./index-afb0c019.js","./node-event-4f5034aa.js"],(function(t){"use strict";var e,r,s,i,n,o,h,a,u,c,v,x,p,d,f,b,y,l;return{setters:[function(t){e=t.ad,r=t.o,s=t.M,i=t.bI,n=t.F,o=t.bE,h=t.bj,a=t.q,u=t.bz,c=t.l,v=t.bX,x=t.bC,p=t.cu,d=t.bF,f=t.bH,b=t.aw},function(t){y=t.N,l=t.C}],execute:function(){var _,g,P,m,z,w,O,I,M,A,S,C,T,k,q,L,D,X,B,E,U,R,V,F,N,Z,Y,j,G,W,H,Q,J,K,$=t("PlaceMethod",e({UNIFORM:0,ADAPTIVE:1})),tt=t("AutoPlacement",function(){function t(){}return t.generate=function(t){switch(t.method){case $.UNIFORM:return this.doGenerateUniform(t);case $.ADAPTIVE:return this.doGenerateAdaptive(t);default:return[]}},t.doGenerateUniform=function(t){if(t.nProbesX<2||t.nProbesY<2||t.nProbesZ<2)return[];for(var e=[],s=new r(0,0,0),i=new r((t.maxPos.x-t.minPos.x)/(t.nProbesX-1),(t.maxPos.y-t.minPos.y)/(t.nProbesY-1),(t.maxPos.z-t.minPos.z)/(t.nProbesZ-1)),n=0;n<t.nProbesX;n++){s.x=n*i.x+t.minPos.x;for(var o=0;o<t.nProbesY;o++){s.y=o*i.y+t.minPos.y;for(var h=0;h<t.nProbesZ;h++)s.z=h*i.z+t.minPos.z,e.push(new r(s))}}return e},t.doGenerateAdaptive=function(t){return this.doGenerateUniform(t)},t}()),et=o,rt=h,st=new s,it=new r(0,0,0),nt=new r(0,0,0),ot=new r(0,0,0),ht=new r(0,0,0),at=new r(0,0,0),ut=new r(0,0,0),ct=new r(0,0,0),vt=t("Vertex",et("cc.Vertex")((g=function(t){this.position=P&&P(),this.normal=m&&m(),this.coefficients=z&&z(),this.position.set(t)},P=i(g.prototype,"position",[rt],(function(){return new r(0,0,0)})),m=i(g.prototype,"normal",[rt],(function(){return new r(0,0,0)})),z=i(g.prototype,"coefficients",[rt],(function(){return[]})),_=g))||_),xt=(w=function(){function t(t,e,r,s){this.tetrahedron=O&&O(),this.index=I&&I(),this.vertex0=M&&M(),this.vertex1=A&&A(),this.tetrahedron=t,this.index=e,r<s?(this.vertex0=r,this.vertex1=s):(this.vertex0=s,this.vertex1=r)}var e=t.prototype;return e.set=function(t,e,r,s){this.tetrahedron=t,this.index=e,r<s?(this.vertex0=r,this.vertex1=s):(this.vertex0=s,this.vertex1=r)},e.isSame=function(t){return this.vertex0===t.vertex0&&this.vertex1===t.vertex1},t}(),O=i(w.prototype,"tetrahedron",[rt],(function(){return-1})),I=i(w.prototype,"index",[rt],(function(){return-1})),M=i(w.prototype,"vertex0",[rt],(function(){return-1})),A=i(w.prototype,"vertex1",[rt],(function(){return-1})),w),pt=(S=function(){function t(t,e,r,s,i,n){this.invalid=C&&C(),this.isOuterFace=T&&T(),this.tetrahedron=k&&k(),this.index=q&&q(),this.vertex0=L&&L(),this.vertex1=D&&D(),this.vertex2=X&&X(),this.vertex3=B&&B(),this.tetrahedron=t,this.index=e,this.vertex3=n,r<s&&r<i?(this.vertex0=r,s<i?(this.vertex1=s,this.vertex2=i):(this.vertex1=i,this.vertex2=s)):s<r&&s<i?(this.vertex0=s,r<i?(this.vertex1=r,this.vertex2=i):(this.vertex1=i,this.vertex2=r)):(this.vertex0=i,r<s?(this.vertex1=r,this.vertex2=s):(this.vertex1=s,this.vertex2=r))}var e=t.prototype;return e.set=function(t,e,r,s,i,n){this.invalid=!1,this.isOuterFace=!0,this.tetrahedron=t,this.index=e,this.vertex3=n,r<s&&r<i?(this.vertex0=r,s<i?(this.vertex1=s,this.vertex2=i):(this.vertex1=i,this.vertex2=s)):s<r&&s<i?(this.vertex0=s,r<i?(this.vertex1=r,this.vertex2=i):(this.vertex1=i,this.vertex2=r)):(this.vertex0=i,r<s?(this.vertex1=r,this.vertex2=s):(this.vertex1=s,this.vertex2=r))},e.isSame=function(t){return this.vertex0===t.vertex0&&this.vertex1===t.vertex1&&this.vertex2===t.vertex2},t}(),C=i(S.prototype,"invalid",[rt],(function(){return!1})),T=i(S.prototype,"isOuterFace",[rt],(function(){return!0})),k=i(S.prototype,"tetrahedron",[rt],(function(){return-1})),q=i(S.prototype,"index",[rt],(function(){return-1})),L=i(S.prototype,"vertex0",[rt],(function(){return-1})),D=i(S.prototype,"vertex1",[rt],(function(){return-1})),X=i(S.prototype,"vertex2",[rt],(function(){return-1})),B=i(S.prototype,"vertex3",[rt],(function(){return-1})),S),dt=t("CircumSphere",et("cc.CircumSphere")((U=function(){function t(){this.center=R&&R(),this.radiusSquared=V&&V()}return t.prototype.init=function(t,e,s,i){st.set(e.x-t.x,e.y-t.y,e.z-t.z,s.x-t.x,s.y-t.y,s.z-t.z,i.x-t.x,i.y-t.y,i.z-t.z),st.invert(),st.transpose(),it.set(.5*((e.x+t.x)*(e.x-t.x)+(e.y+t.y)*(e.y-t.y)+(e.z+t.z)*(e.z-t.z)),.5*((s.x+t.x)*(s.x-t.x)+(s.y+t.y)*(s.y-t.y)+(s.z+t.z)*(s.z-t.z)),.5*((i.x+t.x)*(i.x-t.x)+(i.y+t.y)*(i.y-t.y)+(i.z+t.z)*(i.z-t.z))),r.transformMat3(this.center,it,st),this.radiusSquared=r.squaredDistance(t,this.center)},t}(),R=i(U.prototype,"center",[rt],(function(){return new r(0,0,0)})),V=i(U.prototype,"radiusSquared",[rt],(function(){return 0})),E=U))||E),ft=t("Tetrahedron",et("cc.Tetrahedron")((N=function(){function t(t,e,r,s,i){if(void 0===i&&(i=-1),this.invalid=Z&&Z(),this.vertex0=Y&&Y(),this.vertex1=j&&j(),this.vertex2=G&&G(),this.vertex3=W&&W(),this.neighbours=H&&H(),this.matrix=Q&&Q(),this.offset=J&&J(),this.sphere=K&&K(),this.vertex0=e,this.vertex1=r,this.vertex2=s,this.vertex3=i,i>=0){var n=t._probes,o=n[this.vertex0].position,h=n[this.vertex1].position,a=n[this.vertex2].position,u=n[this.vertex3].position;this.sphere.init(o,h,a,u)}}var e=t.prototype;return e.isInCircumSphere=function(t){return r.squaredDistance(t,this.sphere.center)<this.sphere.radiusSquared-n},e.contain=function(t){return this.vertex0===t||this.vertex1===t||this.vertex2===t||this.vertex3===t},e.isInnerTetrahedron=function(){return this.vertex3>=0},e.isOuterCell=function(){return this.vertex3<0},t}(),Z=i(N.prototype,"invalid",[rt],(function(){return!1})),Y=i(N.prototype,"vertex0",[rt],(function(){return-1})),j=i(N.prototype,"vertex1",[rt],(function(){return-1})),G=i(N.prototype,"vertex2",[rt],(function(){return-1})),W=i(N.prototype,"vertex3",[rt],(function(){return-1})),H=i(N.prototype,"neighbours",[rt],(function(){return[-1,-1,-1,-1]})),Q=i(N.prototype,"matrix",[rt],(function(){return new s})),J=i(N.prototype,"offset",[rt],(function(){return new r(0,0,0)})),K=i(N.prototype,"sphere",[rt],(function(){return new dt})),F=N))||F),bt=t("Delaunay",function(){function t(t){this._probes=[],this._tetrahedrons=[],this._triangles=[],this._edges=[],this._probes=t}var e=t.prototype;return e.build=function(){return this.reset(),this.tetrahedralize(),this.computeAdjacency(),this.computeMatrices(),this._tetrahedrons},e.reset=function(){this._tetrahedrons.length=0,this._triangles.length=0,this._edges.length=0},e.tetrahedralize=function(){for(var t=this._probes.length,e=this.initTetrahedron(),r=0;r<t;r++)this.addProbe(r);this._tetrahedrons=this._tetrahedrons.filter((function(e){var r=t;return!(e.contain(r)||e.contain(r+1)||e.contain(r+2)||e.contain(r+3))})),this._probes.length=t,this.reorder(e)},e.initTetrahedron=function(){for(var t=new r(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new r(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),s=0;s<this._probes.length;s++){var i=this._probes[s].position;t.x=Math.min(t.x,i.x),e.x=Math.max(e.x,i.x),t.y=Math.min(t.y,i.y),e.y=Math.max(e.y,i.y),t.z=Math.min(t.z,i.z),e.z=Math.max(e.z,i.z)}var n=new r(0,0,0);r.add(n,t,e),r.multiplyScalar(n,n,.5);var o=new r(0,0,0);r.subtract(o,e,t);var h=10*Math.max(o.x,o.y,o.z),a=new r(n.x,n.y+h,n.z),u=new r(n.x-h,n.y-h,n.z-h),c=new r(n.x-h,n.y-h,n.z+h),v=new r(n.x+h,n.y-h,n.z),x=this._probes.length;return this._probes.push(new vt(a)),this._probes.push(new vt(u)),this._probes.push(new vt(c)),this._probes.push(new vt(v)),this._tetrahedrons.push(new ft(this,x,x+1,x+2,x+3)),n},e.addTriangle=function(t,e,r,s,i,n,o){t<this._triangles.length?this._triangles[t].set(e,r,s,i,n,o):this._triangles.push(new pt(e,r,s,i,n,o))},e.addEdge=function(t,e,r,s,i){t<this._edges.length?this._edges[t].set(e,r,s,i):this._edges.push(new xt(e,r,s,i))},e.addProbe=function(t){for(var e=this._probes[t].position,r=0,s=0;s<this._tetrahedrons.length;s++){var i=this._tetrahedrons[s];i.isInCircumSphere(e)&&(i.invalid=!0,this.addTriangle(r,s,0,i.vertex1,i.vertex3,i.vertex2,i.vertex0),this.addTriangle(r+1,s,1,i.vertex0,i.vertex2,i.vertex3,i.vertex1),this.addTriangle(r+2,s,2,i.vertex0,i.vertex3,i.vertex1,i.vertex2),this.addTriangle(r+3,s,3,i.vertex0,i.vertex1,i.vertex2,i.vertex3),r+=4)}for(var n=0;n<r;n++)if(!this._triangles[n].invalid)for(var o=n+1;o<r;o++)if(this._triangles[n].isSame(this._triangles[o])){this._triangles[n].invalid=!0,this._triangles[o].invalid=!0;break}this._tetrahedrons=this._tetrahedrons.filter((function(t){return!t.invalid}));for(var h=0;h<r;h++){var a=this._triangles[h];a.invalid||this._tetrahedrons.push(new ft(this,a.vertex0,a.vertex1,a.vertex2,t))}},e.reorder=function(t){this._tetrahedrons.sort((function(e,s){return r.squaredDistance(e.sphere.center,t)-r.squaredDistance(s.sphere.center,t)}))},e.computeAdjacency=function(){for(var t=new r(0,0,0),e=new r(0,0,0),s=new r(0,0,0),i=new r(0,0,0),n=this._tetrahedrons.length,o=0,h=0;h<this._tetrahedrons.length;h++){var a=this._tetrahedrons[h];this.addTriangle(o,h,0,a.vertex1,a.vertex3,a.vertex2,a.vertex0),this.addTriangle(o+1,h,1,a.vertex0,a.vertex2,a.vertex3,a.vertex1),this.addTriangle(o+2,h,2,a.vertex0,a.vertex3,a.vertex1,a.vertex2),this.addTriangle(o+3,h,3,a.vertex0,a.vertex1,a.vertex2,a.vertex3),o+=4}for(var u=0;u<o;u++)if(this._triangles[u].isOuterFace){for(var c=u+1;c<o;c++)if(this._triangles[u].isSame(this._triangles[c])){this._tetrahedrons[this._triangles[u].tetrahedron].neighbours[this._triangles[u].index]=this._triangles[c].tetrahedron,this._tetrahedrons[this._triangles[c].tetrahedron].neighbours[this._triangles[c].index]=this._triangles[u].tetrahedron,this._triangles[u].isOuterFace=!1,this._triangles[c].isOuterFace=!1;break}if(this._triangles[u].isOuterFace){var v=this._probes[this._triangles[u].vertex0],x=this._probes[this._triangles[u].vertex1],p=this._probes[this._triangles[u].vertex2],d=this._probes[this._triangles[u].vertex3];r.subtract(e,x.position,v.position),r.subtract(s,p.position,v.position),r.cross(t,e,s),r.subtract(i,d.position,v.position);var f=r.dot(t,i);f>0&&r.negate(t,t),r.add(v.normal,v.normal,t),r.add(x.normal,x.normal,t),r.add(p.normal,p.normal,t);var b=this._triangles[u].vertex0,y=f>0?this._triangles[u].vertex2:this._triangles[u].vertex1,l=f>0?this._triangles[u].vertex1:this._triangles[u].vertex2,_=new ft(this,b,y,l);_.neighbours[3]=this._triangles[u].tetrahedron,this._tetrahedrons[this._triangles[u].tetrahedron].neighbours[this._triangles[u].index]=this._tetrahedrons.length,this._tetrahedrons.push(_)}}for(var g=0,P=n;P<this._tetrahedrons.length;P++){var m=this._tetrahedrons[P];this.addEdge(g,P,0,m.vertex1,m.vertex2),this.addEdge(g+1,P,1,m.vertex2,m.vertex0),this.addEdge(g+2,P,2,m.vertex0,m.vertex1),g+=3}for(var z=0;z<g;z++)for(var w=z+1;w<g;w++)this._edges[z].isSame(this._edges[w])&&(this._tetrahedrons[this._edges[z].tetrahedron].neighbours[this._edges[z].index]=this._edges[w].tetrahedron,this._tetrahedrons[this._edges[w].tetrahedron].neighbours[this._edges[w].index]=this._edges[z].tetrahedron);for(var O=0;O<this._probes.length;O++)this._probes[O].normal.normalize()},e.computeMatrices=function(){for(var t=0;t<this._tetrahedrons.length;t++){var e=this._tetrahedrons[t];e.vertex3>=0?this.computeTetrahedronMatrix(e):this.computeOuterCellMatrix(e)}},e.computeTetrahedronMatrix=function(t){var e=this._probes[t.vertex0].position,r=this._probes[t.vertex1].position,s=this._probes[t.vertex2].position,i=this._probes[t.vertex3].position;t.matrix.set(e.x-i.x,r.x-i.x,s.x-i.x,e.y-i.y,r.y-i.y,s.y-i.y,e.z-i.z,r.z-i.z,s.z-i.z),t.matrix.invert(),t.matrix.transpose()},e.computeOuterCellMatrix=function(t){var e=[],s=[];e[0]=this._probes[t.vertex0].normal,e[1]=this._probes[t.vertex1].normal,e[2]=this._probes[t.vertex2].normal,s[0]=this._probes[t.vertex0].position,s[1]=this._probes[t.vertex1].position,s[2]=this._probes[t.vertex2].position,r.subtract(nt,s[0],s[2]),r.subtract(ot,e[0],e[2]),r.subtract(ht,s[1],s[2]),r.subtract(at,e[1],e[2]),ut.set(s[2]),r.negate(ct,e[2]);var i=[];i[0]=ot.y*at.z-ot.z*at.y,i[3]=-ot.x*at.z+ot.z*at.x,i[6]=ot.x*at.y-ot.y*at.x,i[9]=nt.x*at.y*ct.z-nt.y*at.x*ct.z+ot.x*ht.y*ct.z-ot.y*ht.x*ct.z+nt.z*at.x*ct.y-nt.z*at.y*ct.x+ot.z*ht.x*ct.y-ot.z*ht.y*ct.x-nt.x*at.z*ct.y+nt.y*at.z*ct.x-ot.x*ht.z*ct.y+ot.y*ht.z*ct.x,i[9]-=ut.x*i[0]+ut.y*i[3]+ut.z*i[6],i[1]=ot.y*ht.z+nt.y*at.z-ot.z*ht.y-nt.z*at.y,i[4]=-nt.x*at.z-ot.x*ht.z+nt.z*at.x+ot.z*ht.x,i[7]=nt.x*at.y-nt.y*at.x+ot.x*ht.y-ot.y*ht.x,i[10]=nt.x*ht.y*ct.z-nt.y*ht.x*ct.z-nt.x*ht.z*ct.y+nt.y*ht.z*ct.x+nt.z*ht.x*ct.y-nt.z*ht.y*ct.x,i[10]-=ut.x*i[1]+ut.y*i[4]+ut.z*i[7],i[2]=-nt.z*ht.y+nt.y*ht.z,i[5]=-nt.x*ht.z+nt.z*ht.x,i[8]=nt.x*ht.y-nt.y*ht.x,i[11]=0,i[11]-=ut.x*i[2]+ut.y*i[5]+ut.z*i[8];var o=ot.x*at.y*ct.z-ot.y*at.x*ct.z+ot.z*at.x*ct.y-ot.z*at.y*ct.x+ot.y*at.z*ct.x-ot.x*at.z*ct.y;if(Math.abs(o)>n)for(var h=0;h<12;h++)i[h]/=o;else t.vertex3=-2;t.matrix.set(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8]),t.offset.set(i[9],i[10],i[11])},t}()),yt=t("LightProbeSampler",function(){function t(){}return t.uniformSampleSphere=function(t,e){var s=1-2*t,i=Math.sqrt(Math.max(0,1-s*s)),n=2*Math.PI*e,o=i*Math.cos(n),h=i*Math.sin(n);return new r(o,h,s)},t.uniformSampleSphereAll=function(t){for(var e=Math.floor(Math.sqrt(t)),r=e,s=[],i=1/e,n=1/r,o=0;o<e;o++)for(var h=(o+.5)*i,a=0;a<r;a++){var u=(a+.5)*n,c=this.uniformSampleSphere(h,u);s.push(c)}return s},t.uniformSpherePdf=function(){return 1/(4*Math.PI)},t}()),lt=t("SH",function(){function t(){}return t.updateUBOData=function(t,e,r){t[e++]=r[3].x*this.basisOverPI[3],t[e++]=r[1].x*this.basisOverPI[1],t[e++]=r[2].x*this.basisOverPI[2],t[e++]=r[0].x*this.basisOverPI[0]-r[6].x*this.basisOverPI[6]/3,t[e++]=r[3].y*this.basisOverPI[3],t[e++]=r[1].y*this.basisOverPI[1],t[e++]=r[2].y*this.basisOverPI[2],t[e++]=r[0].y*this.basisOverPI[0]-r[6].y*this.basisOverPI[6]/3,t[e++]=r[3].z*this.basisOverPI[3],t[e++]=r[1].z*this.basisOverPI[1],t[e++]=r[2].z*this.basisOverPI[2],t[e++]=r[0].z*this.basisOverPI[0]-r[6].z*this.basisOverPI[6]/3,t[e++]=r[4].x*this.basisOverPI[4],t[e++]=r[5].x*this.basisOverPI[5],t[e++]=r[6].x*this.basisOverPI[6],t[e++]=r[7].x*this.basisOverPI[7],t[e++]=r[4].y*this.basisOverPI[4],t[e++]=r[5].y*this.basisOverPI[5],t[e++]=r[6].y*this.basisOverPI[6],t[e++]=r[7].y*this.basisOverPI[7],t[e++]=r[4].z*this.basisOverPI[4],t[e++]=r[5].z*this.basisOverPI[5],t[e++]=r[6].z*this.basisOverPI[6],t[e++]=r[7].z*this.basisOverPI[7],t[e++]=r[8].x*this.basisOverPI[8],t[e++]=r[8].y*this.basisOverPI[8],t[e++]=r[8].z*this.basisOverPI[8],t[e++]=0},t.shaderEvaluate=function(t,e){var s=new a(e[3].x*this.basisOverPI[3],e[1].x*this.basisOverPI[1],e[2].x*this.basisOverPI[2],e[0].x*this.basisOverPI[0]-e[6].x*this.basisOverPI[6]/3),i=new a(e[3].y*this.basisOverPI[3],e[1].y*this.basisOverPI[1],e[2].y*this.basisOverPI[2],e[0].y*this.basisOverPI[0]-e[6].y*this.basisOverPI[6]/3),n=new a(e[3].z*this.basisOverPI[3],e[1].z*this.basisOverPI[1],e[2].z*this.basisOverPI[2],e[0].z*this.basisOverPI[0]-e[6].z*this.basisOverPI[6]/3),o=new a(e[4].x*this.basisOverPI[4],e[5].x*this.basisOverPI[5],e[6].x*this.basisOverPI[6],e[7].x*this.basisOverPI[7]),h=new a(e[4].y*this.basisOverPI[4],e[5].y*this.basisOverPI[5],e[6].y*this.basisOverPI[6],e[7].y*this.basisOverPI[7]),u=new a(e[4].z*this.basisOverPI[4],e[5].z*this.basisOverPI[5],e[6].z*this.basisOverPI[6],e[7].z*this.basisOverPI[7]),c=new r(e[8].x*this.basisOverPI[8],e[8].y*this.basisOverPI[8],e[8].z*this.basisOverPI[8]),v=new r(0,0,0),x=new a(t.x,t.y,t.z,1);v.x=a.dot(s,x),v.y=a.dot(i,x),v.z=a.dot(n,x);var p=new a(t.x*t.y,t.y*t.z,t.z*t.z,t.z*t.x),d=t.x*t.x-t.y*t.y;return v.x+=a.dot(o,p),v.y+=a.dot(h,p),v.z+=a.dot(u,p),r.scaleAndAdd(v,v,c,d),v},t.evaluate=function(t,e){for(var s=new r(0,0,0),i=e.length,n=0;n<i;n++){var o=e[n];r.scaleAndAdd(s,s,o,this.evaluateBasis(n,t))}return s},t.project=function(t,e){u(t.length>0&&t.length===e.length);for(var s=this.getBasisCount(),i=t.length,n=1/(yt.uniformSpherePdf()*i),o=[],h=0;h<s;h++){for(var a=new r(0,0,0),c=0;c<i;c++)r.scaleAndAdd(a,a,e[c],this.evaluateBasis(h,t[c]));r.multiplyScalar(a,a,n),o.push(a)}return o},t.convolveCosine=function(t){for(var e=[.8862268925,1.0233267546,.495415926],s=[],i=0;i<=this.LMAX;i++)for(var n=-i;n<=i;n++){var o=this.toIndex(i,n),h=new r(0,0,0);r.multiplyScalar(h,t[o],this.lambda(i)*e[i]),s.push(h)}return s},t.getBasisCount=function(){return 9},t.evaluateBasis=function(t,e){return u(t<this.getBasisCount()),(0,this.basisFunctions[t])(e)},t.reduceRinging=function(t,e){if(0!==e)for(var s=0;s<=this.LMAX;++s)for(var i=1/(1+e*s*s*(s+1)*(s+1)),n=-s;n<=s;++n){var o=this.toIndex(s,n);r.multiplyScalar(t[o],t[o],i)}},t.lambda=function(t){return Math.sqrt(4*Math.PI/(2*t+1))},t.toIndex=function(t,e){return t*t+t+e},t}());lt.LMAX=2,lt.basisFunctions=[function(){return.282095},function(t){return.488603*t.y},function(t){return.488603*t.z},function(t){return.488603*t.x},function(t){return 1.09255*t.y*t.x},function(t){return 1.09255*t.y*t.z},function(t){return.946175*(t.z*t.z-1/3)},function(t){return 1.09255*t.z*t.x},function(t){return.546274*(t.x*t.x-t.y*t.y)}],lt.basisOverPI=[.0897936,.155527,.155527,.155527,.347769,.347769,.301177,.347769,.173884],c.internal.SH=lt;var _t,gt,Pt,mt,zt,wt,Ot,It=function(){function t(){}return t.getQuadraticUniqueRoot=function(t,e,r){return 0!==t?-e/(2*t):0!==e?-r/e:0},t.getCubicUniqueRoot=function(t,e,r){var s=[],i=-t/3,n=e/3-t*t/9,o=r/2+t*t*t/27-t*e/6,h=n*n*n+o*o;if(h>0){var a=Math.sqrt(h);s.push(Math.cbrt(-o+a)+Math.cbrt(-o-a))}else if(h<0){var u=Math.acos(-o*Math.sqrt(-n)/(n*n))/3;s.push(2*Math.sqrt(-n)*Math.cos(u)),s.push(2*Math.sqrt(-n)*Math.cos(u+2*Math.PI/3)),s.push(2*Math.sqrt(-n)*Math.cos(u+4*Math.PI/3))}else if(0===o)s.push(0);else{var c=Math.cbrt(o);s.push(c),s.push(-2*c)}for(var v=0;v<s.length;v++)if(s[v]+i>=0)return s[v]+i;return 0},t}(),Mt=new r(0,0,0),At=new r(0,0,0),St=new r(0,0,0),Ct=new r(0,0,0),Tt=new r(0,0,0),kt=new r(0,0,0),qt=new r(0,0,0),Lt=new r(0,0,0),Dt=new r(0,0,0),Xt=new r(0,0,0),Bt=new r(0,0,0),Et=new r(0,0,0),Ut=new r(0,0,0),Rt=new r(0,0,0),Vt=new r(0,0,0),Ft=t("LightProbesData",(_t=o("cc.LightProbesData"),gt=v([vt]),Pt=v([ft]),_t((zt=function(){function t(){this._probes=wt&&wt(),this._tetrahedrons=Ot&&Ot()}var e=t.prototype;return e.empty=function(){return 0===this._probes.length||0===this._tetrahedrons.length},e.reset=function(){this._probes.length=0,this._tetrahedrons.length=0},e.updateProbes=function(t){this._probes.length=t.length;for(var e=this._probes.length,s=0;s<e;s++){var i=this._probes[s];if(i)i.position.set(t[s]);else{i=new vt(t[s]);for(var n=0;n<lt.getBasisCount();n++)i.coefficients[n]=r.ZERO;this._probes[s]=i}}},e.updateTetrahedrons=function(){var t=new bt(this._probes);this._tetrahedrons=t.build()},e.getInterpolationSHCoefficients=function(t,e,s){if(!this.hasCoefficients())return!1;var i=lt.getBasisCount(),n=this._tetrahedrons[t],o=this._probes[n.vertex0].coefficients,h=this._probes[n.vertex1].coefficients,a=this._probes[n.vertex2].coefficients;if(n.vertex3>=0)for(var u=this._probes[n.vertex3].coefficients,c=0;c<i;c++)s[c]=new r(0,0,0),r.scaleAndAdd(s[c],s[c],o[c],e.x),r.scaleAndAdd(s[c],s[c],h[c],e.y),r.scaleAndAdd(s[c],s[c],a[c],e.z),r.scaleAndAdd(s[c],s[c],u[c],e.w);else for(var v=0;v<i;v++)s[v]=new r(0,0,0),r.scaleAndAdd(s[v],s[v],o[v],e.x),r.scaleAndAdd(s[v],s[v],h[v],e.y),r.scaleAndAdd(s[v],s[v],a[v],e.z);return!0},e.getInterpolationWeights=function(t,e,r){var s=this._tetrahedrons.length;(e<0||e>=s)&&(e=0);for(var i=-1,n=-1,o=0;o<s;o++){var h=this._tetrahedrons[e];if(this.getBarycentricCoord(t,h,r),r.x>=0&&r.y>=0&&r.z>=0&&r.w>=0)break;if(i===(n=r.x<r.y&&r.x<r.z&&r.x<r.w?h.neighbours[0]:r.y<r.z&&r.y<r.w?h.neighbours[1]:r.z<r.w?h.neighbours[2]:h.neighbours[3]))break;i=e,e=n}return e},e.hasCoefficients=function(){return!this.empty()&&0!==this._probes[0].coefficients.length},t.getTriangleBarycentricCoord=function(t,e,s,i){if(r.subtract(Mt,e,t),r.subtract(At,s,t),r.cross(St,Mt,At),St.lengthSqr()<=n)return new r(0,0,0);var o=St.clone();o.normalize();var h=1/o.dot(St);r.subtract(Ct,t,i),r.subtract(Tt,e,i),r.subtract(kt,s,i),r.cross(qt,Tt,kt);var a=o.dot(qt)*h;r.cross(Lt,kt,Ct);var u=o.dot(Lt)*h;return new r(a,u,1-a-u)},e.getBarycentricCoord=function(t,e,r){e.vertex3>=0?this.getTetrahedronBarycentricCoord(t,e,r):this.getOuterCellBarycentricCoord(t,e,r)},e.getTetrahedronBarycentricCoord=function(t,e,s){var i=new r(0,0,0);r.subtract(i,t,this._probes[e.vertex3].position),r.transformMat3(i,i,e.matrix),s.set(i.x,i.y,i.z,1-i.x-i.y-i.z)},e.getOuterCellBarycentricCoord=function(e,s,i){var n=this._probes[s.vertex0].position,o=this._probes[s.vertex1].position,h=this._probes[s.vertex2].position;r.subtract(Xt,o,n),r.subtract(Bt,h,n),r.cross(Dt,Xt,Bt),r.subtract(Et,e,n);var a=r.dot(Et,Dt);if(a<0)i.set(0,0,0,-1);else{var u=new r(0,0,0);r.transformMat3(u,e,s.matrix),r.add(u,u,s.offset),a=-1===s.vertex3?It.getCubicUniqueRoot(u.x,u.y,u.z):It.getQuadraticUniqueRoot(u.x,u.y,u.z),r.scaleAndAdd(Ut,n,this._probes[s.vertex0].normal,a),r.scaleAndAdd(Rt,o,this._probes[s.vertex1].normal,a),r.scaleAndAdd(Vt,h,this._probes[s.vertex2].normal,a);var c=t.getTriangleBarycentricCoord(Ut,Rt,Vt,e);i.set(c.x,c.y,c.z,0)}},x(t,[{key:"probes",get:function(){return this._probes}},{key:"tetrahedrons",get:function(){return this._tetrahedrons}}]),t}(),wt=i(zt.prototype,"_probes",[h,gt],(function(){return[]})),Ot=i(zt.prototype,"_tetrahedrons",[h,Pt],(function(){return[]})),mt=zt))||mt));c.internal.LightProbesData=Ft;var Nt,Zt,Yt,jt,Gt,Wt,Ht,Qt,Jt,Kt,$t,te,ee,re,se,ie=t("LightProbes",function(){function t(){this._giScale=1,this._giSamples=1024,this._bounces=2,this._reduceRinging=0,this._showProbe=!0,this._showWireframe=!0,this._showConvex=!1,this._data=null,this._lightProbeSphereVolume=1}var e=t.prototype;return e.initialize=function(t){this._giScale=t.giScale,this._giSamples=t.giSamples,this._bounces=t.bounces,this._reduceRinging=t.reduceRinging,this._showProbe=t.showProbe,this._showWireframe=t.showWireframe,this._showConvex=t.showConvex,this._data=t.data,this._lightProbeSphereVolume=t.lightProbeSphereVolume},e.empty=function(){return!this._data||this._data.empty()},x(t,[{key:"giScale",get:function(){return this._giScale},set:function(t){this._giScale=t}},{key:"giSamples",get:function(){return this._giSamples},set:function(t){this._giSamples=t}},{key:"bounces",get:function(){return this._bounces},set:function(t){this._bounces=t}},{key:"reduceRinging",get:function(){return this._reduceRinging},set:function(t){this._reduceRinging=t}},{key:"showProbe",get:function(){return this._showProbe},set:function(t){this._showProbe=t}},{key:"showWireframe",get:function(){return this._showWireframe},set:function(t){this._showWireframe=t}},{key:"showConvex",get:function(){return this._showConvex},set:function(t){this._showConvex=t}},{key:"data",get:function(){return this._data},set:function(t){this._data=t}},{key:"lightProbeSphereVolume",get:function(){return this._lightProbeSphereVolume},set:function(t){this._lightProbeSphereVolume=t}}]),t}());c.internal.LightProbes=ie,t("LightProbeGroup",(Nt=o("cc.LightProbeGroup"),Zt=v([r]),Yt=v($),jt=v(b),Gt=v(b),Wt=v(b),Nt(Ht=p((Qt=function(t){function e(){for(var e,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))||this)._probes=Jt&&Jt(),e._method=Kt&&Kt(),e._minPos=$t&&$t(),e._maxPos=te&&te(),e._nProbesX=ee&&ee(),e._nProbesY=re&&re(),e._nProbesZ=se&&se(),e}d(e,t);var r=e.prototype;return r.onLoad=function(){},r.onEnable=function(){},r.onDisable=function(){},r.generateLightProbes=function(){this.node&&(this._probes=tt.generate({method:this._method,nProbesX:this._nProbesX,nProbesY:this._nProbesY,nProbesZ:this._nProbesZ,minPos:this._minPos,maxPos:this._maxPos}),this.onProbeChanged())},r.onProbeChanged=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this.node.scene.globals.lightProbeInfo.syncData(this.node,this.probes),this.node.scene.globals.lightProbeInfo.update(t),e&&this.node.emit(y.LIGHT_PROBE_CHANGED)},x(e,[{key:"probes",get:function(){return this._probes},set:function(t){this._probes=t}},{key:"method",get:function(){return this._method}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t}},{key:"nProbesX",get:function(){return this._nProbesX},set:function(t){this._nProbesX=t}},{key:"nProbesY",get:function(){return this._nProbesY},set:function(t){this._nProbesY=t}},{key:"nProbesZ",get:function(){return this._nProbesZ},set:function(t){this._nProbesZ=t}}]),e}(l),Jt=i(Qt.prototype,"_probes",[h],(function(){return[]})),Kt=i(Qt.prototype,"_method",[h],(function(){return $.UNIFORM})),$t=i(Qt.prototype,"_minPos",[h],(function(){return new r(-5,-5,-5)})),te=i(Qt.prototype,"_maxPos",[h],(function(){return new r(5,5,5)})),ee=i(Qt.prototype,"_nProbesX",[h],(function(){return 3})),re=i(Qt.prototype,"_nProbesY",[h],(function(){return 3})),se=i(Qt.prototype,"_nProbesZ",[h],(function(){return 3})),f(Qt.prototype,"probes",[Zt],Object.getOwnPropertyDescriptor(Qt.prototype,"probes"),Qt.prototype),f(Qt.prototype,"method",[Yt],Object.getOwnPropertyDescriptor(Qt.prototype,"method"),Qt.prototype),f(Qt.prototype,"nProbesX",[jt],Object.getOwnPropertyDescriptor(Qt.prototype,"nProbesX"),Qt.prototype),f(Qt.prototype,"nProbesY",[Gt],Object.getOwnPropertyDescriptor(Qt.prototype,"nProbesY"),Qt.prototype),f(Qt.prototype,"nProbesZ",[Wt],Object.getOwnPropertyDescriptor(Qt.prototype,"nProbesZ"),Qt.prototype),Ht=Qt))||Ht)||Ht))}}}));
