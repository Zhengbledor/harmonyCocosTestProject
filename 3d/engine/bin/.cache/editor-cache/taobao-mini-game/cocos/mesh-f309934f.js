System.register(["./index-afb0c019.js","./node-event-4f5034aa.js","./director-b74238a1.js","./pipeline-state-manager-0224ea41.js","./buffer-barrier-65f53aec.js","./deprecated-7d3dca77.js"],(function(t){"use strict";var e,r,i,n,s,a,u,o,h,f,c,d,l,v,b,p,g,m,y,_,w,A,x,T,E,U,I,B,M,k,P,R,N,S,O,V,D,F,C,L,z,G;return{setters:[function(t){e=t.bC,r=t.bz,i=t.l,n=t.i,s=t.w,a=t.a1,u=t.cp,o=t.by,h=t.o,f=t.bE,c=t.bF,d=t.d,l=t.c0,v=t.c5,b=t.Q,p=t.bI,g=t.aP,m=t.bj,y=t.f,_=t.a9},function(t){w=t.A},function(t){A=t.b1,x=t.b0,T=t.aY},function(t){E=t.Q,U=t.T,I=t.V,B=t.W,M=t.d},function(t){k=t.aP,P=t.a9,R=t.d,N=t.f,S=t.b,O=t.j,V=t.aq,D=t.ab,F=t.F,C=t.aQ,L=t.aZ,z=t.c,G=t.bk},function(){}],execute:function(){t({d:bt,i:pt});var H=t("B",function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var r=t-e;this._arrayBufferOrPaddings.push(r),this._length+=r}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(r){"number"==typeof r?e+=r:(t.set(new Uint8Array(r),e),e+=r.byteLength)})),t.buffer},t}()),j=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var r=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(r).fill(null);for(var i=0;i<r;++i){var n=this._mesh.struct.morph.subMeshMorphs[i];n&&(n.targets.length>E.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[i]=new W(this._mesh,i,this._mesh.struct.morph,e):this._subMeshRenderings[i]=new X(this._mesh,i,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,r=new Array(e),i=0;i<e;++i){var n,s;r[i]=null!==(n=null===(s=this._subMeshRenderings[i])||void 0===s?void 0:s.createInstance())&&void 0!==n?n:null}return{setWeights:function(t,e){var i;null===(i=r[t])||void 0===i||i.setWeights(e)},requiredPatches:function(e){o(t._mesh.struct.morph);var i=t._mesh.struct.morph.subMeshMorphs[e],n=r[e];if(null===n)return null;var s=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:i.targets.length}];return i.attributes.includes(k.ATTR_POSITION)&&s.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),i.attributes.includes(k.ATTR_NORMAL)&&s.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),i.attributes.includes(k.ATTR_TANGENT)&&s.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),s.push.apply(s,n.requiredPatches()),s},adaptPipelineState:function(t,e){var i;null===(i=r[t])||void 0===i||i.adaptPipelineState(e)},destroy:function(){for(var t=0,e=r;t<e.length;t++){var i=e[t];null==i||i.destroy()}}}},t}(),X=function(){function t(t,e,r,i){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=i;var n=r.subMeshMorphs[e];this._subMeshMorph=n,Q(t,e,i);var s=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=s;var a=n.targets.length,u=J(i,s*a);this._textureInfo={width:u.width,height:u.height},this._attributes=n.attributes.map((function(e,r){var i=u.create(),a=i.valueView;return n.targets.forEach((function(e,i){for(var n=e.displacements[r],u=new Float32Array(t.data.buffer,t.data.byteOffset+n.offset,n.count),o=s*i*4,h=0;h<s;++h)a[o+4*h+0]=u[3*h+0],a[o+4*h+1]=u[3*h+1],a[o+4*h+2]=u[3*h+2]})),i.updatePixels(),{name:e,morphTexture:i}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=n(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new q(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(r){for(var i,a=n(t._attributes);!(i=a()).done;){var u=i.value,o=void 0;switch(u.name){case k.ATTR_POSITION:o=B;break;case k.ATTR_NORMAL:o=I;break;case k.ATTR_TANGENT:o=U;break;default:s("Unexpected attribute!")}void 0!==o&&(r.bindSampler(o,u.morphTexture.sampler),r.bindTexture(o,u.morphTexture.texture))}r.bindBuffer(E.BINDING,e.buffer),r.update()},destroy:function(){}}},t}(),W=function(){function t(t,e,r,i){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=i;var n=r.subMeshMorphs[e];Q(t,e,i),this._attributes=n.attributes.map((function(e,r){return{name:e,targets:n.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[r].offset,e.displacements[r].count)}}))}}))}return t.prototype.createInstance=function(){return new Z(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},e(t,[{key:"data",get:function(){return this._attributes}}]),t}(),Z=function(){function t(t,e,r){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new q(r,0);var i=J(r,e);this._morphUniforms.setMorphTextureInfo(i.width,i.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=i.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var i=this._attributes[e],n=i.morphTexture.valueView,s=this._owner.data[e];r(t.length===s.targets.length);for(var a=0;a<s.targets.length;++a){var u=s.targets[a].displacements,o=t[a],h=u.length/3;if(0===a)for(var f=0;f<h;++f)n[4*f+0]=u[3*f+0]*o,n[4*f+1]=u[3*f+1]*o,n[4*f+2]=u[3*f+2]*o;else if(0!==o)for(var c=0;c<h;++c)n[4*c+0]+=u[3*c+0]*o,n[4*c+1]+=u[3*c+1]*o,n[4*c+2]+=u[3*c+2]*o}i.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,r=n(this._attributes);!(e=r()).done;){var i=e.value,a=void 0;switch(i.attributeName){case k.ATTR_POSITION:a=B;break;case k.ATTR_NORMAL:a=I;break;case k.ATTR_TANGENT:a=U;break;default:s("Unexpected attribute!")}void 0!==a&&(t.bindSampler(a,i.morphTexture.sampler),t.bindTexture(a,i.morphTexture.texture))}t.bindBuffer(E.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),q=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(E.SIZE)),this._remoteBuffer=t.createBuffer(new P(R.UNIFORM|R.TRANSFER_DST,N.HOST|N.DEVICE,E.SIZE,E.SIZE))}var n=t.prototype;return n.destroy=function(){this._remoteBuffer.destroy()},n.setWeights=function(t){r(t.length===this._targetCount);for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(E.OFFSET_OF_WEIGHTS+4*e,t[e],i.sys.isLittleEndian)},n.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(E.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,i.sys.isLittleEndian),this._localBuffer.setFloat32(E.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,i.sys.isLittleEndian)},n.setVerticesCount=function(t){this._localBuffer.setFloat32(E.OFFSET_OF_VERTICES_COUNT,t,i.sys.isLittleEndian)},n.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},e(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function J(t,e){var r,i,n,o;t.getFormatFeatures(S.RGBA32F)&O.SAMPLED_TEXTURE?(r=e,n=16,i=A.PixelFormat.RGBA32F,o=Float32Array):(r=4*e,n=4,i=A.PixelFormat.RGBA8888,o=Uint8Array);var h=function(t){t<5&&(t=5);var e=a(t),r=u(e),i=r>>1;return{width:1<<(1&r?i+1:i),height:1<<i}}(r),f=h.width,c=h.height;return{width:f,height:c,create:function(){var e=new ArrayBuffer(f*c*n),r=new Float32Array(e),a=o===Float32Array?r:new o(e),u=new x({width:f,height:c,_data:a,_compressed:!1,format:i}),h=new A;h.setFilters(A.Filter.NEAREST,A.Filter.NEAREST),h.setMipFilter(A.Filter.NONE),h.setWrapMode(A.WrapMode.CLAMP_TO_EDGE,A.WrapMode.CLAMP_TO_EDGE,A.WrapMode.CLAMP_TO_EDGE),h.image=u,h.getGFXTexture()||s("Unexpected: failed to create morph texture?");var d=t.getSampler(h.getSamplerInfo());return{get texture(){return h.getGFXTexture()},get sampler(){return d},get valueView(){return r},destroy:function(){h.destroy()},updatePixels:function(){h.uploadData(a)}}}}}function Q(t,e,r){t.renderingSubMeshes[e].enableVertexIdChannel(r)}var Y={},K={};
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){function t(t){throw t}var e=void 0,r=!0,i=this;function n(t,r){var n,s=t.split("."),a=i;!(s[0]in a)&&a.execScript&&a.execScript("var "+s[0]);for(;s.length&&(n=s.shift());)s.length||r===e?a=a[n]?a[n]:a[n]={}:a[n]=r}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function a(t){if("string"==typeof t){var e,r,i=t.split("");for(e=0,r=i.length;e<r;e++)i[e]=(255&i[e].charCodeAt(0))>>>0;t=i}for(var n,s=1,a=0,u=t.length,o=0;0<u;){u-=n=1024<u?1024:u;do{a+=s+=t[o++]}while(--n);s%=65521,a%=65521}return(a<<16|s)>>>0}function u(e,r){this.index="number"==typeof r?r:0,this.i=0,this.buffer=e instanceof(s?Uint8Array:Array)?e:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}u.prototype.f=function(){var t,e=this.buffer,r=e.length,i=new(s?Uint8Array:Array)(r<<1);if(s)i.set(e);else for(t=0;t<r;++t)i[t]=e[t];return this.buffer=i},u.prototype.d=function(t,e,r){var i,n=this.buffer,s=this.index,a=this.i,u=n[s];if(r&&1<e&&(t=8<e?(l[255&t]<<24|l[t>>>8&255]<<16|l[t>>>16&255]<<8|l[t>>>24&255])>>32-e:l[t]>>8-e),8>e+a)u=u<<e|t,a+=e;else for(i=0;i<e;++i)u=u<<1|t>>e-i-1&1,8==++a&&(a=0,n[s++]=l[u],u=0,s===n.length&&(n=this.f()));n[s]=u,this.buffer=n,this.i=a,this.index=s},u.prototype.finish=function(){var t,e=this.buffer,r=this.index;return 0<this.i&&(e[r]<<=8-this.i,e[r]=l[e[r]],r++),s?t=e.subarray(0,r):(e.length=r,t=e),t};var o,h=new(s?Uint8Array:Array)(256);for(o=0;256>o;++o){for(var f=d=o,c=7,d=d>>>1;d;d>>>=1)f<<=1,f|=1&d,--c;h[o]=(f<<c&255)>>>0}var l=h;function v(t){this.buffer=new(s?Uint16Array:Array)(2*t),this.length=0}function b(t){var e,r,i,n,a,u,o,h,f,c=t.length,d=0,l=Number.POSITIVE_INFINITY;for(h=0;h<c;++h)t[h]>d&&(d=t[h]),t[h]<l&&(l=t[h]);for(e=1<<d,r=new(s?Uint32Array:Array)(e),i=1,n=0,a=2;i<=d;){for(h=0;h<c;++h)if(t[h]===i){for(u=0,o=n,f=0;f<i;++f)u=u<<1|1&o,o>>=1;for(f=u;f<e;f+=a)r[f]=i<<16|h;++n}++i,n<<=1,a<<=1}return[r,d,l]}function p(t,e){this.h=m,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=s&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}v.prototype.getParent=function(t){return 2*((t-2)/4|0)},v.prototype.push=function(t,e){var r,i,n,s=this.buffer;for(r=this.length,s[this.length++]=e,s[this.length++]=t;0<r&&(i=this.getParent(r),s[r]>s[i]);)n=s[r],s[r]=s[i],s[i]=n,n=s[r+1],s[r+1]=s[i+1],s[i+1]=n,r=i;return this.length},v.prototype.pop=function(){var t,e,r,i,n,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],n=0;!((i=2*n+2)>=this.length)&&(i+2<this.length&&s[i+2]>s[i]&&(i+=2),s[i]>s[n]);)r=s[n],s[n]=s[i],s[i]=r,r=s[n+1],s[n+1]=s[i+1],s[i+1]=r,n=i;return{index:t,value:e,length:this.length}};var g,m=2,y={NONE:0,r:1,j:m,N:3},_=[];for(g=0;288>g;g++)switch(r){case 143>=g:_.push([g+48,8]);break;case 255>=g:_.push([g-144+400,9]);break;case 279>=g:_.push([g-256+0,7]);break;case 287>=g:_.push([g-280+192,8]);break;default:t("invalid literal: "+g)}function w(t,e){this.length=t,this.G=e}function A(){var e=x;switch(r){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}p.prototype.n=function(){var i,n,a,o,h=this.input;switch(this.h){case 0:for(a=0,o=h.length;a<o;){var f,c,d,l=n=s?h.subarray(a,a+65535):h.slice(a,a+65535),v=(a+=n.length)===o,b=e,p=e,g=this.a,y=this.b;if(s){for(g=new Uint8Array(this.a.buffer);g.length<=y+l.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}if(f=v?1:0,g[y++]=0|f,d=65536+~(c=l.length)&65535,g[y++]=255&c,g[y++]=c>>>8&255,g[y++]=255&d,g[y++]=d>>>8&255,s)g.set(l,y),y+=l.length,g=g.subarray(0,y);else{for(b=0,p=l.length;b<p;++b)g[y++]=l[b];g.length=y}this.b=y,this.a=g}break;case 1:var w=new u(new Uint8Array(this.a.buffer),this.b);w.d(1,1,r),w.d(1,2,r);var A,x,T,E=I(this,h);for(A=0,x=E.length;A<x;A++)if(T=E[A],u.prototype.d.apply(w,_[T]),256<T)w.d(E[++A],E[++A],r),w.d(E[++A],5),w.d(E[++A],E[++A],r);else if(256===T)break;this.a=w.finish(),this.b=this.a.length;break;case m:var U,k,P,R,N,S,O,V,D,F,C,L,z,G,H,j=new u(new Uint8Array(this.a),this.b),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=Array(19);for(U=m,j.d(1,1,r),j.d(U,2,r),k=I(this,h),O=M(S=B(this.L,15)),D=M(V=B(this.K,7)),P=286;257<P&&0===S[P-1];P--);for(R=30;1<R&&0===V[R-1];R--);var Z,q,J,Q,Y,K,$=P,tt=R,et=new(s?Uint32Array:Array)($+tt),rt=new(s?Uint32Array:Array)(316),it=new(s?Uint8Array:Array)(19);for(Z=q=0;Z<$;Z++)et[q++]=S[Z];for(Z=0;Z<tt;Z++)et[q++]=V[Z];if(!s)for(Z=0,Q=it.length;Z<Q;++Z)it[Z]=0;for(Z=Y=0,Q=et.length;Z<Q;Z+=q){for(q=1;Z+q<Q&&et[Z+q]===et[Z];++q);if(J=q,0===et[Z])if(3>J)for(;0<J--;)rt[Y++]=0,it[0]++;else for(;0<J;)(K=138>J?J:138)>J-3&&K<J&&(K=J-3),10>=K?(rt[Y++]=17,rt[Y++]=K-3,it[17]++):(rt[Y++]=18,rt[Y++]=K-11,it[18]++),J-=K;else if(rt[Y++]=et[Z],it[et[Z]]++,3>--J)for(;0<J--;)rt[Y++]=et[Z],it[et[Z]]++;else for(;0<J;)(K=6>J?J:6)>J-3&&K<J&&(K=J-3),rt[Y++]=16,rt[Y++]=K-3,it[16]++,J-=K}for(i=s?rt.subarray(0,Y):rt.slice(0,Y),F=B(it,7),G=0;19>G;G++)W[G]=F[X[G]];for(N=19;4<N&&0===W[N-1];N--);for(C=M(F),j.d(P-257,5,r),j.d(R-1,5,r),j.d(N-4,4,r),G=0;G<N;G++)j.d(W[G],3,r);for(G=0,H=i.length;G<H;G++)if(L=i[G],j.d(C[L],F[L],r),16<=L){switch(G++,L){case 16:z=2;break;case 17:z=3;break;case 18:z=7;break;default:t("invalid code: "+L)}j.d(i[G],z,r)}var nt,st,at,ut,ot,ht,ft,ct,dt=[O,S],lt=[D,V];for(ot=dt[0],ht=dt[1],ft=lt[0],ct=lt[1],nt=0,st=k.length;nt<st;++nt)if(at=k[nt],j.d(ot[at],ht[at],r),256<at)j.d(k[++nt],k[++nt],r),ut=k[++nt],j.d(ft[ut],ct[ut],r),j.d(k[++nt],k[++nt],r);else if(256===at)break;this.a=j.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var x,T,E=[];for(x=3;258>=x;x++)T=A(),E[x]=T[2]<<24|T[1]<<16|T[0];var U=s?new Uint32Array(E):E;function I(i,n){function a(e,i){var n,s,a,u,o=e.G,h=[],f=0;switch(n=U[e.length],h[f++]=65535&n,h[f++]=n>>16&255,h[f++]=n>>24,r){case 1===o:s=[0,o-1,0];break;case 2===o:s=[1,o-2,0];break;case 3===o:s=[2,o-3,0];break;case 4===o:s=[3,o-4,0];break;case 6>=o:s=[4,o-5,1];break;case 8>=o:s=[5,o-7,1];break;case 12>=o:s=[6,o-9,2];break;case 16>=o:s=[7,o-13,2];break;case 24>=o:s=[8,o-17,3];break;case 32>=o:s=[9,o-25,3];break;case 48>=o:s=[10,o-33,4];break;case 64>=o:s=[11,o-49,4];break;case 96>=o:s=[12,o-65,5];break;case 128>=o:s=[13,o-97,5];break;case 192>=o:s=[14,o-129,6];break;case 256>=o:s=[15,o-193,6];break;case 384>=o:s=[16,o-257,7];break;case 512>=o:s=[17,o-385,7];break;case 768>=o:s=[18,o-513,8];break;case 1024>=o:s=[19,o-769,8];break;case 1536>=o:s=[20,o-1025,9];break;case 2048>=o:s=[21,o-1537,9];break;case 3072>=o:s=[22,o-2049,10];break;case 4096>=o:s=[23,o-3073,10];break;case 6144>=o:s=[24,o-4097,11];break;case 8192>=o:s=[25,o-6145,11];break;case 12288>=o:s=[26,o-8193,12];break;case 16384>=o:s=[27,o-12289,12];break;case 24576>=o:s=[28,o-16385,13];break;case 32768>=o:s=[29,o-24577,13];break;default:t("invalid distance")}for(n=s,h[f++]=n[0],h[f++]=n[1],h[f++]=n[2],a=0,u=h.length;a<u;++a)g[m++]=h[a];_[h[0]]++,A[h[3]]++,y=e.length+i-1,v=null}var u,o,h,f,c,d,l,v,b,p={},g=s?new Uint16Array(2*n.length):[],m=0,y=0,_=new(s?Uint32Array:Array)(286),A=new(s?Uint32Array:Array)(30),x=i.w;if(!s){for(h=0;285>=h;)_[h++]=0;for(h=0;29>=h;)A[h++]=0}for(_[256]=1,u=0,o=n.length;u<o;++u){for(h=c=0,f=3;h<f&&u+h!==o;++h)c=c<<8|n[u+h];if(p[c]===e&&(p[c]=[]),d=p[c],!(0<y--)){for(;0<d.length&&32768<u-d[0];)d.shift();if(u+3>=o){for(v&&a(v,-1),h=0,f=o-u;h<f;++h)b=n[u+h],g[m++]=b,++_[b];break}if(0<d.length){var T=e,E=e,I=0,B=e,M=e,k=e,P=n.length,R=(M=0,d.length);t:for(;M<R;M++){if(T=d[R-M-1],B=3,3<I){for(k=I;3<k;k--)if(n[T+k-1]!==n[u+k-1])continue t;B=I}for(;258>B&&u+B<P&&n[T+B]===n[u+B];)++B;if(B>I&&(E=T,I=B),258===B)break}l=new w(I,u-E),v?v.length<l.length?(b=n[u-1],g[m++]=b,++_[b],a(l,0)):a(v,-1):l.length<x?v=l:a(l,0)}else v?a(v,-1):(b=n[u],g[m++]=b,++_[b])}d.push(u)}return g[m++]=256,_[256]++,i.L=_,i.K=A,s?g.subarray(0,m):g}function B(t,e){function r(t){var e=x[t][T[t]];e===m?(r(t+1),r(t+1)):--w[e],++T[t]}var i,n,a,u,o,h=t.length,f=new v(572),c=new(s?Uint8Array:Array)(h);if(!s)for(u=0;u<h;u++)c[u]=0;for(u=0;u<h;++u)0<t[u]&&f.push(u,t[u]);if(i=Array(f.length/2),n=new(s?Uint32Array:Array)(f.length/2),1===i.length)return c[f.pop().index]=1,c;for(u=0,o=f.length/2;u<o;++u)i[u]=f.pop(),n[u]=i[u].value;var d,l,b,p,g,m=n.length,y=new(s?Uint16Array:Array)(e),_=new(s?Uint8Array:Array)(e),w=new(s?Uint8Array:Array)(m),A=Array(e),x=Array(e),T=Array(e),E=(1<<e)-m,U=1<<e-1;for(y[e-1]=m,l=0;l<e;++l)E<U?_[l]=0:(_[l]=1,E-=U),E<<=1,y[e-2-l]=(y[e-1-l]/2|0)+m;for(y[0]=_[0],A[0]=Array(y[0]),x[0]=Array(y[0]),l=1;l<e;++l)y[l]>2*y[l-1]+_[l]&&(y[l]=2*y[l-1]+_[l]),A[l]=Array(y[l]),x[l]=Array(y[l]);for(d=0;d<m;++d)w[d]=e;for(b=0;b<y[e-1];++b)A[e-1][b]=n[b],x[e-1][b]=b;for(d=0;d<e;++d)T[d]=0;for(1===_[e-1]&&(--w[0],++T[e-1]),l=e-2;0<=l;--l){for(p=d=0,g=T[l+1],b=0;b<y[l];b++)(p=A[l+1][g]+A[l+1][g+1])>n[d]?(A[l][b]=p,x[l][b]=m,g+=2):(A[l][b]=n[d],x[l][b]=d,++d);T[l]=0,1===_[l]&&r(l)}for(a=w,u=0,o=i.length;u<o;++u)c[i[u].index]=a[u];return c}function M(e){var r,i,n,a,u=new(s?Uint16Array:Array)(e.length),o=[],h=[],f=0;for(r=0,i=e.length;r<i;r++)o[e[r]]=1+(0|o[e[r]]);for(r=1,i=16;r<=i;r++)h[r]=f,(f+=0|o[r])>1<<r&&t("overcommitted"),f<<=1;for(65536>f&&t("undercommitted"),r=0,i=e.length;r<i;r++)for(f=h[e[r]],h[e[r]]+=1,n=u[r]=0,a=e[r];n<a;n++)u[r]=u[r]<<1|1&f,f>>>=1;return u}function k(t,e){this.input=t,this.a=new(s?Uint8Array:Array)(32768),this.h=P.j;var r,i={};for(r in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)i[r]=e[r];i.outputBuffer=this.a,this.z=new p(this.input,i)}var P=y;function R(e,r){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(e):e,this.s=!1,this.m=S,this.B=!1,!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.l=r.bufferSize),r.bufferType&&(this.m=r.bufferType),r.resize&&(this.B=r.resize)),this.m){case N:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.l+258);break;case S:this.b=0,this.a=new(s?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}k.prototype.n=function(){var e,r,i,n,u,o,h,f=0;switch(h=this.a,e=ft){case ft:r=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(i=r<<4|e,h[f++]=i,e){case ft:switch(this.h){case P.NONE:u=0;break;case P.r:u=1;break;case P.j:u=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return n=u<<6|0,h[f++]=n|31-(256*i+n)%31,o=a(this.input),this.z.b=f,f=(h=this.z.n()).length,s&&((h=new Uint8Array(h.buffer)).length<=f+4&&(this.a=new Uint8Array(h.length+4),this.a.set(h),h=this.a),h=h.subarray(0,f+4)),h[f++]=o>>24&255,h[f++]=o>>16&255,h[f++]=o>>8&255,h[f++]=255&o,h},n("Zlib.Deflate",k),n("Zlib.Deflate.compress",(function(t,e){return new k(t,e).n()})),n("Zlib.Deflate.CompressionType",P),n("Zlib.Deflate.CompressionType.NONE",P.NONE),n("Zlib.Deflate.CompressionType.FIXED",P.r),n("Zlib.Deflate.CompressionType.DYNAMIC",P.j);var N=0,S=1,O={D:N,C:S};R.prototype.p=function(){for(;!this.s;){var i=tt(this,3);switch(1&i&&(this.s=r),i>>>=1){case 0:var n=this.input,a=this.c,u=this.a,o=this.b,h=e,f=e,c=e,d=u.length,l=e;switch(this.e=this.g=0,(h=n[a++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),f=h,(h=n[a++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),f|=h<<8,(h=n[a++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=h,(h=n[a++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),f===~(c|=h<<8)&&t(Error("invalid uncompressed block header: length verify")),a+f>n.length&&t(Error("input buffer is broken")),this.m){case N:for(;o+f>u.length;){if(f-=l=d-o,s)u.set(n.subarray(a,a+l),o),o+=l,a+=l;else for(;l--;)u[o++]=n[a++];this.b=o,u=this.f(),o=this.b}break;case S:for(;o+f>u.length;)u=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(s)u.set(n.subarray(a,a+f),o),o+=f,a+=f;else for(;f--;)u[o++]=n[a++];this.c=a,this.b=o,this.a=u;break;case 1:this.o(Y,$);break;case 2:rt(this);break;default:t(Error("unknown BTYPE: "+i))}}return this.t()};var V,D,F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=s?new Uint16Array(F):F,L=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],z=s?new Uint16Array(L):L,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],H=s?new Uint8Array(G):G,j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],X=s?new Uint16Array(j):j,W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Z=s?new Uint8Array(W):W,q=new(s?Uint8Array:Array)(288);for(V=0,D=q.length;V<D;++V)q[V]=143>=V?8:255>=V?9:279>=V?7:8;var J,Q,Y=b(q),K=new(s?Uint8Array:Array)(30);for(J=0,Q=K.length;J<Q;++J)K[J]=5;var $=b(K);function tt(r,i){for(var n,s=r.g,a=r.e,u=r.input,o=r.c;a<i;)(n=u[o++])===e&&t(Error("input buffer is broken")),s|=n<<a,a+=8;return n=s&(1<<i)-1,r.g=s>>>i,r.e=a-i,r.c=o,n}function et(r,i){for(var n,s,a,u=r.g,o=r.e,h=r.input,f=r.c,c=i[0],d=i[1];o<d;)(n=h[f++])===e&&t(Error("input buffer is broken")),u|=n<<o,o+=8;return a=(s=c[u&(1<<d)-1])>>>16,r.g=u>>a,r.e=o-a,r.c=f,65535&s}function rt(t){function e(t,e,r){var i,n,s,a;for(a=0;a<t;)switch(i=et(this,e),i){case 16:for(s=3+tt(this,2);s--;)r[a++]=n;break;case 17:for(s=3+tt(this,3);s--;)r[a++]=0;n=0;break;case 18:for(s=11+tt(this,7);s--;)r[a++]=0;n=0;break;default:n=r[a++]=i}return r}var r,i,n,a,u=tt(t,5)+257,o=tt(t,5)+1,h=tt(t,4)+4,f=new(s?Uint8Array:Array)(C.length);for(a=0;a<h;++a)f[C[a]]=tt(t,3);r=b(f),i=new(s?Uint8Array:Array)(u),n=new(s?Uint8Array:Array)(o),t.o(b(e.call(t,u,r,i)),b(e.call(t,o,r,n)))}function it(e,r){var i,n;switch(this.input=e,this.c=0,!r&&(r={})||(r.index&&(this.c=r.index),r.verify&&(this.M=r.verify)),i=e[this.c++],n=e[this.c++],15&i){case ft:this.method=ft;break;default:t(Error("unsupported compression method"))}0!=((i<<8)+n)%31&&t(Error("invalid fcheck flag:"+((i<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.A=new R(e,{index:this.c,bufferSize:r.bufferSize,bufferType:r.bufferType,resize:r.resize})}R.prototype.o=function(t,e){var r=this.a,i=this.b;this.u=t;for(var n,s,a,u,o=r.length-258;256!==(n=et(this,t));)if(256>n)i>=o&&(this.b=i,r=this.f(),i=this.b),r[i++]=n;else for(u=z[s=n-257],0<H[s]&&(u+=tt(this,H[s])),n=et(this,e),a=X[n],0<Z[n]&&(a+=tt(this,Z[n])),i>=o&&(this.b=i,r=this.f(),i=this.b);u--;)r[i]=r[i++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},R.prototype.I=function(t,e){var r=this.a,i=this.b;this.u=t;for(var n,s,a,u,o=r.length;256!==(n=et(this,t));)if(256>n)i>=o&&(o=(r=this.f()).length),r[i++]=n;else for(u=z[s=n-257],0<H[s]&&(u+=tt(this,H[s])),n=et(this,e),a=X[n],0<Z[n]&&(a+=tt(this,Z[n])),i+u>o&&(o=(r=this.f()).length);u--;)r[i]=r[i++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},R.prototype.f=function(){var t,e,r=new(s?Uint8Array:Array)(this.b-32768),i=this.b-32768,n=this.a;if(s)r.set(n.subarray(32768,r.length));else for(t=0,e=r.length;t<e;++t)r[t]=n[t+32768];if(this.k.push(r),this.q+=r.length,s)n.set(n.subarray(i,i+32768));else for(t=0;32768>t;++t)n[t]=n[i+t];return this.b=32768,n},R.prototype.J=function(t){var e,r,i,n=this.input.length/this.c+1|0,a=this.input,u=this.a;return t&&("number"==typeof t.v&&(n=t.v),"number"==typeof t.F&&(n+=t.F)),r=2>n?(i=(a.length-this.c)/this.u[2]/2*258|0)<u.length?u.length+i:u.length<<1:u.length*n,s?(e=new Uint8Array(r)).set(u):e=u,this.a=e},R.prototype.t=function(){var t,e,r,i,n,a=0,u=this.a,o=this.k,h=new(s?Uint8Array:Array)(this.q+(this.b-32768));if(0===o.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,r=o.length;e<r;++e)for(i=0,n=(t=o[e]).length;i<n;++i)h[a++]=t[i];for(e=32768,r=this.b;e<r;++e)h[a++]=u[e];return this.k=[],this.buffer=h},R.prototype.H=function(){var t,e=this.b;return s?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},it.prototype.p=function(){var e,r=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(r[this.c++]<<24|r[this.c++]<<16|r[this.c++]<<8|r[this.c++])>>>0!==a(e)&&t(Error("invalid adler-32 checksum")),e},n("Zlib.Inflate",it),n("Zlib.Inflate.BufferType",O),O.ADAPTIVE=O.C,O.BLOCK=O.D,n("Zlib.Inflate.prototype.decompress",it.prototype.p);var nt,st,at=new(s?Uint8Array:Array)(288);for(nt=0,st=at.length;nt<st;++nt)at[nt]=143>=nt?8:255>=nt?9:279>=nt?7:8;b(at);var ut,ot,ht=new(s?Uint8Array:Array)(30);for(ut=0,ot=ht.length;ut<ot;++ut)ht[ut]=5;b(ht);var ft=8}).call(K);var $,tt,et,rt,it,nt=t("_",K.Zlib);function st(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}nt.Deflate=nt.Deflate,nt.Deflate.compress=nt.Deflate.compress,nt.Inflate=nt.Inflate,nt.Inflate.BufferType=nt.Inflate.BufferType,nt.Inflate.prototype.decompress=nt.Inflate.prototype.decompress;var at=new h,ut=new h,ot=new Uint8Array,ht=t("M",f("cc.Mesh")((tt=function(t){function i(){var e;return(e=t.call(this)||this).morphRendering=null,e._struct=et&&et(),e._hash=rt&&rt(),e._data=ot,e._initialized=!1,e._allowDataAccess=it&&it(),e._isMeshDataUploaded=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e}c(i,t);var s=i.prototype;return s.onLoaded=function(){this.initialize()},s.initialize=function(){if(!this._initialized){this._initialized=!0;var t={struct:this.struct,data:this.data};if(t.struct.compressed&&(t=pt(t)),this.struct.encoded&&(t=bt(t)),!this.struct.quantized||M.gfxDevice.getFormatFeatures(S.RGB16F)&O.VERTEX_ATTRIBUTE||(t=function(t){var e=JSON.parse(JSON.stringify(t.struct)),r=new H;function i(t,e,r,i,n,s,a){for(var u=0;u<r;u++)for(var o=0;o<i;o++)e(a*u+n*o,t(s*u+n*o))}function s(t,e,r,i,n,s){for(var a=0;a<r;a++)for(var u=0;u<i;u++)e(s*a+4*u,_(t(n*a+2*u)))}r.setNextAlignment(0);for(var a=0;a<e.vertexBundles.length;++a){for(var u=e.vertexBundles[a],o=u.view,h=u.attributes,f=t.struct.vertexBundles[a].attributes,c=[],d=[],l=[],v=0;v<h.length;++v){var b=h[v],p=lt(new DataView(t.data.buffer,o.offset+ft(f,v)),b.format),g=!0;switch(b.format){case S.R16F:b.format=S.R32F;break;case S.RG16F:b.format=S.RG32F;break;case S.RGB16F:b.format=S.RGB32F;break;case S.RGBA16F:b.format=S.RGBA32F;break;default:g=!1}c.push(C[b.format].size),d.push(g),l.push(p)}for(var m=c.reduce((function(t,e){return t+e}),0),y=new Uint8Array(m*o.count),w=0;w<h.length;++w){var A=h[w],x=l[w],T=vt(new DataView(y.buffer,ft(h,w)),A.format),E=d[w],U=C[A.format];E?s(x,T,o.count,U.count,o.stride,m):i(x,T,o.count,U.count,U.size/U.count,o.stride,m)}r.setNextAlignment(m);var I={offset:r.getLength(),length:y.byteLength,count:o.count,stride:m};u.view=I,r.addBuffer(y)}for(var B,M=n(e.primitives);!(B=M()).done;){var k=B.value;if(void 0!==k.indexView){var P=k.indexView,R=new Uint8Array(t.data.buffer,P.offset,P.length);r.setNextAlignment(P.stride);var N={offset:r.getLength(),length:R.byteLength,count:P.count,stride:P.stride};k.indexView=N,r.addBuffer(R)}}var O=new Uint8Array(r.getCombined());return e.quantized=!1,{struct:e,data:O}}(t)),this._struct=t.struct,this._data=t.data,this._struct.dynamic){for(var e=M.gfxDevice,r=[],i=[],s=0;s<this._struct.vertexBundles.length;s++){var a=this._struct.vertexBundles[s],u=e.createBuffer(new P(R.VERTEX|R.TRANSFER_DST,N.DEVICE,a.view.length,a.view.stride));r.push(u)}for(var o=0;o<this._struct.primitives.length;o++){var h=this._struct.primitives[o],f=h.indexView,c=null;f&&(c=e.createBuffer(new P(R.INDEX|R.TRANSFER_DST,N.DEVICE,f.length,f.stride)));for(var v=[],b=0;b<h.vertexBundelIndices.length;b++){var p=h.vertexBundelIndices[b];v.push(r[p])}for(var g=[],m=0;m<h.vertexBundelIndices.length;m++)for(var y,w=h.vertexBundelIndices[m],A=this._struct.vertexBundles[w],x=n(A.attributes);!(y=x()).done;){var E=y.value,U=new V;U.copy(E),g.push(U)}var I=new T(v,g,h.primitiveMode,c);I.drawInfo=new D,I.mesh=this,I.subMeshIdx=o,i.push(I)}this._renderingSubMeshes=i}else{for(var B=this._data.buffer,k=M.gfxDevice,L=this._createVertexBuffers(k,B),z=[],G=[],X=0;X<this._struct.primitives.length;X++){var W=this._struct.primitives[X];if(0!==W.vertexBundelIndices.length){var Z=null,q=void 0;if(W.indexView){var J=W.indexView,Q=J.stride,Y=J.length;if(4===Q&&!k.hasFeature(F.ELEMENT_INDEX_UINT)){var K=this._struct.vertexBundles[W.vertexBundelIndices[0]].view.count;if(K>=65536){d(10001,K,65536);continue}Q>>=1,Y>>=1}Z=k.createBuffer(new P(R.INDEX,N.DEVICE,Y,Q)),z.push(Z),q=new(st(J.stride))(B,J.offset,J.count),J.stride!==Q&&(q=st(Q).from(q)),Z.update(q)}var $=W.vertexBundelIndices.map((function(t){return L[t]})),tt=[];if(W.vertexBundelIndices.length>0)for(var et=W.vertexBundelIndices[0],rt=this._struct.vertexBundles[et].attributes,it=0;it<rt.length;++it){var nt=rt[it];tt[it]=new V(nt.name,nt.format,nt.isNormalized,nt.stream,nt.isInstanced,nt.location)}var at=new T($,tt,W.primitiveMode,Z);at.mesh=this,at.subMeshIdx=X,G.push(at)}}this._renderingSubMeshes=G,this._struct.morph&&(this.morphRendering=function(t,e){return new j(t,e)}(this,k)),this._isMeshDataUploaded=!0,this._allowDataAccess||l||this.releaseData()}}},s.updateSubMesh=function(t,e){if(this._struct.dynamic)if(t>=this._struct.primitives.length)d(14201);else{var i=[];if(e.positions.length>0&&i.push(e.positions),e.normals&&e.normals.length>0&&i.push(e.normals),e.uvs&&e.uvs.length>0&&i.push(e.uvs),e.tangents&&e.tangents.length>0&&i.push(e.tangents),e.colors&&e.colors.length>0&&i.push(e.colors),e.customAttributes)for(var s=0;s<e.customAttributes.length;s++)i.push(e.customAttributes[s].values);for(var a=this._struct.dynamic,u=a.info,o=this._struct.primitives[t],f=this._renderingSubMeshes[t],c=f.drawInfo,l=0;l<i.length;l++){var b=i[l],p=this._struct.vertexBundles[o.vertexBundelIndices[l]],g=p.view.stride,m=b.byteLength/g,y=b.byteLength,_=new Uint8Array(this._data.buffer,p.view.offset,y),w=new Uint8Array(b.buffer,b.byteOffset,y),A=f.vertexBuffers[l];r(m<=u.maxSubMeshVertices),y>0&&(_.set(w),A.update(w,y)),p.view.count=m,c.vertexCount=m}if(o.indexView){var x=o.indexView,T=x.stride,E=2===T?e.indices16.length:e.indices32.length,U=E*T,I=new Uint8Array(this._data.buffer,x.offset,U),B=2===T?new Uint8Array(e.indices16.buffer,e.indices16.byteOffset,U):new Uint8Array(e.indices32.buffer,e.indices32.byteOffset,U),M=f.indexBuffer;r(E<=u.maxSubMeshIndices),U>0&&(I.set(B),M.update(B,U)),x.count=E,c.indexCount=E}if(e.minPos&&e.maxPos){var k=new h(e.minPos.x,e.minPos.y,e.minPos.z),P=new h(e.maxPos.x,e.maxPos.y,e.maxPos.z);a.bounds[t]||(a.bounds[t]=new v),v.fromPoints(a.bounds[t],k,P);for(var R,N=new h,S=new h,O=n(a.bounds);!(R=O()).done;){var V=R.value;V&&(V.getBoundary(N,S),h.min(k,N,k),h.max(P,S,P))}this._struct.minPosition=new h(k.x,k.y,k.z),this._struct.maxPosition=new h(P.x,P.y,P.z)}f.invalidateGeometricInfo()}else d(14200)},s.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},s.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1,this._isMeshDataUploaded=!1}},s.assign=function(t,e){this.reset({struct:t,data:e})},s.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._hash=0},s.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var r=[],i=t.bindposes,n=0;n<i.length;n++)e.push(new v(1/0,1/0,1/0,-1/0,-1/0,-1/0)),r.push(!1);for(var s=this._struct.primitives,a=0;a<s.length;a++){var u=this.readAttribute(a,k.ATTR_JOINTS),o=this.readAttribute(a,k.ATTR_WEIGHTS),f=this.readAttribute(a,k.ATTR_POSITION);if(u&&o&&f)for(var c=Math.min(u.length/4,o.length/4,f.length/3),d=0;d<c;d++){h.set(at,f[3*d+0],f[3*d+1],f[3*d+2]);for(var l=0;l<4;++l){var b=4*d+l,p=u[b];if(!(0===o[b]||p>=i.length)){h.transformMat4(ut,at,i[p]),r[p]=!0;var g=e[p];h.min(g.center,g.center,ut),h.max(g.halfExtents,g.halfExtents,ut)}}}}for(var m=0;m<i.length;m++){var y=e[m];r[m]?v.fromPoints(y,y.center,y.halfExtents):e[m]=null}return e},s.merge=function(t,e,r){if(r&&!this.validateMergingMesh(t))return!1;var i=new h,s=e&&new b,a=e&&new v;if(s&&e.getRotation(s),!this._initialized){var u=JSON.parse(JSON.stringify(t._struct)),o=t._data.slice();if(e){u.maxPosition&&u.minPosition&&(h.add(a.center,u.maxPosition,u.minPosition),h.multiplyScalar(a.center,a.center,.5),h.subtract(a.halfExtents,u.maxPosition,u.minPosition),h.multiplyScalar(a.halfExtents,a.halfExtents,.5),v.transform(a,a,e),h.add(u.maxPosition,a.center,a.halfExtents),h.subtract(u.minPosition,a.center,a.halfExtents));for(var f=0;f<u.vertexBundles.length;f++)for(var c=u.vertexBundles[f],d=0;d<c.attributes.length;d++)if(c.attributes[d].name===k.ATTR_POSITION||c.attributes[d].name===k.ATTR_NORMAL){var l=c.attributes[d].format,p=new DataView(o.buffer,c.view.offset+ft(c.attributes,d)),g=lt(p,l),m=vt(p,l);if(!g||!m)continue;for(var y=c.view.count,_=c.view.stride,w=dt(l),A=0;A<y;A++){var x=A*_,T=x+w,E=T+w;switch(i.set(g(x),g(T),g(E)),c.attributes[d].name){case k.ATTR_POSITION:i.transformMat4(e);break;case k.ATTR_NORMAL:h.transformQuat(i,i,s)}m(x,i.x),m(T,i.y),m(E,i.z)}}}return this.reset({struct:u,data:o}),this.initialize(),!0}for(var U,I,B,M,P,R=new H,N=0,S=0,O=0,V=0,D=0,F=0,L=0,z=0,G=!1,j=new Array(this._struct.vertexBundles.length),X=0;X<this._struct.vertexBundles.length;++X){var W=this._struct.vertexBundles[X],Z=t._struct.vertexBundles[X];O=W.view.offset,V=Z.view.offset,S=W.view.stride,N=W.view.count+Z.view.count,U=new ArrayBuffer(N*S),I=new Uint8Array(U),O+=(B=this._data.subarray(O,O+W.view.length)).length,V+=(M=t._data.subarray(V,V+Z.view.length)).length,I.set(B),D=0;for(var q,J=n(W.attributes);!(q=J()).done;){var Q=q.value;L=0,G=!1;for(var Y,K=n(Z.attributes);!(Y=K()).done;){var $=Y.value;if(Q.name===$.name&&Q.format===$.format){G=!0;break}L+=C[$.format].size}if(G){z=C[Q.format].size,F=W.view.length+D;for(var tt=0;tt<Z.view.count;++tt){if(P=M.subarray(L,L+z),I.set(P,F),(Q.name===k.ATTR_POSITION||Q.name===k.ATTR_NORMAL)&&e){var et=new Float32Array(I.buffer,F,3);switch(i.set(et[0],et[1],et[2]),Q.name){case k.ATTR_POSITION:i.transformMat4(e);break;case k.ATTR_NORMAL:h.transformQuat(i,i,s)}et[0]=i.x,et[1]=i.y,et[2]=i.z}F+=W.view.stride,L+=Z.view.stride}}D+=C[Q.format].size}j[X]={attributes:W.attributes,view:{offset:R.getLength(),length:U.byteLength,count:N,stride:S}},R.addBuffer(U)}for(var rt,it,nt,st=0,at=2,ut=new Array(this._struct.primitives.length),ot=0;ot<this._struct.primitives.length;++ot){var ht=this._struct.primitives[ot],ct=t._struct.primitives[ot];ut[ot]={primitiveMode:ht.primitiveMode,vertexBundelIndices:ht.vertexBundelIndices};for(var bt,pt=0,gt=n(ht.vertexBundelIndices);!(bt=gt()).done;){var mt=bt.value;pt=Math.max(pt,this._struct.vertexBundles[mt].view.count)}if(ht.indexView&&ct.indexView){st=ht.indexView.count,st+=ct.indexView.count,O=ht.indexView.offset,V=ct.indexView.offset,at=st<256?1:st<65536?2:4;var yt=new ArrayBuffer(st*at);if(rt=2===at?new Uint16Array(yt):1===at?new Uint8Array(yt):new Uint32Array(yt),it=2===ht.indexView.stride?new Uint16Array(this._data.buffer,O,ht.indexView.count):1===ht.indexView.stride?new Uint8Array(this._data.buffer,O,ht.indexView.count):new Uint32Array(this._data.buffer,O,ht.indexView.count),at===ht.indexView.stride)rt.set(it);else for(var _t=0;_t<ht.indexView.count;++_t)rt[_t]=it[_t];O+=ht.indexView.length,nt=2===ct.indexView.stride?new Uint16Array(t._data.buffer,V,ct.indexView.count):1===ct.indexView.stride?new Uint8Array(t._data.buffer,V,ct.indexView.count):new Uint32Array(t._data.buffer,V,ct.indexView.count);for(var wt=0;wt<ct.indexView.count;++wt)rt[ht.indexView.count+wt]=pt+nt[wt];V+=ct.indexView.length,ut[ot].indexView={offset:R.getLength(),length:yt.byteLength,count:st,stride:at},R.setNextAlignment(at),R.addBuffer(yt)}}var At={vertexBundles:j,primitives:ut,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return At.minPosition&&t._struct.minPosition&&At.maxPosition&&t._struct.maxPosition&&(e?(h.add(a.center,t._struct.maxPosition,t._struct.minPosition),h.multiplyScalar(a.center,a.center,.5),h.subtract(a.halfExtents,t._struct.maxPosition,t._struct.minPosition),h.multiplyScalar(a.halfExtents,a.halfExtents,.5),v.transform(a,a,e),h.add(i,a.center,a.halfExtents),h.max(At.maxPosition,At.maxPosition,i),h.subtract(i,a.center,a.halfExtents),h.min(At.minPosition,At.minPosition,i)):(h.min(At.minPosition,At.minPosition,t._struct.minPosition),h.max(At.maxPosition,At.maxPosition,t._struct.maxPosition))),this.reset({struct:At,data:new Uint8Array(R.getCombined())}),this.initialize(),!0},s.validateMergingMesh=function(t){if(this._struct.dynamic||t._struct.dynamic)return!1;if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var r=this._struct.vertexBundles[e],i=t._struct.vertexBundles[e];if(r.attributes.length!==i.attributes.length)return!1;for(var n=0;n<r.attributes.length;++n)if(r.attributes[n].format!==i.attributes[n].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var s=0;s<this._struct.primitives.length;++s){var a=this._struct.primitives[s],u=t._struct.primitives[s];if(a.vertexBundelIndices.length!==u.vertexBundelIndices.length)return!1;for(var o=0;o<a.vertexBundelIndices.length;++o)if(a.vertexBundelIndices[o]!==u.vertexBundelIndices[o])return!1;if(a.primitiveMode!==u.primitiveMode)return!1;if(a.indexView){if(void 0===u.indexView)return!1}else if(u.indexView)return!1}return!0},s.readAttribute=function(t,e){var r=this,i=null;return this._accessAttribute(t,e,(function(t,e){var n=t.view.count,s=t.attributes[e].format,a=L(C[s]);if(0!==n){var u=new DataView(r._data.buffer,t.view.offset+ft(t.attributes,e)),o=C[s],h=lt(u,s);if(a&&h){for(var f=o.count,c=new a(n*f),d=t.view.stride,l=0;l<n;++l)for(var v=0;v<f;++v)c[f*l+v]=h(d*l+c.BYTES_PER_ELEMENT*v);i=c}}})),i},s.copyAttribute=function(t,e,r,i,n){var s=this,a=!1;return this._accessAttribute(t,e,(function(t,e){var u=t.view.count;if(0!==u){var o=t.attributes[e].format,h=new DataView(s._data.buffer,t.view.offset+ft(t.attributes,e)),f=new DataView(r,n),c=C[o],d=lt(h,o),l=vt(f,o);if(d&&l){for(var v=c.count,b=t.view.stride,p=dt(o),g=i,m=p,y=0;y<u;++y)for(var _=0;_<v;++_)l(g*y+m*_,d(b*y+p*_));a=!0}}else a=!0})),a},s.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var r=e.indexView.stride;return new(1===r?Uint8Array:2===r?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},s.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var r=this._struct.primitives[t];if(!r.indexView)return!1;for(var i=r.indexView.count,n=1===r.indexView.stride?S.R8UI:2===r.indexView.stride?S.R16UI:S.R32UI,s=lt(new DataView(this._data.buffer),n),a=0;a<i;++a)e[a]=s(r.indexView.offset+C[n].size*a);return!0},s.readAttributeFormat=function(t,e){var r=null;return this._accessAttribute(t,e,(function(t,e){var i=t.attributes[e].format;r=C[i]})),r},s._accessAttribute=function(t,e,r){if(!(t>=this._struct.primitives.length))for(var i,s=this._struct.primitives[t],a=n(s.vertexBundelIndices);!(i=a()).done;){var u=i.value,o=this._struct.vertexBundles[u],h=o.attributes.findIndex((function(t){return t.name===e}));if(!(h<0)){r(o,h);break}}},s._createVertexBuffers=function(t,e){return this._struct.vertexBundles.map((function(r){var i=t.createBuffer(new P(R.VERTEX,N.DEVICE,r.view.length,r.view.stride)),n=new Uint8Array(e,r.view.offset,r.view.length);return i.update(n),i}))},s.initDefault=function(e){t.prototype.initDefault.call(this,e),this.reset({struct:{vertexBundles:[],primitives:[]},data:ot})},s.releaseData=function(){this._data=ot},e(i,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data=new Uint8Array(t)}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=G(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}},{key:"allowDataAccess",get:function(){return this._allowDataAccess},set:function(t){this._allowDataAccess=t,!this._isMeshDataUploaded||this._allowDataAccess||l||this.releaseData()}}]),i}(w),et=p(tt.prototype,"_struct",[m],(function(){return{vertexBundles:[],primitives:[]}})),rt=p(tt.prototype,"_hash",[m],(function(){return 0})),it=p(tt.prototype,"_allowDataAccess",[m],(function(){return!0})),$=tt))||$);function ft(t,e){for(var r=0,i=0;i<e;++i){var n=t[i];r+=C[n.format].size}return r}i.Mesh=ht;var ct=g.isLittleEndian;function dt(t){var e=C[t];return e.size/e.count}function lt(t,e){var r=C[e],i=r.size/r.count;switch(r.type){case z.UNORM:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,ct)};case 4:return function(e){return t.getUint32(e,ct)}}break;case z.SNORM:case z.INT:switch(i){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,ct)};case 4:return function(e){return t.getInt32(e,ct)}}break;case z.UINT:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,ct)};case 4:return function(e){return t.getUint32(e,ct)}}break;case z.FLOAT:switch(i){case 2:return function(e){return t.getUint16(e,ct)};case 4:return function(e){return t.getFloat32(e,ct)}}}return null}function vt(t,e){var r=C[e],i=r.size/r.count;switch(r.type){case z.UNORM:switch(i){case 1:return function(e,r){return t.setUint8(e,r)};case 2:return function(e,r){return t.setUint16(e,r,ct)};case 4:return function(e,r){return t.setUint32(e,r,ct)}}break;case z.SNORM:case z.INT:switch(i){case 1:return function(e,r){return t.setInt8(e,r)};case 2:return function(e,r){return t.setInt16(e,r,ct)};case 4:return function(e,r){return t.setInt32(e,r,ct)}}break;case z.UINT:switch(i){case 1:return function(e,r){return t.setUint8(e,r)};case 2:return function(e,r){return t.setUint16(e,r,ct)};case 4:return function(e,r){return t.setUint32(e,r,ct)}}break;case z.FLOAT:switch(i){case 2:return function(e,r){return t.setUint16(e,r,ct)};case 4:return function(e,r){return t.setFloat32(e,r,ct)}}}return null}function bt(t){if(!t.struct.encoded)return t;var e=function(t){t<0&&y(14204,t)},r=JSON.parse(JSON.stringify(t.struct)),i=new H;i.setNextAlignment(0);for(var s,a=n(r.vertexBundles);!(s=a()).done;){var u=s.value,o=u.view,h=o.count*o.stride,f=new Uint8Array(h),c=new Uint8Array(t.data.buffer,o.offset,o.length);e(Y.decodeVertexBuffer(f,o.count,o.stride,c)),i.setNextAlignment(o.stride);var d={offset:i.getLength(),length:f.byteLength,count:o.count,stride:o.stride};u.view=d,i.addBuffer(f)}for(var l,v=n(r.primitives);!(l=v()).done;){var b=l.value;if(void 0!==b.indexView){var p=b.indexView,g=p.count*p.stride,m=new Uint8Array(g),_=new Uint8Array(t.data.buffer,p.offset,p.length);e(Y.decodeIndexBuffer(m,p.count,p.stride,_)),i.setNextAlignment(p.stride);var w={offset:i.getLength(),length:m.byteLength,count:p.count,stride:p.stride};b.indexView=w,i.addBuffer(m)}}return{struct:r,data:new Uint8Array(i.getCombined())}}function pt(t){var e=new nt.Inflate(t.data).decompress();return t.data=e,t.struct.compressed=!1,t}}}}));
