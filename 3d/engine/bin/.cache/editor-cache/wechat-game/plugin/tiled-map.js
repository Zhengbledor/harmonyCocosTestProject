System.register(["./index-d48cc0ba.js","./node-event-2a6499e4.js","./sprite-renderer-a2b4676c.js","./sprite-af91df1a.js","./ZipUtils-50eca9c4.js","./mesh-7036037d.js","./director-39a00fed.js","./pipeline-state-manager-1c54311a.js","./deprecated-653e59b0.js","./buffer-barrier-a01f2732.js","./renderer-3b929285.js","./camera-component-f1519417.js","./create-mesh-746ae60b.js","./deprecated-f3d0b236.js","./model-renderer-2d8221ee.js","./touch-029b049b.js"],(function(t){"use strict";var e,i,r,s,n,o,a,h,l,u,f,g,d,_,p,c,m,y,v,A,w,S,x,T,b,I,C,D,N,O,E,P,G,F,L,z,R,M,X,U,H,j,B,k,Y,V,Z,K;return{setters:[function(t){e=t.ae,i=t.V,r=t.B,s=t.S,n=t.y,o=t.c,a=t.f,h=t.bC,l=t.bE,u=t.bX,f=t.bF,g=t.w,d=t.bI,_=t.bH,p=t.cK,c=t.aw,m=t.t,y=t.o,v=t.av,A=t.ay,w=t.az,S=t.bj,x=t.i,T=t.aP,b=t.c3},function(t){I=t.N,C=t.C,D=t.A},function(t){N=t.c,O=t.s,E=t.t,P=t.e,G=t.p,F=t.q,L=t.b,z=t.a,R=t.k,M=t.i},function(t){X=t.b,U=t.a},function(t){H=t.c},function(t){j=t._},function(t){B=t.bR,k=t.aU,Y=t.ax,V=t.a_,Z=t.aT},function(){},function(){},function(t){K=t.p},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var W,q,J,$,Q,tt,et;!function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(W||(W={})),e(W),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}(q||(q={})),e(q),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(J||(J={})),e(J),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}($||($={})),e($),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}(Q||(Q={})),e(Q),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}(tt||(tt={})),e(tt),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(et||(et={})),e(et);var it=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageOffset=null,this.imageSize=new s(0,0),this.tileOffset=new i(0,0),this._tileSize=new s(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var i=e||new n(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height;var r=t;if(r&=J.FLIPPED_MASK,r-=this.firstGid,this.imageOffset)i.x=this.imageOffset.x,i.y=this.imageOffset.y;else{var s=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));i.x=Math.round(r%s*(this._tileSize.width+this.spacing)+this.margin),i.y=Math.round(Math.floor(r/s)*(this._tileSize.height+this.spacing)+this.margin)}return i},t}(),rt=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new r(255,255,255,255),this.offset=new i(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),st=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new i(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();st.ATTRIB_NONE=1,st.ATTRIB_BASE64=2,st.ATTRIB_GZIP=4,st.ATTRIB_ZLIB=8;var nt=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new i(0,0),this.opacity=0,this.trans=new r(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function ot(t){var e=X.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function at(t){var e=X.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function ht(t){if(!t)return new r(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,s=parseInt(t.substr(4,2),16)||0,n=parseInt(t.substr(6,2),16)||0;return new r(i,s,n,e)}var o=parseInt(t.substr(0,2),16)||0,a=parseInt(t.substr(2,2),16)||0,h=parseInt(t.substr(4,2),16)||0;return new r(o,a,h,255)}function lt(t,e){for(var i=[],r=t.getElementsByTagName("properties"),s=0;s<r.length;++s)for(var n=r[s].getElementsByTagName("property"),o=0;o<n.length;++o)i.push(n[o]);e=e||{};for(var a=0;a<i.length;a++){var h=i[a],l=h.getAttribute("name"),u=h.getAttribute("type")||"string",f=h.getAttribute("value");"int"===u?f=parseInt(f):"float"===u?f=parseFloat(f):"bool"===u?f="true"===f:"color"===u&&(f=ht(f)),e[l]=f}return e}var ut,ft,gt,dt,_t,pt,ct,mt,yt,vt,At,wt,St,xt=function(){function t(t,e,i,r,n){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=tt.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new s(0,0),this._tileSize=new s(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,i,r,n)}var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new s(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new s(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,i,r,s){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=i,this._imageLayerSPF=s,this._spfSizeMap=r,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=st.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,r){var n,h=(new B).parse(e).documentElement,l=h.getAttribute("orientation"),u=h.getAttribute("staggeraxis"),f=h.getAttribute("staggerindex"),g=h.getAttribute("hexsidelength"),d=h.getAttribute("renderorder"),_=h.getAttribute("version")||"1.0.0";if("map"===h.nodeName){var p=_.split("."),c=this._supportVersion;for(n=0;n<c.length;n++){var m=parseInt(p[n])||0;if(c[n]<m){o(7216,_);break}}"orthogonal"===l?this.orientation=W.ORTHO:"isometric"===l?this.orientation=W.ISO:"hexagonal"===l?this.orientation=W.HEX:null!==l&&o(7217,l),this.renderOrder="right-up"===d?tt.RightUp:"left-up"===d?tt.LeftUp:"left-down"===d?tt.LeftDown:tt.RightDown,"x"===u?this.setStaggerAxis($.STAGGERAXIS_X):"y"===u&&this.setStaggerAxis($.STAGGERAXIS_Y),"odd"===f?this.setStaggerIndex(Q.STAGGERINDEX_ODD):"even"===f&&this.setStaggerIndex(Q.STAGGERINDEX_EVEN),g&&this.setHexSideLength(parseFloat(g));var y=new s(0,0);y.width=parseFloat(h.getAttribute("width")),y.height=parseFloat(h.getAttribute("height")),this.setMapSize(y),(y=new s(0,0)).width=parseFloat(h.getAttribute("tilewidth")),y.height=parseFloat(h.getAttribute("tileheight")),this.setTileSize(y),this.properties=lt(h)}var v=h.getElementsByTagName("tileset");for("map"!==h.nodeName&&(v=[]).push(h),n=0;n<v.length;n++){var A=v[n],w=A.getAttribute("source");if(w){var S=parseInt(A.getAttribute("firstgid")),x=this._tsxContentMap[w];x&&this.parseXMLString(x,S)}else{var T=A.getElementsByTagName("image"),b=T.length>1,I=T[0],C=I.getAttribute("source");C=C.replace(/\\/g,"/");var D=A.getElementsByTagName("tile"),N=D&&D.length||1,O=null,E=A.getAttribute("name")||"",P=parseInt(A.getAttribute("spacing"))||0,G=parseInt(A.getAttribute("margin"))||0,F=r||parseInt(A.getAttribute("firstgid"))||0,L=new s(0,0);L.width=parseFloat(A.getAttribute("tilewidth")),L.height=parseFloat(A.getAttribute("tileheight"));var z=A.getElementsByTagName("tileoffset")[0],R=0,M=0;z&&(R=parseFloat(z.getAttribute("x"))||0,M=parseFloat(z.getAttribute("y"))||0);for(var X=null,U=0;U<N;U++){var H=T[U]?T[U]:I;if(H){var j=H.getAttribute("source");if(j=j.replace(/\\/g,"/"),!X||b){if((X=new it).name=E,X.firstGid=F&J.FLIPPED_MASK,X.tileOffset.x=R,X.tileOffset.y=M,X.collection=b,!b&&(X.imageName=j,X.imageSize.width=parseFloat(H.getAttribute("width"))||0,X.imageSize.height=parseFloat(H.getAttribute("height"))||0,X.sourceImage=this._spriteFrameMap[j],!X.sourceImage)){var k=t.getNameWithPostfix(j);if(X.imageName=k,X.sourceImage=this._spriteFrameMap[k],!X.sourceImage){var Y=t.getShortName(j);X.imageName=Y,X.sourceImage=this._spriteFrameMap[Y],X.sourceImage||(console.error("[error]: "+Y+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),a(7221,j),console.warn("Please try asset type of "+j+" to 'sprite-frame'"))}}X.spacing=P,X.margin=G,X._tileSize.width=L.width,X._tileSize.height=L.height,this.setTilesets(X)}if(O=D&&D[U]){this.parentGID=F+(parseInt(O.getAttribute("id"))||0);var V=O.getElementsByTagName("image");O.hasAttribute("x")&&O.hasAttribute("y")&&(X.imageOffset=new i(parseFloat(O.getAttribute("x"))||0,parseFloat(O.getAttribute("y"))||0));var Z=O.hasAttribute("width")&&O.hasAttribute("height");if(Z&&(X._tileSize.width=parseFloat(O.getAttribute("width"))||0,X._tileSize.height=parseFloat(O.getAttribute("height"))||0),V&&V.length>0){var K=V[0],q=K.getAttribute("source");if(q=q.replace(/\\/g,"/"),X.imageName=q,X.imageSize.width=parseFloat(K.getAttribute("width"))||0,X.imageSize.height=parseFloat(K.getAttribute("height"))||0,Z||(X._tileSize.width=X.imageSize.width,X._tileSize.height=X.imageSize.height),X.sourceImage=this._spriteFrameMap[q],!X.sourceImage){var et=t.getNameWithPostfix(q);if(X.imageName=et,X.sourceImage=this._spriteFrameMap[et],!X.sourceImage){var rt=t.getShortName(q);X.imageName=rt,X.sourceImage=this._spriteFrameMap[rt],X.sourceImage||(a(7221,q),console.warn("Please try asset type of "+q+" to 'sprite-frame'"))}}X.firstGid=this.parentGID&J.FLIPPED_MASK}var st=(J.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(st,lt(O));var nt=O.getElementsByTagName("animation");if(nt&&nt.length>0){var ot=nt[0].getElementsByTagName("frame"),at={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(st,at);for(var ht=at.frames,ut=0;ut<ot.length;ut++){var ft=ot[ut],gt=F+(parseInt(ft.getAttribute("tileid"))||0),dt=parseFloat(ft.getAttribute("duration"))||0;ht.push({tileid:gt,duration:dt/1e3,grid:null})}}}}}}}var _t=h.childNodes;for(n=0;n<_t.length;n++){var pt=_t[n];if(!this._shouldIgnoreNode(pt)){if("imagelayer"===pt.nodeName){var ct=this._parseImageLayer(pt);ct&&this.setImageLayers(ct)}if("layer"===pt.nodeName){var mt=this._parseLayer(pt);this.setLayers(mt)}if("objectgroup"===pt.nodeName){var yt=this._parseObjectGroup(pt);this.setObjectGroups(yt)}}}return h},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var i=new nt;i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;var r=t.getAttribute("visible");i.visible=!("0"===r);var s=t.getAttribute("opacity");i.opacity=s?Math.round(255*parseFloat(s)):255;var n=t.getAttribute("tintcolor");i.tintColor=n?ht(n):null;var o=e[0],h=o.getAttribute("source");return i.sourceImage=this._imageLayerSPF[h],i.width=parseInt(o.getAttribute("width"))||0,i.height=parseInt(o.getAttribute("height"))||0,i.trans=ht(o.getAttribute("trans")),i.sourceImage?i:(a(7221,h),console.warn("Please try asset type of "+h+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],r=new st;r.name=t.getAttribute("name");var n=new s(0,0);n.width=parseFloat(t.getAttribute("width")),n.height=parseFloat(t.getAttribute("height")),r.layerSize=n;var a=t.getAttribute("visible");r.visible=!("0"===a);var h=t.getAttribute("opacity");r.opacity=h?Math.round(255*parseFloat(h)):255,r.offset=new i(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var l=t.getAttribute("tintcolor");r.tintColor=l?ht(l):null;for(var u="",f=0;f<e.childNodes.length;f++)u+=e.childNodes[f].nodeValue;u=u.trim();var g,d=e.getAttribute("compression"),_=e.getAttribute("encoding");if(d&&"gzip"!==d&&"zlib"!==d)return o(7218),null;switch(d){case"gzip":g=H.unzipBase64AsArray(u,4);break;case"zlib":g=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],r=0;r<e;r++){var s=4*r;i[r]=t[s]+256*t[s+1]+65536*t[s+2]+t[s+3]*(1<<24)}return i}(new j.Inflate(H.Base64.decodeAsArray(u,1)).decompress());break;case null:case"":if("base64"===_)g=H.Base64.decodeAsArray(u,4);else if("csv"===_){g=[];for(var p=u.split(","),c=0;c<p.length;c++)g.push(parseInt(p[c]))}else{var m=e.getElementsByTagName("tile");g=[];for(var y=0;y<m.length;y++)g.push(parseInt(m[y].getAttribute("gid")))}break;default:this.layerAttrs===st.ATTRIB_NONE&&o(7219)}return g&&(r.tiles=new Uint32Array(g)),r.properties=lt(t),r},e._parseObjectGroup=function(t){var e=new rt;e.name=t.getAttribute("name")||"",e.offset=new i(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var r=t.getAttribute("opacity");e.opacity=r?Math.round(255*parseFloat(r)):255;var s=t.getAttribute("tintcolor");e.tintColor=s?ht(s):null;var n=t.getAttribute("visible");n&&0===parseInt(n)&&(e.visible=!1);var o=t.getAttribute("color");o&&e.color.fromHEX(o);var a=t.getAttribute("draworder");a&&(e.draworder=a),e.setProperties(lt(t));var h=t.getElementsByTagName("object");if(h){for(var l=0;l<h.length;l++){var u=h[l],f={};f.id=u.getAttribute("id")||l,f.name=u.getAttribute("name")||"",f.width=parseFloat(u.getAttribute("width"))||0,f.height=parseFloat(u.getAttribute("height"))||0,f.x=parseFloat(u.getAttribute("x"))||0,f.y=parseFloat(u.getAttribute("y"))||0,f.rotation=parseFloat(u.getAttribute("rotation"))||0,lt(u,f);var g=u.getAttribute("visible");f.visible=!(g&&0===parseInt(g));var d=u.getElementsByTagName("text");if(d&&d.length>0){var _=d[0];f.type=et.TEXT,f.wrap="1"===_.getAttribute("wrap"),f.color=ht(_.getAttribute("color")),f.halign=ot(_.getAttribute("halign")),f.valign=at(_.getAttribute("valign")),f.pixelsize=parseInt(_.getAttribute("pixelsize"))||16,f.text=_.childNodes[0].nodeValue}var p=u.getAttribute("gid");p&&(f.gid=parseInt(p),f.type=et.IMAGE);var c=u.getElementsByTagName("ellipse");c&&c.length>0&&(f.type=et.ELLIPSE);var m=u.getElementsByTagName("polygon");if(m&&m.length>0){f.type=et.POLYGON;var y=m[0].getAttribute("points");y&&(f.points=this._parsePointsString(y))}var v=u.getElementsByTagName("polyline");if(v&&v.length>0){f.type=et.POLYLINE;var A=v[0].getAttribute("points");A&&(f.polylinePoints=this._parsePointsString(A))}f.type||(f.type=et.RECT),e.objects.push(f)}"index"!==a&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],i=t.split(" "),r=0;r<i.length;r++){var s=i[r].split(",");e.push({x:parseFloat(s[0]),y:parseFloat(s[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getNameWithPostfix=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.length;return t.substring(e,i)},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.lastIndexOf(".");return i=i<0?t.length:i,t.substring(e,i)},h(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}},{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),Tt=t("TiledTile",(ut=l("cc.TiledTile"),ft=p(N),gt=u(c),dt=u(c),_t=u(c),pt=u(c),ct=u(c),ut(mt=ft((yt=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,e._x=vt&&vt(),e._y=At&&At(),e}f(e,t);var i=e.prototype;return i.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this.node.on(I.TRANSFORM_CHANGED,this._updatePosition,this),this.node.on(I.SIZE_CHANGED,this._updatePosition,this),this._resetTile(),this.updateInfo()},i.onDisable=function(){this._resetTile(),this.node.off(I.TRANSFORM_CHANGED,this._updatePosition,this),this.node.off(I.SIZE_CHANGED,this._updatePosition,this)},i._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},i.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))g("There is already a TiledTile at [%s, %s]",t,e);else{var i=this._layer.getPositionAt(t,e);this.node.setPosition(i.x,i.y),this._layer.setTiledTileAt(t,e,this),this._layer.markForUpdateRenderData()}}},i._updatePosition=function(){this._layer.markForUpdateRenderData()},h(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?g("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?g("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}(C),vt=d(yt.prototype,"_x",[gt],(function(){return 0})),At=d(yt.prototype,"_y",[dt],(function(){return 0})),_(yt.prototype,"x",[_t],Object.getOwnPropertyDescriptor(yt.prototype,"x"),yt.prototype),_(yt.prototype,"y",[pt],Object.getOwnPropertyDescriptor(yt.prototype,"y"),yt.prototype),_(yt.prototype,"grid",[ct],Object.getOwnPropertyDescriptor(yt.prototype,"grid"),yt.prototype),mt=yt))||mt)||mt));function bt(t,e,i){var r=i||t.sourceImage,s=r.texture,o=t.collection;if(!t.imageSize.width||!t.imageSize.height){var a=t.sourceImage;t.imageSize.width=a.width,t.imageSize.height=a.height}var h=t.imageSize.width,l=t.imageSize.height,u=t._tileSize.width,f=t._tileSize.height,g=r.width,d=r.height,_=t.spacing,p=t.margin,c=1;if(!o){var m=Math.floor((h-2*p+_)/(u+_)),y=Math.floor((l-2*p+_)/(f+_));c=Math.max(1,y*m)}for(var v=t.firstGid,A=null,w=!!e.get(v),S=t.firstGid+c,x=v;x<S&&(w&&!e.get(x)&&(w=!1),w||!e.get(x));++x){if(A={tileset:t,x:0,y:0,width:u,height:f,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:x,spriteFrame:r,texture:s},t.rectForGID(x,A),!i||c>1||t.imageOffset)if(i){A._name=i.name;var T=i.unbiasUV[0],b=i.rotated?i.unbiasUV[1]:i.unbiasUV[5];A.l=T+(A.x+.5)/g,A.t=b+(A.y+.5)/d,A.r=T+(A.x+A.width-.5)/g,A.b=b+(A.y+A.height-.5)/d,A._rect=new n(A.x,A.y,A.width,A.height)}else A.l=A.x/g,A.t=A.y/d,A.r=(A.x+A.width)/g,A.b=(A.y+A.height)/d,A._rect=new n(A.x,A.y,A.width,A.height);else i.rotated?(A._rotated=!0,A._name=i.name,A._rect=i.getRect(),A.l=i.unbiasUV[0],A.t=i.unbiasUV[1],A.r=i.unbiasUV[4],A.b=i.unbiasUV[3]):(A._name=i.name,A._rect=i.getRect(),A.l=i.unbiasUV[0],A.t=i.unbiasUV[5],A.r=i.unbiasUV[2],A.b=i.unbiasUV[1]);A.cx=(A.l+A.r)/2,A.cy=(A.t+A.b)/2,e.set(x,A)}}for(var It,Ct,Dt,Nt,Ot,Et,Pt,Gt,Ft,Lt,zt,Rt,Mt,Xt,Ut,Ht,jt,Bt,kt,Yt,Vt,Zt,Kt,Wt,qt,Jt,$t,Qt,te,ee,ie,re,se=new m,ne=new i,oe=new y,ae=new y,he={row:0,col:0},le=t("TiledUserNodeData",l("cc.TiledUserNodeData")(wt=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return f(e,t),e}(C))||wt),ue=t("TiledLayer",l("cc.TiledLayer")(St=function(t){f(r,t);var e=r.prototype;function r(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._tiledDataArray=[],e._cameraNode=void 0,e._drawInfoList=[],e._tiledDataArrayIdx=0,e}return e.requestDrawInfo=function(t){return this._drawInfoList[t]||(this._drawInfoList[t]=new O,this._drawInfoList[t].setDrawInfoType(E.MIDDLEWARE)),this._drawInfoList[t]},e.hasTiledNode=function(){return this._hasTiledNodeGrid},e.hasAnimation=function(){return this._hasAniGrid},e.addUserNode=function(t){var e=t.getComponent(le);return e?(g("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(le),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),ne),this._positionToRowCol(ne.x,ne.y,he),this._addUserNodeToGrid(e,he),this._updateCullingOffsetByUserNode(t),t.on(I.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(I.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},e.removeUserNode=function(t){var e=t.getComponent(le);return e?(t.off(I.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(I.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(g("CCTiledLayer:removeUserNode node is not exist"),!1)},e.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},e._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},e.getNodesByRowCol=function(t,e){var i=this._userNodeGrid[t];return i?i[e]:null},e.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},e._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),ne),this._positionToRowCol(ne.x,ne.y,he),this._addUserNodeToGrid(e,he),this._updateCullingOffsetByUserNode(e.node)}},e._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},e._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},e._userNodePosChange=function(){var t=this,e=t.node,i=t._tiledLayer;i._nodeLocalPosToLayerPos(e.getPosition(),ne),i._positionToRowCol(ne.x,ne.y,he),i._limitInLayer(he),he.row===t._row&&he.col===t._col||(i._removeUserNodeFromGrid(t),i._addUserNodeToGrid(t,he))},e._removeUserNodeFromGrid=function(t){var e=t._row,i=t._col,r=t._index,s=this._userNodeGrid[e],n=s&&s[i];n&&(s.count--,n.count--,n.list[r]=null,n.count<=0&&(n.list.length=0,n.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},e._limitInLayer=function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},e._addUserNodeToGrid=function(t,e){var i=e.row,r=e.col,s=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},n=s[r]=s[r]||{count:0,list:[]};t._row=i,t._col=r,t._index=n.list.length,s.count++,n.count++,n.list.push(t),this._userNodeDirty=!0},e.isUserNodeDirty=function(){return this._userNodeDirty},e.setUserNodeDirty=function(t){this._userNodeDirty=t},e._reinstallCamera=function(){var t=k.root.batcher2D.getFirstRenderCamera(this.node),e=null==t?void 0:t.node;return this._cameraNode!==e&&(this._uninstallCamera(),e&&(e.on(I.TRANSFORM_CHANGED,this.updateCulling,this),e.on(I.SIZE_CHANGED,this.updateCulling,this),this._cameraNode=e)),t},e._uninstallCamera=function(){this._cameraNode&&(this._cameraNode.off(I.TRANSFORM_CHANGED,this.updateCulling,this),this._cameraNode.off(I.SIZE_CHANGED,this.updateCulling,this),delete this._cameraNode)},e.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(I.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(I.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(I.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(I.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(I.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))},e.onDisable=function(){var e,i;t.prototype.onDisable.call(this),null===(e=this.node.parent)||void 0===e||e.off(I.SIZE_CHANGED,this.updateCulling,this),null===(i=this.node.parent)||void 0===i||i.off(I.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(I.SIZE_CHANGED,this.updateCulling,this),this.node.off(I.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(I.ANCHOR_CHANGED,this._syncAnchorPoint,this),this._uninstallCamera()},e._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,i=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*i.x,this._leftDownToCenterY=e.height*e.anchorY*i.y,this._cullingDirty=!0,this.markForUpdateRenderData()},e.getLayerName=function(){return this._layerName},e.setLayerName=function(t){this._layerName=t},e.getProperty=function(t){return this._properties[t]},e.getPositionAt=function(t,e){var i;switch(void 0!==e?(i=Math.floor(t),e=Math.floor(e)):(i=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case W.ORTHO:return this._positionForOrthoAt(i,e);case W.ISO:return this._positionForIsoAt(i,e);case W.HEX:return this._positionForHexAt(i,e)}return null},e.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},e._positionForIsoAt=function(t,e){var r=0,s=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=this.tiles[n];if(o){var a=(o&J.FLIPPED_MASK)>>>0,h=this.texGrids.get(a).tileset.tileOffset;r=h.x,s=h.y}return new i(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+r,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-s)},e._positionForOrthoAt=function(t,e){var r=0,s=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=this.tiles[n];if(o){var a=(o&J.FLIPPED_MASK)>>>0,h=this.texGrids.get(a).tileset.tileOffset;r=h.x,s=h.y}return new i(t*this._mapTileSize.width+r,(this._layerSize.height-e-1)*this._mapTileSize.height-s)},e._positionForHexAt=function(t,e){var r,s=this._mapTileSize.width,n=this._mapTileSize.height,o=this._layerSize.height,a=Math.floor(t)+Math.floor(e)*this._layerSize.width,h=(this.tiles[a]&J.FLIPPED_MASK)>>>0;r=this.texGrids.get(h)?this.texGrids.get(h).tileset.tileOffset:{x:0,y:0};var l=this._staggerIndex===Q.STAGGERINDEX_ODD?1:-1,u=0,f=0,g=0,d=0;switch(this._staggerAxis){case $.STAGGERAXIS_Y:g=0,e%2==1&&(g=s/2*l),u=t*s+g+r.x,f=(o-e-1)*(n-(n-this._hexSideLength)/2)-r.y;break;case $.STAGGERAXIS_X:d=0,t%2==1&&(d=n/2*-l),u=t*(s-(s-this._hexSideLength)/2)+r.x,f=(o-e-1)*n+d-r.y}return new i(u,f)},e.setTilesGIDAt=function(t,e,i,r){if(t&&0!==t.length&&!(r<=0)){i<0&&(i=0),e<0&&(e=0);for(var s=0,n=e+r,o=i;;o++)for(var a=e;a<n;a++){if(s>=t.length)return;this._updateTileForGID(t[s],a,o),s++}}},e.setTileGIDAt=function(t,e,i,r){var s=(t&J.FLIPPED_MASK)>>>0;if(e=Math.floor(e),i=Math.floor(i),this.isInvalidPosition(e,i))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==s&&s<this._tilesets[0].firstGid?o(7239,t):(r=r||0,this._updateTileForGID((s|r)>>>0,e,i)):o(7238)},e._updateTileForGID=function(t,e,i){var r=0|e+i*this._layerSize.width;if(!(r>=this.tiles.length)&&t!==this.tiles[r]){var s=(t&J.FLIPPED_MASK)>>>0;this.texGrids.get(s)?(this.tiles[r]=t,this._updateVertex(e,i)):this.tiles[r]=0,this._cullingDirty=!0}},e.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return o(7237),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&J.FLIPPED_MASK)>>>0},e.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return o(7240),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&J.FLIPPED_ALL)>>>0},e.setCullingDirty=function(t){this._cullingDirty=t},e.isCullingDirty=function(){return this._cullingDirty},e.updateViewPort=function(t,e,i,r){if(this._viewPort.width!==i||this._viewPort.height!==r||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=r;var s=1;this._layerOrientation===W.ISO&&(s=2);var n=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,a=n-this._leftOffset,h=o-this._downOffset,l=n+i+this._rightOffset,u=o+r+this._topOffset,f=this._cullingRect.leftDown,g=this._cullingRect.rightTop;a<0&&(a=0),h<0&&(h=0),this._positionToRowCol(a,h,he),he.row-=s,he.col-=s,he.row=he.row>0?he.row:0,he.col=he.col>0?he.col:0,he.row===f.row&&he.col===f.col||(f.row=he.row,f.col=he.col,this._cullingDirty=!0),l<0||u<0?(he.row=-1,he.col=-1):(this._positionToRowCol(l,u,he),he.row++,he.col++),he.row===g.row&&he.col===g.col||(g.row=he.row,g.col=he.col,this._cullingDirty=!0),this._cullingDirty&&this.markForUpdateRenderData()}},e._positionToRowCol=function(t,e,i){var r=this._mapTileSize.width,s=this._mapTileSize.height,n=.5*r,o=.5*s,a=0,h=0,l=0,u=0,f=this._staggerAxis;switch(this._layerOrientation){case W.ORTHO:h=Math.floor(t/r),a=Math.floor(e/s);break;case W.ISO:h=Math.floor(t/n),a=Math.floor(e/o);break;case W.HEX:f===$.STAGGERAXIS_Y?(l=(a=Math.floor(e/(s-this._diffY1)))%2==1?n*this._odd_even:0,h=Math.floor((t-l)/r)):(u=(h=Math.floor(t/(r-this._diffX1)))%2==1?o*-this._odd_even:0,a=Math.floor((e-u)/s))}return i.row=a,i.col=h,i},e.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),m.invert(se,this.node.getWorldMatrix());var t=this._reinstallCamera();t&&(oe.x=0,oe.y=0,oe.z=0,ae.x=t.width,ae.y=t.height,ae.z=0,t.screenToWorld(oe,oe),t.screenToWorld(ae,ae),y.transformMat4(oe,oe,se),y.transformMat4(ae,ae,se),this.updateViewPort(oe.x,oe.y,ae.x-oe.x,ae.y-oe.y))}},e.getLayerOrientation=function(){return this._layerOrientation},e.getProperties=function(){return this._properties},e._updateVertex=function(t,e){var i=J.FLIPPED_MASK,r=this.vertices,s=this._layerOrientation,n=this.tiles;if(n){var o,a,h,l,u=this._rightTop,f=this._mapTileSize.width,g=this._mapTileSize.height,d=.5*f,_=.5*g,p=this._layerSize.height,c=this._layerSize.width,m=this.texGrids,y=0,v=0;s===W.HEX&&(o=this._staggerAxis,a=this._diffX1,h=this._diffY1,l=this._odd_even);var A,w,S,x=0,T=0,b=0,I=0,C=e*c+t;A=(n[C]&i)>>>0;var D=m.get(A);if(D){switch(this._animations.get(A)&&(this._hasAniGrid=this._hasAniGrid||!0),s){case W.ORTHO:y=(x=t)*f,v=(T=p-e-1)*g;break;case W.ISO:y=d*(x=p+t-e-1),v=_*(T=p+c-t-e-2);break;case W.HEX:y=t*(f-a)+(o===$.STAGGERAXIS_Y&&e%2==1?d*l:0),v=(p-e-1)*(g-h)+(o===$.STAGGERAXIS_X&&t%2==1?_*-l:0),x=t,T=p-e-1}var N=r[T]=r[T]||{minCol:0,maxCol:0},O=N[x]=N[x]||{left:0,bottom:0,index:0};N.minCol>x&&(N.minCol=x),N.maxCol<x&&(N.maxCol=x),u.row<T&&(u.row=T,s===W.ISO&&(u.row+=1)),u.col<x&&(u.col=x,s===W.ISO&&(u.col+=1));var E=D.tileset.tileOffset;y+=this._offset.x+E.x+D.offsetX,v+=this._offset.y-E.y-D.offsetY,b=(b=-E.y+D.tileset._tileSize.height-g)<0?0:b,w=E.y<0?0:E.y,S=-E.x<0?0:-E.x,I=(I=E.x+D.tileset._tileSize.width-f)<0?0:I,this._rightOffset<S&&(this._rightOffset=S),this._leftOffset<I&&(this._leftOffset=I),this._topOffset<w&&(this._topOffset=w),this._downOffset<b&&(this._downOffset=b),O.left=y,O.bottom=v,O.index=C,this._cullingDirty=!0}}},e._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,i=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var r=0;r<e;++r)for(var s=0;s<i;++s)this._updateVertex(s,r);this._verticesDirty=!1}},e.getTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return o(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=this.tiledTiles[r];if(!s&&i){var n=new Y;return(s=n.addComponent(Tt))._x=t,s._y=e,s._layer=this,s.updateInfo(),n.parent=this.node,s}return s},e.setTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return o(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[r]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this.tiledTiles.some((function(t){return!!t})),i},e.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},e.getTextures=function(){return this._textures},e.setTexture=function(t){this.setTextures([t])},e.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},e.getLayerSize=function(){return this._layerSize},e.getMapTileSize=function(){return this._mapTileSize},e.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},e.getTileSets=function(){return this._tilesets},e.setTileSet=function(t){this.setTileSets([t])},e.setTileSets=function(t){this._tilesets=t;var e=this._textures=[],i=this.texGrids;i.clear();for(var r=0;r<t.length;r++){var s=t[r];s&&(e[r]=s.sourceImage)}for(var n=0,o=t.length;n<o;++n){var a=t[n];a&&bt(a,i,a.sourceImage)}this._prepareToRender()},e.init=function(t,e,r,s,n){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var o=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=o,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=r,this._textures=s,this.texGrids=n,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var a=this._mapTileSize.width,h=this._mapTileSize.height,l=this._layerSize.width,u=this._layerSize.height;if(this._layerOrientation===W.HEX){var f=0,g=0,d=-2&a,_=-2&h;this._odd_even=this._staggerIndex===Q.STAGGERINDEX_ODD?1:-1,this._staggerAxis===$.STAGGERAXIS_X?(this._diffX1=(d-this._hexSideLength)/2,this._diffY1=0,f=(this._diffX1+this._hexSideLength)*l+this._diffX1,g=_*u+_/2):(this._diffX1=0,this._diffY1=(_-this._hexSideLength)/2,f=d*l+d/2,g=(this._diffY1+this._hexSideLength)*u+this._diffY1),this.node._uiProps.uiTransformComp.setContentSize(f,g)}else if(this._layerOrientation===W.ISO){var p=l+u;this.node._uiProps.uiTransformComp.setContentSize(.5*a*p,.5*h*p)}else this.node._uiProps.uiTransformComp.setContentSize(l*a,u*h);this._offset=new i(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},e._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},e.requestTiledRenderData=function(){for(var t=this._tiledDataArray;t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length;)t.pop();if(t.length>0){var e=t[t.length-1];if(e.renderData&&0===e.renderData.vertexCount)return e}var i={renderData:null,texture:null};return this._tiledDataArray.push(i),i},e.requestSubNodesData=function(){var t=this._tiledDataArray;if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._tiledDataArray.push(e),e},e.destroyRenderData=function(){this._tiledDataArray.forEach((function(t){var e=t.renderData;e&&P.remove(e)})),this._tiledDataArray.length=0,t.prototype.destroyRenderData.call(this)},e._flushAssembler=function(){var t=r.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t,this._assembler.createData(this)),0===this._tiledDataArray.length&&(this.markForUpdateRenderData(),this._updateColor())},e._render=function(t){for(var e=0;e<this._tiledDataArray.length;e++){this._tiledDataArrayIdx=e;var i=this._tiledDataArray[e];if(i.subNodes)i.subNodes.forEach((function(e){e&&t.walk(e.node)}));else{var r=i;r.texture&&t.commitComp(this,r.renderData,r.texture,this._assembler,null)}}this.node._static=!0},e.createRenderEntity=function(){return new G(F.CROSSED)},e.fillIndicesBuffer=function(t,e){var i=t.chunk.meshBuffer.iData,r=t.chunk.meshBuffer.indexOffset;e.setIndexOffset(r);for(var s=t.chunk.vertexOffset,n=t.vertexCount/4,o=0;o<n;o+=1)i[r]=s,i[r+1]=s+1,i[r+2]=s+2,i[r+3]=s+2,i[r+4]=s+1,i[r+5]=s+3,r+=6,s+=4;t.chunk.meshBuffer.indexOffset=r,e.setIBCount(6*n)},e.prepareDrawData=function(){var t=this;this._drawInfoList.length=0;var e=this.renderEntity;e.clearDynamicRenderDrawInfos();var i=this._tiledDataArray,r=0;i.forEach((function(i){if(i.subNodes)i.subNodes.forEach((function(i){if(i){t._drawInfoList[r]||(t._drawInfoList[r]=new O);var s=t._drawInfoList[r];s.setDrawInfoType(E.SUB_NODE),s.setSubNode(i.node),e.setDynamicRenderDrawInfo(s,r),r++}}));else{var s=i;if(s.texture){t._drawInfoList[r]||(t._drawInfoList[r]=new O);var n=t._drawInfoList[r];s.renderData.fillDrawInfoAttributes(n),n.setTexture(s.texture.getGFXTexture()),n.setSampler(s.texture.getGFXSampler()),n.setMaterial(t.getRenderMaterial(0)),t.fillIndicesBuffer(s.renderData,n),e.setDynamicRenderDrawInfo(n,r),r++}}}))},h(r,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"tiledDataArray",get:function(){return this._tiledDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this.markForUpdateRenderData())}}]),r}(L))||St),fe=t("TiledObjectGroup",(It=l("cc.TiledObjectGroup"),Ct=p(N),Dt=u(A),It(Nt=Ct((Ot=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}f(e,t);var s=e.prototype;return s.getPositionOffset=function(){return this._positionOffset},s.getProperties=function(){return this._properties},s.getGroupName=function(){return this._groupName},s.getProperty=function(t){return this._properties[t.toString()]},s.getObject=function(t){for(var e=0,i=this._objects.length;e<i;e++){var r=this._objects[e];if(r&&r.name===t)return r}return null},s.getObjects=function(){return this._objects},s._init=function(t,e,s){var n=J.FLIPPED_MASK,o=J.HORIZONTAL,a=J.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new i(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=s,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var h=e.mapSize,l=e.tileSize,u=0,f=0,g=new r,d=W.ISO===e.orientation;if(e.orientation===W.HEX)e.getStaggerAxis()===$.STAGGERAXIS_X?(f=l.height*(h.height+.5),u=(l.width+e.getHexSideLength())*Math.floor(h.width/2)+l.width*(h.width%2)):(u=l.width*(h.width+.5),f=(l.height+e.getHexSideLength())*Math.floor(h.height/2)+l.height*(h.height%2));else if(d){var _=h.width+h.height;u=.5*l.width*_,f=.5*l.height*_}else u=h.width*l.width,f=h.height*l.height;var p=this.node._uiProps.uiTransformComp;p.setContentSize(u,f);for(var c=u*p.anchorX,m=f*(1-p.anchorY),y=t.objects,A={},w=0,S=y.length;w<S;w++){var x=y[w],T=x.type;x.offset=new i(x.x,x.y);var b=x.points||x.polylinePoints;if(b)for(var I=0;I<b.length;I++)b[I].y*=-1;if(d){var C=x.x/l.height,D=x.y/l.height;x.x=.5*l.width*(h.height+C-D),x.y=.5*l.height*(h.width+h.height-C-D)}else x.y=f-x.y;if(T===et.TEXT){var N="text"+x.id;A[N]=!0;var O=this.node.getChildByName(N);O||(O=new Y),O.setRotationFromEuler(0,0,-x.rotation),O.setPosition(x.x-c,x.y-m),O.name=N,O.parent=this.node,O.setSiblingIndex(w),O.layer=this.node.layer;var E=O.getComponent(X);E||(E=O.addComponent(X));var P=O._uiProps.uiTransformComp;O.active=x.visible,P.anchorX=0,P.anchorY=1,this._tintColor?(g.set(this._tintColor),g.a*=this._opacity/255,E.color.set(g)):E.color.a*=this._opacity/255,E.overflow=X.Overflow.SHRINK,E.lineHeight=x.height,E.string=x.text,E.horizontalAlign=x.halign,E.verticalAlign=x.valign,E.fontSize=x.pixelsize,P.setContentSize(x.width,x.height)}else if(T===et.IMAGE){var G=x.gid,F=(G&n)>>>0,L=s.get(F);if(!L)continue;var R=L.tileset,M="img"+x.id;A[M]=!0;var H=this.node.getChildByName(M);x.width=x.width||L.width,x.height=x.height||L.height,H&&H._objFlags&v.Flags.HideInHierarchy&&(H.removeFromParent(),H.hideFlags|=v.Flags.DontSave,H.destroy(),H=null),H||(H=new Y),this._animations.get(F)&&(this.aniObjects.push({object:x,imgNode:H,gridGID:F}),this._hasAniObj=!0);var j=R.tileOffset.x,B=R.tileOffset.y;H.active=x.visible,H.setRotationFromEuler(0,0,-x.rotation),H.setPosition(x.x-c,x.y-m),H.name=M,H.parent=this.node,H.setSiblingIndex(w),H.layer=this.node.layer;var k=H.getComponent(U);k||(k=H.addComponent(U));var V=H._uiProps.uiTransformComp;d?(V.anchorX=.5+j/x.width,V.anchorY=B/x.height):(V.anchorX=j/x.width,V.anchorY=B/x.height),this._tintColor?(g.set(this._tintColor),g.a*=this._opacity/255,k.color.set(g)):k.color.a*=this._opacity/255,k.sizeMode=U.SizeMode.CUSTOM;var Z=this._premultiplyAlpha?K.ONE:K.SRC_ALPHA;k.srcBlendFactor!==Z&&(k.srcBlendFactor=Z,k.material&&k._updateBlendFunc());var q=L.spriteFrame;q=q?q.clone():new z,(G&o)>>>0&&(q.flipUVX=!q.flipUVX),(G&a)>>>0&&(q.flipUVY=!q.flipUVY),q.rotated=L._rotated,q.rect=L._rect,k.spriteFrame=q,V.setContentSize(x.width,x.height),k.markForUpdateRenderData()}}this._objects=y;for(var Q=this.node.children,tt=/^(?:img|text)\d+$/,it=0,rt=Q.length;it<rt;it++){var st=Q[it],nt=st.name;tt.test(nt)&&!A[nt]&&st.destroy()}},s.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,i=W.ISO===this._mapInfo.orientation,r=0,s=t.length;r<s;r++){var n=t[r],o=n.gridGID,a=e.get(o);if(a){var h=a.tileset,l=n.object,u=n.imgNode,f=h.tileOffset.x,g=h.tileOffset.y,d=u._uiProps.uiTransformComp;i?(d.anchorX=.5+f/l.width,d.anchorY=g/l.height):(d.anchorX=f/l.width,d.anchorY=g/l.height);var _=u.getComponent(U),p=_.spriteFrame;p.rotated=a._rotated,p.rect=a._rect,_.spriteFrame=p,_.markForUpdateRenderData()}}},h(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}(C),_(Ot.prototype,"premultiplyAlpha",[Dt],Object.getOwnPropertyDescriptor(Ot.prototype,"premultiplyAlpha"),Ot.prototype),Nt=Ot))||Nt)||Nt)),ge=t("TiledMapAsset",(Et=l("cc.TiledMapAsset"),Pt=u([V]),Gt=u([w]),Ft=u([z]),Lt=u([z]),zt=u([w]),Rt=u([w]),Mt=u([s]),Et((Ut=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this).tmxXmlStr=Ht&&Ht(),e.tsxFiles=jt&&jt(),e.tsxFileNames=Bt&&Bt(),e.spriteFrames=kt&&kt(),e.imageLayerSpriteFrame=Yt&&Yt(),e.imageLayerSpriteFrameNames=Vt&&Vt(),e.spriteFrameNames=Zt&&Zt(),e.spriteFrameSizes=Kt&&Kt(),e}return f(e,t),e}(D),Ht=d(Ut.prototype,"tmxXmlStr",[S],(function(){return""})),jt=d(Ut.prototype,"tsxFiles",[S,Pt],(function(){return[]})),Bt=d(Ut.prototype,"tsxFileNames",[S,Gt],(function(){return[]})),kt=d(Ut.prototype,"spriteFrames",[S,Ft],(function(){return[]})),Yt=d(Ut.prototype,"imageLayerSpriteFrame",[S,Lt],(function(){return[]})),Vt=d(Ut.prototype,"imageLayerSpriteFrameNames",[S,zt],(function(){return[]})),Zt=d(Ut.prototype,"spriteFrameNames",[S,Rt],(function(){return[]})),Kt=d(Ut.prototype,"spriteFrameSizes",[S,Mt],(function(){return[]})),Xt=Ut))||Xt)),de=(t("TiledMap",(Wt=l("cc.TiledMap"),qt=p(N),Jt=u(ge),Wt($t=qt(((re=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new s(0,0),e._tileSize=new s(0,0),e._mapOrientation=W.ORTHO,e._isApplied=!1,e._tmxFile=te&&te(),e._enableCulling=ee&&ee(),e.cleanupImageCache=ie&&ie(),e}f(e,t);var r=e.prototype;return r.getMapSize=function(){return this._mapSize},r.getTileSize=function(){return this._tileSize},r.getMapOrientation=function(){return this._mapOrientation},r.getObjectGroups=function(){return this._groups},r.getObjectGroup=function(t){for(var e=this._groups,i=0,r=e.length;i<r;i++){var s=e[i];if(s&&s.getGroupName()===t)return s}return null},r.getProperties=function(){return this._properties},r.getLayers=function(){return this._layers},r.getLayer=function(t){for(var e=this._layers,i=0,r=e.length;i<r;i++){var s=e[i];if(s&&s.getLayerName()===t)return s}return null},r._changeLayer=function(t,e){for(var i=this._layers,r=0,s=i.length;r<s;r++){var n=i[r];if(n&&n.getLayerName()===t)return void(i[r]=e)}},r.getProperty=function(t){return this._properties[t.toString()]},r.getPropertiesForGID=function(t){return this._tileProperties.get(t)},r.__preload=function(){this._tmxFile&&!1===this._isApplied&&(this._applyFile(),this._isApplied=!0)},r.onEnable=function(){this.node.on(I.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r.onDisable=function(){this.node.off(I.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r._applyFile=function(){var t=[],e={},i=this._tmxFile;if(i){for(var r=i.spriteFrameNames,s=i.spriteFrameSizes,n=i.spriteFrames,a={},h={},l=0;l<r.length;++l){var u=r[l];h[u]=s[l],t[l]=n[l];var f=t[l];f&&(e[f.name]=f,a[u]=f)}var g={},d=i.imageLayerSpriteFrame;r=i.imageLayerSpriteFrameNames;for(var _=0;_<d.length;++_)g[r[_]]=d[_];for(var p=i.tsxFileNames,c=i.tsxFiles,m={},y=0;y<p.length;++y)p[y].length>0&&(m[p[y]]=c[y].text);var v=new xt(i.tmxXmlStr,m,a,h,g),A=v.getTilesets();A&&0!==A.length||o(7241),this._buildWithMapInfo(v)}else this._releaseMapInfo()},r._releaseMapInfo=function(){for(var t=this._layers,e=0,i=t.length;e<i;e++){var r,s;null===(r=t[e].node.parent)||void 0===r||r.off(I.SIZE_CHANGED,t[e].updateCulling,t[e]),null===(s=t[e].node.parent)||void 0===s||s.off(I.TRANSFORM_CHANGED,t[e].updateCulling,t[e]),t[e].node.removeFromParent(),t[e].node.destroy()}t.length=0;for(var n=this._groups,o=0,a=n.length;o<a;o++)n[o].node.removeFromParent(),n[o].node.destroy();n.length=0;for(var h=this._images,l=0,u=h.length;l<u;l++)h[l].removeFromParent(),h[l].destroy();h.length=0},r._syncAnchorPoint=function(){var t,e,i=this.node._uiProps.uiTransformComp.anchorPoint,r=this.node._uiProps.uiTransformComp.width*i.x,s=this.node._uiProps.uiTransformComp.height*(1-i.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(i);for(t=0,e=this._groups.length;t<e;t++){var n=this._groups[t],o=n.node._uiProps.uiTransformComp;o.anchorX=.5,o.anchorY=.5;var a=n.offset.x-r+o.width*o.anchorX,h=n.offset.y+s-o.height*o.anchorY;n.node.setPosition(a,h)}for(t=0,e=this._images.length;t<e;t++){var l=this._images[t]._uiProps.uiTransformComp;l.anchorX=.5,l.anchorY=.5;var u=this._images[t]._offset.x-r+l.width*l.anchorX,f=this._images[t]._offset.y+s-l.height*l.anchorY;this._images[t].setPosition(u,f)}},r._fillAniGrids=function(t,e){for(var i,r=x(e.keys());!(i=r()).done;){var s=i.value,n=e.get(s);if(n)for(var o=n.frames,a=0;a<o.length;a++){var h=o[a];h.grid=t.get(h.tileid)}}},r._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,r=this._animations;e.clear();for(var s=0,n=t.length;s<n;++s){var o=t[s];o&&(o.sourceImage?bt(o,e,o.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+s))}this._fillAniGrids(e,r);for(var a=this._layers,h=this._groups,l=this._images,u={},f=0,g=a.length;f<g;f++)u[a[f].node.name]=!0;for(var d=0,_=h.length;d<_;d++)u[h[d].node.name]=!0;for(var p=0,c=l.length;p<c;p++)u[l[p].name]=!0;a=this._layers=[],h=this._groups=[],l=this._images=[];var m=this._mapInfo,y=this.node,v=m.getAllChildren(),A=this._textures,w=0,S=0;if(v&&v.length>0)for(var x=0,T=v.length;x<T;x++){var b=v[x],I=b.name,C=this.node.getChildByName(I);if(u[I]=!1,C||((C=new Y).name=I,C.layer=y.layer,y.addChild(C)),C.setSiblingIndex(x),C.active=b.visible,b instanceof st){var D=C.getComponent(ue);D||(D=C.addComponent(ue)),D.init(b,m,t,A,e),D.enableCulling=this._enableCulling,b.ownTiles=!1,a.push(D)}else if(b instanceof rt){var N=C.getComponent(fe);N||(N=C.addComponent(fe)),N._init(b,m,e),h.push(N)}else if(b instanceof nt){var O=b.sourceImage;C.layerInfo=b,C._offset=new i(b.offset.x,-b.offset.y);var E=C.getComponent(U);E||(E=C.addComponent(U)),E.color.a*=b.opacity,E.spriteFrame=O;var P=O.width,G=O.height;O.original&&(P=O.originalSize.width,G=O.originalSize.height),C._uiProps.uiTransformComp.setContentSize(P,G),l.push(C)}w=Math.max(w,C._uiProps.uiTransformComp.width),S=Math.max(S,C._uiProps.uiTransformComp.height)}for(var F=y.children,L=0,z=F.length;L<z;L++){var R=F[L];u[R.name]&&R.destroy()}this.node._uiProps.uiTransformComp.setContentSize(w,S),this._syncAnchorPoint()},r._buildWithMapInfo=function(t){var e=this;this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var i=this._tilesets;this._textures.length=0;for(var r=[],s=0,n=i.length;s<n;++s){var o=i[s];o&&o.sourceImage&&(this._textures[s]=o.sourceImage,r.push(o.sourceImage))}for(var a=0;a<this._imageLayers.length;a++){var h=this._imageLayers[a];h&&h.sourceImage&&r.push(h.sourceImage)}this._buildLayerAndGroup(),this.cleanupImageCache&&this._textures.forEach((function(t){e.doCleanupImageCache(t)}))},r.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":T.hasFeature(T.Feature.IMAGE_BITMAP)&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},r.lateUpdate=function(t){for(var e,i=this._animations,r=this._texGrids,s=x(i.keys());!(e=s()).done;){var n=e.value,o=i.get(n),a=o.frames,h=a[o.frameIdx];o.dt+=t,h.duration<o.dt&&(o.dt=0,o.frameIdx++,o.frameIdx>=a.length&&(o.frameIdx=0),h=a[o.frameIdx]),r.set(n,h.grid)}for(var l=this.getLayers(),u=0,f=l.length;u<f;u++){var g=l[u];(g.hasAnimation()||g.node.hasChangedFlags)&&g.markForUpdateRenderData()}},h(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){(this._tmxFile!==t||b)&&(this._tmxFile=t,this._applyFile(),this._isApplied=!0)}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling=t}}]),e}(C)).Orientation=W,re.Property=q,re.TileFlag=J,re.StaggerAxis=$,re.StaggerIndex=Q,re.TMXObjectType=et,re.RenderOrder=tt,te=d((Qt=re).prototype,"_tmxFile",[S],(function(){return null})),_(Qt.prototype,"tmxAsset",[Jt],Object.getOwnPropertyDescriptor(Qt.prototype,"tmxAsset"),Qt.prototype),ee=d(Qt.prototype,"_enableCulling",[S],(function(){return!0})),ie=d(Qt.prototype,"cleanupImageCache",[S],(function(){return!0})),$t=Qt))||$t)||$t)),Math.ceil(10922.5)),_e=[],pe=0;pe<4;pe++)_e.push(new y);var ce,me,ye,ve=new m,Ae=new y,we={row:0,col:0},Se={x:0,y:0},xe={x:0,y:0},Te={x:0,y:0},be={x:0,y:0},Ie=0,Ce=0,De=0,Ne=0,Oe=null,Ee=null,Pe={ensureAccessor:function(){if(!Ee){var t=k.root.device;k.root.batcher2D,Ee=new R(t,M,this.vCount),k.on(Z.EVENT_BEFORE_DRAW,(function(){Ee.reset()}))}},createData:function(){},fillBuffers:function(t){if(t&&0!==t.tiledDataArray.length){for(var e=t.tiledDataArray[t._tiledDataArrayIdx].renderData,i=e.chunk.meshBuffer.iData,r=e.chunk.meshBuffer.indexOffset,s=e.chunk.vertexOffset,n=e.vertexCount/4,o=0;o<n;o+=1)i[r]=s,i[r+1]=s+1,i[r+2]=s+2,i[r+3]=s+2,i[r+4]=s+1,i[r+5]=s+3,r+=6,s+=4;e.chunk.meshBuffer.indexOffset=r}},updateRenderData:function(t){if(t.updateCulling(),Ce=t.leftDownToCenterX,De=t.leftDownToCenterY,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()||t.node.hasChangedFlags){var e,i;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var r=t.cullingRect;e=r.leftDown,i=r.rightTop}else e=we,i=t.rightTop;switch(t.renderOrder){case tt.RightDown:Le(e,i,-1,1,t);break;case tt.LeftDown:Le(e,i,-1,-1,t);break;case tt.RightUp:Le(e,i,1,1,t);break;case tt.LeftUp:default:Le(e,i,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}},updateColor:function(t){var e=t.color,i=new Float32Array(4);i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[3]=e.a/255;for(var r,s=t.tiledDataArray,n=x(s);!(r=n()).done;){var o=r.value;if(o.renderData)for(var a=o.renderData,h=a.vData,l=a.vertexStart,u=a.vertexCount;l<u;l++)h.set(i,9*l+5)}}};function Ge(t,e){var i;t._rotated?(Se.x=t.r,Se.y=t.t,xe.x=t.l,xe.y=t.t,Te.x=t.r,Te.y=t.b,be.x=t.l,be.y=t.b):(Se.x=t.l,Se.y=t.t,xe.x=t.l,xe.y=t.b,Te.x=t.r,Te.y=t.t,be.x=t.r,be.y=t.b),(e&J.DIAGONAL)>>>0&&(i=xe,xe=Te,Te=i),(e&J.HORIZONTAL)>>>0&&(i=Se,Se=Te,Te=i,i=xe,xe=be,be=i),(e&J.VERTICAL)>>>0&&(i=Se,Se=xe,xe=i,i=Te,Te=be,be=i)}function Fe(){if(!(Ne<1)&&Oe){var t=4*Ne,e=6*Ne,i=me.requestTiledRenderData();i.renderData=P.add(M),i.texture=Oe;var r=i.renderData;r.resize(t,e),r.chunk.vb.set(ce.subarray(0,9*t),0),Ne=0,Oe=null}}function Le(t,e,i,r,s){if(!(e.row<0||e.col<0)){me=s;var n=s.node.worldMatrix;Ie=0;var o,a,h,l,u,f,g,d,_,p=s.tiledTiles,c=s.texGrids,m=s.tiles,y=18,v=27,A=s.vertices,w=0,S=0,x=0,T=0,b=0,I=0,C=!0;ye=Ge;var D=new Float32Array(4);D[0]=s.color.r/255,D[1]=s.color.g/255,D[2]=s.color.b/255,D[3]=s.color.a/255,-1===i?(l=e.row,u=t.row):(l=t.row,u=e.row);var N=Math.abs(t.row-e.row)+1,O=Math.abs(e.col-t.col)+1;ce=new Float32Array(N*O*36),Ne=0;for(var E=ce;(u-l)*i>=0;l+=i)for(o=A[l],I=s.getNodesCountByRow(l),C=o&&0===I,1===r?(a=C&&t.col<o.minCol?o.minCol:t.col,h=C&&e.col>o.maxCol?o.maxCol:e.col):(a=C&&e.col>o.maxCol?o.maxCol:e.col,h=C&&t.col<o.minCol?o.minCol:t.col);(h-a)*r>=0;a+=r){if(f=o&&o[a],I>0){Fe();var P=s.requestSubNodesData(),G=s.getNodesByRowCol(l,a);G&&G.count>0&&(P.subNodes=G.list)}f&&(w=m[f.index],(d=c.get((w&J.FLIPPED_MASK)>>>0))&&(Oe!==d.texture&&(Fe(),Oe=d.texture),g=d.tileset._tileSize,S=f.left-Ce,x=f.bottom-De,T=S+g.width,b=x+g.height,_=p[f.index],Ie=36*Ne,_?_.node.active&&ze(_.node,D,E,S,T,b,x,!1):(_e[0].x=S,_e[0].y=b,_e[1].x=S,_e[1].y=x,_e[2].x=T,_e[2].y=b,_e[3].x=T,_e[3].y=x,_e[0].transformMat4(n),E[Ie]=_e[0].x,E[Ie+1]=_e[0].y,E[Ie+2]=_e[0].z,_e[1].transformMat4(n),E[Ie+9]=_e[1].x,E[Ie+9+1]=_e[1].y,E[Ie+9+2]=_e[1].z,_e[2].transformMat4(n),E[Ie+y]=_e[2].x,E[Ie+y+1]=_e[2].y,E[Ie+y+2]=_e[2].z,_e[3].transformMat4(n),E[Ie+v]=_e[3].x,E[Ie+v+1]=_e[3].y,E[Ie+v+2]=_e[3].z,E.set(D,Ie+5),E.set(D,Ie+9+5),E.set(D,Ie+y+5),E.set(D,Ie+v+5)),ye(d,w),E[Ie+3]=Se.x,E[Ie+4]=Se.y,E[Ie+9+3]=xe.x,E[Ie+9+4]=xe.y,E[Ie+y+3]=Te.x,E[Ie+y+4]=Te.y,E[Ie+v+3]=be.x,E[Ie+v+4]=be.y,++Ne>=de&&Fe()))}Fe()}}function ze(t,e,i,r,s,n,o,a){var h=18,l=27;t.updateWorldTransform(),m.fromRTS(ve,t.rotation,t.position,t.scale),y.set(Ae,-(r+Ce),-(o+De),0),m.transform(ve,ve,Ae),m.multiply(ve,t.parent.worldMatrix,ve);var u=ve,f=u.m12,g=u.m13,d=u.m00,_=u.m01,p=u.m04,c=u.m05,v=1===d&&0===_&&0===p&&1===c;if(a){var A=(r+s)/2,w=(n+o)/2;v?(i[Ie]=A+f,i[Ie+1]=n+g,i[Ie+9]=r+f,i[Ie+9+1]=w+g,i[Ie+h]=s+f,i[Ie+h+1]=w+g,i[Ie+l]=A+f,i[Ie+l+1]=o+g):(i[Ie]=A*d+n*p+f,i[Ie+1]=A*_+n*c+g,i[Ie+9]=r*d+w*p+f,i[Ie+9+1]=r*_+w*c+g,i[Ie+h]=s*d+w*p+f,i[Ie+h+1]=s*_+w*c+g,i[Ie+l]=A*d+o*p+f,i[Ie+l+1]=A*_+o*c+g)}else v?(i[Ie]=r+f,i[Ie+1]=n+g,i[Ie+9]=r+f,i[Ie+9+1]=o+g,i[Ie+h]=s+f,i[Ie+h+1]=n+g,i[Ie+l]=s+f,i[Ie+l+1]=o+g):(i[Ie]=r*d+n*p+f,i[Ie+1]=r*_+n*c+g,i[Ie+9]=r*d+o*p+f,i[Ie+9+1]=r*_+o*c+g,i[Ie+h]=s*d+n*p+f,i[Ie+h+1]=s*_+n*c+g,i[Ie+l]=s*d+o*p+f,i[Ie+l+1]=s*_+o*c+g);i.set(e,Ie+5),i.set(e,Ie+9+5),i.set(e,Ie+h+5),i.set(e,Ie+l+5)}var Re=t("tiledLayerAssembler",{getAssembler:function(){return Pe}});ue.Assembler=Re}}}));
