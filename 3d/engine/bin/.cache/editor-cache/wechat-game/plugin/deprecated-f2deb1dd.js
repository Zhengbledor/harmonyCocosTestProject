System.register(["./index-d48cc0ba.js","./director-39a00fed.js","./node-event-2a6499e4.js","./sprite-renderer-a2b4676c.js","./pipeline-state-manager-1c54311a.js","./buffer-barrier-a01f2732.js","./deprecated-50ea3c1c.js","./sprite-af91df1a.js","./deprecated-653e59b0.js"],(function(t){"use strict";var e,i,n,s,o,r,a,h,l,c,u,p,f,_,d,m,g,y,C,b,v,T,E,S,x,R,L,A,I,D,O,P,k,w,M,N,H,F,z,W,U,B,G,j,X,V,Y,J,q,Q,Z,K,$,tt,et,it,nt,st,ot,rt,at,ht,lt,ct,ut,pt,ft,_t,dt,mt,gt;return{setters:[function(t){e=t.ae,i=t.bF,n=t.V,s=t.B,o=t.bE,r=t.bX,a=t.d,h=t.bC,l=t.bH,c=t.bh,u=t.bI,p=t.l,f=t.cy,_=t.c9,d=t.bj,m=t.t,g=t.o,y=t.J,C=t.e,b=t.i,v=t.cK,T=t.bN,E=t.av,S=t.w,x=t.cw,R=t.cL,L=t.cv,A=t.aj,I=t.al},function(t){D=t.aU,O=t.h,P=t.be,k=t.aY,w=t.bM,M=t.ax,N=t.bQ,H=t.a4},function(t){F=t.N,z=t.C},function(t){W=t.f,U=t.n,B=t.o,G=t.j,j=t.p,X=t.q,V=t.b,Y=t.I,J=t.l,q=t.c},function(t){Q=t.d,Z=t.j,K=t.b},function(t){$=t.aq,tt=t.b,et=t.a9,it=t.d,nt=t.f,st=t.v},function(){},function(t){ot=t.a,rt=t.b,t.T,at=t.j,ht=t.k,lt=t.l,ct=t.c,ut=t.i,pt=t.e,ft=t.H,_t=t.F,dt=t.V,mt=t.C,gt=t.S},function(){}],execute:function(){var yt,Ct,bt;t("e",yt),function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(yt||t("e",yt={})),e(yt),t("d",Ct),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(Ct||t("d",Ct={})),e(Ct),t("f",bt),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(bt||t("f",bt={})),e(bt);var vt=Math.PI,Tt=Math.min,Et=Math.max,St=Math.cos,xt=Math.sin,Rt=Math.abs,Lt=Math.sign,At=.5522847493;function It(t,e,i,n,s){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+s*At,e-n*At,i+s,e,i+s),t.bezierCurveTo(e+n*At,i+s,e+n,i+s*At,e+n,i),t.bezierCurveTo(e+n,i-s*At,e+n*At,i-s,e,i-s),t.bezierCurveTo(e-n*At,i-s,e-n,i-s*At,e-n,i),t.close()}function Dt(t,e,i,n,s,o,r,a,h,l,c){var u,p,f,_,d,m,g,y,C,b,v,T,E,S,x,R;l>10||(d=.5*(o+a),m=.5*(r+h),g=.5*((u=.5*(e+n))+(f=.5*(n+o))),y=.5*((p=.5*(i+s))+(_=.5*(s+r))),((x=Rt((n-a)*(S=h-i)-(s-h)*(E=a-e)))+(R=Rt((o-a)*S-(r-h)*E)))*(x+R)<t.tessTol*(E*E+S*S)?t.addPoint(a,h,0===c?c|bt.PT_BEVEL:c):(Dt(t,e,i,u,p,g,y,v=.5*(g+(C=.5*(f+d))),T=.5*(y+(b=.5*(_+m))),l+1,0),Dt(t,v,T,C,b,d,m,a,h,l+1,c)))}var Ot,Pt,kt,wt,Mt,Nt,Ht,Ft,zt,Wt,Ut,Bt,Gt,jt,Xt,Vt,Yt,Jt,qt,Qt,Zt,Kt,$t,te=t("P",function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).dx=0,e.dy=0,e.dmx=0,e.dmy=0,e.flags=0,e.len=0,e}return i(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(n)),ee=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[]}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points.length=0},t}(),ie=function(){function t(t){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=s.WHITE.clone(),this.lineCap=yt.BUTT,this.strokeColor=s.BLACK.clone(),this.lineJoin=Ct.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null,this._comp=void 0,this._comp=t}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,bt.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,bt.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,i,n,s,o){var r=this._curPath,a=r.points[r.points.length-1];a&&(a.x!==t||a.y!==e||i!==s||n!==o?(Dt(this,a.x,a.y,t,e,i,n,s,o,0,bt.PT_CORNER),this._commandX=s,this._commandY=o):this.lineTo(s,o))},e.quadraticCurveTo=function(t,e,i,n){var s=this._commandX,o=this._commandY;this.bezierCurveTo(s+2/3*(t-s),o+2/3*(e-o),i+2/3*(t-i),n+2/3*(e-n),i,n)},e.arc=function(t,e,i,n,s,o){!function(t,e,i,n,s,o,r){var a,h,l=0,c=0,u=0,p=0,f=0,_=0,d=0,m=0,g=0,y=0,C=0,b=0,v=0,T=0;if(c=o-s,r=r||!1)if(Rt(c)>=2*vt)c=2*vt;else for(;c<0;)c+=2*vt;else if(Rt(c)>=2*vt)c=2*-vt;else for(;c>0;)c-=2*vt;for(h=0|Et(1,Tt(Rt(c)/(.5*vt)+.5,5)),u=Rt(4/3*(1-St(a=c/h/2))/xt(a)),r||(u=-u),T=0;T<=h;T++)_=e+(p=St(l=s+c*(T/h)))*n,d=i+(f=xt(l))*n,m=-f*n*u,g=p*n*u,0===T?t.moveTo(_,d):t.bezierCurveTo(y+b,C+v,_-m,d-g,_,d),y=_,C=d,b=m,v=g}(this,t,e,i,n,s,o)},e.ellipse=function(t,e,i,n){It(this,t,e,i,n),this._curPath.complex=!1},e.circle=function(t,e,i){It(this,t,e,i,i),this._curPath.complex=!1},e.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,i,n,s){!function(t,e,i,n,s,o){if(o<.1)t.rect(e,i,n,s);else{var r=Tt(o,.5*Rt(n))*Lt(n),a=Tt(o,.5*Rt(s))*Lt(s);t.moveTo(e,i+a),t.lineTo(e,i+s-a),t.bezierCurveTo(e,i+s-a*(1-At),e+r*(1-At),i+s,e+r,i+s),t.lineTo(e+n-r,i+s),t.bezierCurveTo(e+n-r*(1-At),i+s,e+n,i+s-a*(1-At),e+n,i+s-a),t.lineTo(e+n,i+a),t.bezierCurveTo(e+n,i+a*(1-At),e+n-r*(1-At),i,e+n-r,i),t.lineTo(e+r,i),t.bezierCurveTo(e+r*(1-At),i,e,i+a*(1-At),e,i+a),t.close()}}(this,t,e,i,n,s),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,i=t.length;e<i;e++){var n=t[e];n&&(W.remove(n),n.removeRenderDrawInfo(this._comp))}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=W.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,i){var n=this._curPath;if(n){var s=this._points,o=n.points,r=s[this.pointsOffset++];r?(r.x=t,r.y=e):(r=new te(t,e),s.push(r)),r.flags=i,o.push(r)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new ee,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),ne=U.concat([new $("a_dist",tt.R32F)]),se=B(ne),oe=G(ne),re=t("G",(Ot=o("cc.Graphics"),Pt=f(110),kt=r(Ct),wt=r(yt),Ot(Mt=Pt(((Gt=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,e._lineWidth=Ht&&Ht(),e._strokeColor=Ft&&Ft(),e._lineJoin=zt&&zt(),e._lineCap=Wt&&Wt(),e._fillColor=Ut&&Ut(),e._miterLimit=Bt&&Bt(),e._isDrawing=!1,e._isNeedUploadData=!0,e._graphicsUseSubMeshes=[],e._instanceMaterialType=Y.ADD_COLOR,e.impl=new ie(_(e)),e}i(e,t);var n=e.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){t.prototype.onLoad.call(this),this.model=D.root.createModel(O),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},n.onDestroy=function(){this._sceneGetter=null,this.model&&(D.root.destroyModel(this.model),this.model=null);var e=this._graphicsUseSubMeshes.length;if(e>0){for(var i=0;i<e;++i)this._graphicsUseSubMeshes[i].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),t.prototype.onDestroy.call(this)},n.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},n.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},n.bezierCurveTo=function(t,e,i,n,s,o){this.impl&&this.impl.bezierCurveTo(t,e,i,n,s,o)},n.quadraticCurveTo=function(t,e,i,n){this.impl&&this.impl.quadraticCurveTo(t,e,i,n)},n.arc=function(t,e,i,n,s,o){this.impl&&this.impl.arc(t,e,i,n,s,o)},n.ellipse=function(t,e,i,n){this.impl&&this.impl.ellipse(t,e,i,n)},n.circle=function(t,e,i){this.impl&&this.impl.circle(t,e,i)},n.rect=function(t,e,i,n){this.impl&&this.impl.rect(t,e,i,n)},n.roundRect=function(t,e,i,n,s){this.impl&&this.impl.roundRect(t,e,i,n,s)},n.fillRect=function(t,e,i,n){this.rect(t,e,i,n),this.fill()},n.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},n.close=function(){this.impl&&this.impl.close()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=P.get("ui-graphics-material"),this.setSharedMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=Q.gfxDevice,i=e.createBuffer(new et(it.VERTEX|it.TRANSFER_DST,nt.DEVICE,65535*oe,oe)),n=e.createBuffer(new et(it.INDEX|it.TRANSFER_DST,nt.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),s=new k([i],ne,st.TRIANGLE_LIST,n);s.subMeshIdx=0,this.model.initSubModel(t,s,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(s)}}else a(4500,this.node.name)},n._uploadData=function(){var t=this.impl;if(t){var e=t&&t.getRenderDataList();if(!(e.length<=0)&&this.model){for(var i=this.model.subModels,n=0;n<e.length;n++){var s=e[n],o=i[n].inputAssembler;if(s.lastFilledVertex!==s.vertexStart){var r=new Float32Array(s.vData.buffer,0,s.vertexStart*se);o.vertexBuffers[0].update(r),o.vertexCount=s.vertexStart;var a=new Uint16Array(s.iData.buffer,0,s.indexStart);o.indexBuffer.update(a),o.indexCount=s.indexStart,s.lastFilledVertex=s.vertexStart,s.lastFilledIndex=s.indexStart}}this._isNeedUploadData=!1}}},n._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),i=this.model.subModels.length;if(e.length>i)for(var n=i;n<e.length;n++)this.activeSubModel(n)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},n._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},n.updateRenderer=function(){t.prototype.updateRenderer.call(this)},n.createRenderEntity=function(){return new j(X.DYNAMIC)},h(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"graphicsNativeProxy",get:function(){return this._graphicsNativeProxy}}]),e}(V)).LineJoin=Ct,Gt.LineCap=yt,l((Nt=Gt).prototype,"lineJoin",[kt],Object.getOwnPropertyDescriptor(Nt.prototype,"lineJoin"),Nt.prototype),l(Nt.prototype,"lineCap",[wt],Object.getOwnPropertyDescriptor(Nt.prototype,"lineCap"),Nt.prototype),l(Nt.prototype,"color",[c],Object.getOwnPropertyDescriptor(Nt.prototype,"color"),Nt.prototype),Ht=u(Nt.prototype,"_lineWidth",[d],(function(){return 1})),Ft=u(Nt.prototype,"_strokeColor",[d],(function(){return s.BLACK.clone()})),zt=u(Nt.prototype,"_lineJoin",[d],(function(){return Ct.MITER})),Wt=u(Nt.prototype,"_lineCap",[d],(function(){return yt.BUTT})),Ut=u(Nt.prototype,"_fillColor",[d],(function(){return s.WHITE.clone()})),Bt=u(Nt.prototype,"_miterLimit",[d],(function(){return 10})),Mt=Nt))||Mt)||Mt));p.Graphics=re;var ae,he=new m,le=new n,ce=new m,ue=[];!function(t){t[t.GRAPHICS_RECT=0]="GRAPHICS_RECT",t[t.GRAPHICS_ELLIPSE=1]="GRAPHICS_ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.SPRITE_STENCIL=3]="SPRITE_STENCIL"}(ae||(ae={})),e(ae);var pe=t("M",(jt=o("cc.Mask"),Xt=f(110),Vt=r(ae),jt(Yt=Xt((($t=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._type=qt&&qt(),e._inverted=Qt&&Qt(),e._segments=Zt&&Zt(),e._alphaThreshold=Kt&&Kt(),e._sprite=null,e._graphics=null,e._stencilStage=J.DISABLED,e}i(e,t);var o=e.prototype;return o.onLoad=function(){this._changeRenderType()},o.onEnable=function(){this._changeRenderType(),this._updateGraphics(),this._enableRender(),this.node.on(F.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(F.SIZE_CHANGED,this._nodeStateChange,this)},o.onRestore=function(){this._changeRenderType(),this._updateGraphics()},o.onDisable=function(){this._disableRender(),this.node.off(F.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(F.SIZE_CHANGED,this._nodeStateChange,this)},o.onDestroy=function(){this._removeMaskNode()},o.isHit=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,s=i.width,o=i.height,r=le;this.node.getWorldMatrix(he),m.invert(ce,he),n.transformMat4(r,t,ce);var a=e.anchorPoint;r.x+=a.x*s,r.y+=a.y*o;var h=!1;if(this.type===ae.GRAPHICS_RECT||this.type===ae.GRAPHICS_STENCIL||this.type===ae.SPRITE_STENCIL)h=r.x>=0&&r.y>=0&&r.x<=s&&r.y<=o;else if(this.type===ae.GRAPHICS_ELLIPSE){var l=s/2,c=o/2,u=r.x-.5*s,p=r.y-.5*o;h=u*u/(l*l)+p*p/(c*c)<1}return this._inverted&&(h=!h),h},o._nodeStateChange=function(){this._updateGraphics()},o._changeRenderType=function(){this._type!==ae.SPRITE_STENCIL?this._createGraphics():this._createSprite()},o._createSprite=function(){if(!this._sprite){var t=this._sprite=this.node.getComponent(ot);if(!t){var e=this.node;t=this._sprite=e.addComponent(ot)}}this._sprite.stencilStage=this.inverted?J.ENTER_LEVEL_INVERTED:J.ENTER_LEVEL,this._sprite.updateMaterial()},o._createGraphics=function(){if(!this._graphics){var t=this._graphics=this.node.getComponent(re);if(!t){var e=this.node;t=this._graphics=e.addComponent(re)}t.lineWidth=1;var i=s.WHITE.clone();i.a=0,t.fillColor=i}this._graphics.stencilStage=this.inverted?J.ENTER_LEVEL_INVERTED:J.ENTER_LEVEL},o._updateGraphics=function(){if(this._graphics&&(this._type===ae.GRAPHICS_RECT||this._type===ae.GRAPHICS_ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,n=i.width,s=i.height,o=t.anchorPoint,r=-n*o.x,a=-s*o.y;if(this._type===ae.GRAPHICS_RECT)e.rect(r,a,n,s);else if(this._type===ae.GRAPHICS_ELLIPSE){for(var h=function(t,e,i){ue.length=0;for(var n=2*Math.PI/i,s=0;s<i;++s)ue.push(new g(e.x*Math.cos(n*s)+t.x,e.y*Math.sin(n*s)+t.y,0));return ue}(new g(r+n/2,a+s/2,0),new g(n/2,s/2,0),this._segments),l=0;l<h.length;++l){var c=h[l];0===l?e.moveTo(c.x,c.y):e.lineTo(c.x,c.y)}e.close()}e.fill()}},o._enableRender=function(){this.subComp&&(this.subComp.enabled=!0)},o._disableRender=function(){this.subComp&&(this.subComp.stencilStage=J.DISABLED,this.subComp.updateMaterial(),this.node.activeInHierarchy&&(this.subComp.enabled=!1))},o._removeMaskNode=function(){this._sprite&&(this._sprite=null),this._graphics&&(this._graphics=null)},o.markForUpdateRenderData=function(t){void 0===t&&(t=!0),a(9007),this.subComp&&this.subComp.markForUpdateRenderData(t)},o.requestRenderData=function(){a(9007)},o.destroyRenderData=function(){a(9007)},o.updateRenderer=function(){a(9007),this.subComp&&this.subComp.updateRenderer()},o.fillBuffers=function(){a(9007)},o.postUpdateAssembler=function(){a(9007)},o.setNodeDirty=function(){a(9007),this.subComp&&this.subComp.setNodeDirty()},o.setTextureDirty=function(){a(9007),this.subComp&&this.subComp.setTextureDirty()},o.getMaterial=function(t){return a(9007),this.subComp?this.subComp.getSharedMaterial(t):null},o.setMaterial=function(t,e){a(9007),this.subComp&&this.subComp.setMaterial(t,e)},o.getMaterialInstance=function(t){return a(9007),this.subComp?this.subComp.getMaterialInstance(t):null},o.setMaterialInstance=function(t,e){a(9007),this.subComp&&this.subComp.setMaterialInstance(t,e)},o.getRenderMaterial=function(t){return a(9007),this.subComp?this.subComp.getRenderMaterial(t):null},h(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._type!==ae.SPRITE_STENCIL?(this._sprite&&(this.node.removeComponent(ot),this._sprite._destroyImmediate(),this._sprite=null),this._changeRenderType(),this._updateGraphics()):(this._graphics&&(this._graphics.clear(),this.node.removeComponent(re),this._graphics._destroyImmediate(),this._graphics=null),this._changeRenderType()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.subComp.stencilStage=this.inverted?J.ENTER_LEVEL_INVERTED:J.ENTER_LEVEL}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=y(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._sprite?this._sprite.spriteFrame:null},set:function(t){this._sprite?this._sprite.spriteFrame=t:C("please change type to sprite_stencil first")}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===ae.SPRITE_STENCIL&&this._sprite&&this._sprite.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"subComp",get:function(){return this._graphics||this._sprite}},{key:"customMaterial",get:function(){return a(9007),this.subComp?this.subComp.customMaterial:null},set:function(t){a(9007),this.subComp&&(this.subComp.customMaterial=t)}},{key:"color",get:function(){return a(9007),this.subComp?this.subComp.color:null},set:function(t){a(9007),this.subComp&&t&&(this.subComp.color=t)}},{key:"sharedMaterial",get:function(){return a(9007),this.subComp?this.subComp.sharedMaterial:null}},{key:"sharedMaterials",get:function(){return a(9007),this.subComp?this.subComp.sharedMaterials:null},set:function(t){a(9007),this.subComp&&t&&(this.subComp.sharedMaterials=t)}},{key:"material",get:function(){return a(9007),this.subComp?this.subComp.material:null},set:function(t){a(9007),this.subComp&&(this.subComp.material=t)}},{key:"materials",get:function(){return a(9007),this.subComp?this.subComp.materials:[null]},set:function(t){a(9007),this.subComp&&(this.subComp.materials=t)}}]),e}(z)).Type=ae,l((Jt=$t).prototype,"type",[Vt],Object.getOwnPropertyDescriptor(Jt.prototype,"type"),Jt.prototype),qt=u(Jt.prototype,"_type",[d],(function(){return ae.GRAPHICS_RECT})),Qt=u(Jt.prototype,"_inverted",[d],(function(){return!1})),Zt=u(Jt.prototype,"_segments",[d],(function(){return 64})),Kt=u(Jt.prototype,"_alphaThreshold",[d],(function(){return.1})),Yt=Jt))||Yt)||Yt));w._maskComp=pe,p.Mask=pe;var fe,_e,de,me,ge,ye,Ce,be,ve,Te,Ee,Se,xe,Re,Le,Ae,Ie,De,Oe,Pe,ke,we,Me,Ne,He,Fe,ze=/^(click)(\s)*=|(param)(\s)*=/,We=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,Ue=t("H",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var n=t.indexOf(">",e),s=-1;if(n>=0&&(s=t.lastIndexOf("<",n))<e-1&&(s=t.indexOf("<",n+1),n=t.indexOf(">",s+1)),s<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var o=t.substring(e,s),r=t.substring(s+1,n);""===r&&(o=t.substring(e,n+1)),this._processResult(o),-1===n?n=s:"/"===t.charAt(s+1)?this._stack.pop():this._addToStack(r),e=n+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),n="",s=0,o="";if(i){if(n=i[0],""===(t=t.substring(n.length).trim()))return e;switch(s=t.indexOf(" "),n[0]){case"c":e.color=s>-1?t.substring(0,s).trim():t;break;case"s":e.size=parseInt(t)}return s>-1&&(o=t.substring(s+1).trim(),e.event=this._processEventHandler(o)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("br")&&"/"===n[n.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var r="",a=-1;if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("img")&&"/"===n[n.length-1]){var h;i=We.exec(t);for(var l=!1;i;){var c=(n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length)).length;if(n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),r=t.substring(c).trim(),a="src"===n?this.getRightQuotationIndex(r):-1,h=(s=r.indexOf(" ",a+1>=r.length?-1:a+1))>-1?r.substr(0,s):r,t=r.substring(s).trim(),h.endsWith("/")&&(h=h.slice(0,-1)),"src"===n){switch(h.charCodeAt(0)){case 34:case 39:l=!0,h=h.slice(1,-1)}e.isImage=!0,e.src=h}else if("height"===n)e.imageHeight=parseInt(h);else if("width"===n)e.imageWidth=parseInt(h);else if("align"===n){switch(h.charCodeAt(0)){case 34:case 39:h=h.slice(1,-1)}e.imageAlign=h.toLowerCase()}else"offset"===n?e.imageOffset=h:"click"===n&&(e.event=this._processEventHandler(n+"="+h));e.event&&"param"===n&&(e.event[n]=h.replace(/^"|"$/g,"")),i=We.exec(t)}return l&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var u={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var p,f=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=f.exec(t);i;)n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),p=(s=(r=t.substring(n.length).trim()).indexOf(" "))>-1?r.substr(0,s):r,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=r.substring(s).trim(),"click"===n?e.event=this._processEventHandler(n+"="+p):"color"===n?u.color=p:"width"===n&&(u.width=parseInt(p)),e.event&&"param"===n&&(e.event[n]=p.replace(/^"|"$/g,"")),i=f.exec(t)}e.outline=u}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(n=i[0],t=t.substring(n.length).trim(),n[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e.getRightQuotationIndex=function(t){var e=-1,i=-1,n=t.indexOf("'"),s=t.indexOf('"'),o=s>-1&&(s<n||-1===n);return n>-1&&(n<s||-1===s)?(e=n,i=t.indexOf("'",e+1>=t.length?-1:e+1)):o&&(e=s,i=t.indexOf('"',e+1>=t.length?-1:e+1)),i},e._processEventHandler=function(t){for(var e={},i=0,n=!1,s=ze.exec(t);s;){var o=s[0],r="";if(n=!1,'"'===(t=t.substring(o.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(r=t.substring(1,i).trim(),n=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(r=t.substring(1,i).trim(),n=!0),i++;else{var a=/(\S)+/.exec(t);i=(r=a?a[0]:"").length}n&&(e[o=o.substring(0,o.length-1).trim()]=r),t=t.substring(i).trim(),s=ze.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=b(this._specialSymbolArray);!(e=i()).done;){var n=e.value,s=n[0],o=n[1];t=t.replace(s,o)}return t},t}()),Be=t("L",o("cc.LabelOutline")(fe=f(110)(fe=v(rt)(fe=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var n=e.prototype;return n.onEnable=function(){this.node.getComponent(rt).enableOutline=!0},n.onDisable=function(){this.node.getComponent(rt).enableOutline=!1},h(e,[{key:"color",get:function(){return this.node.getComponent(rt).outlineColor},set:function(t){this.node.getComponent(rt).outlineColor=t}},{key:"width",get:function(){return this.node.getComponent(rt).outlineWidth},set:function(t){this.node.getComponent(rt).outlineWidth=t}}]),e}(z))||fe)||fe)||fe);p.LabelOutline=Be;var Ge=new Ue,je="RICHTEXT_CHILD",Xe="RICHTEXT_Image_CHILD",Ve=new n,Ye=new n,Je=new T((function(t){if(!p.isValid(t.node))return!1;var e=t.node.getComponent(Be);return e&&(e.width=0),!0}),20),qe=new T((function(t){return p.isValid(t.node)}),10);function Qe(t){return{node:new M(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function Ze(t,e){var i;t===je?i=Je._get():t===Xe&&(i=qe._get());var n=(i=i||Qe(t)).node;return n||(n=new M(t)),n.hideFlags|=E.Flags.DontSave|E.Flags.HideInHierarchy,n.active=!0,t===Xe?(i.comp=n.getComponent(ot)||n.addComponent(ot),i.comp.spriteFrame=e,i.comp.type=ot.Type.SLICED,i.comp.sizeMode=ot.SizeMode.CUSTOM):(i.comp=n.getComponent(rt)||n.addComponent(rt),i.comp.string=e,i.comp.horizontalAlign=ft.LEFT,i.comp.verticalAlign=dt.TOP,i.comp.underlineHeight=2),n.setPosition(0,0,0),n._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=n,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var Ke,$e=t("R",(_e=o("cc.RichText"),de=f(110),me=r(ft),ge=r(dt),ye=r(s),Ce=r(_t),be=r(mt),ve=r(gt),_e(Te=de(((Fe=function(t){function e(){var e;return(e=t.call(this)||this)._lineHeight=Se&&Se(),e._string=xe&&xe(),e._horizontalAlign=Re&&Re(),e._verticalAlign=Le&&Le(),e._fontSize=Ae&&Ae(),e._fontColor=Ie&&Ie(),e._maxWidth=De&&De(),e._fontFamily=Oe&&Oe(),e._font=Pe&&Pe(),e._isSystemFontUsed=ke&&ke(),e._userDefinedFont=we&&we(),e._cacheMode=Me&&Me(),e._imageAtlas=Ne&&Ne(),e._handleTouchEvent=He&&He(),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._labelChildrenNum=0,e._updateRichTextStatus=e._updateRichText,e}i(e,t);var o=e.prototype;return o.onLoad=function(){this.node.on(F.LAYER_CHANGED,this._applyLayer,this),this.node.on(F.ANCHOR_CHANGED,this._updateRichTextPosition,this)},o.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},o.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},o.onRestore=function(){},o.onDestroy=function(){for(var t,e=b(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),i.type===je?Je.put(i):i.type===Xe&&qe.put(i)}this.node.off(F.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(F.LAYER_CHANGED,this._applyLayer,this)},o._addEventListeners=function(){this.node.on(F.TOUCH_END,this._onTouchEnded,this)},o._removeEventListeners=function(){this.node.off(F.TOUCH_END,this._onTouchEnded,this)},o._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},o._createFontLabel=function(t){return Ze(je,t)},o._createImage=function(t){return Ze(Xe,t)},o._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},o.splitLongStringApproximatelyIn2048=function(t,e){var i=[];if(t.length*this.fontSize<=1638.4)return i.push(t),i;if(this._calculateSize(Ve,e,t),Ve.x<2048)i.push(t);else for(var n=t.split("\n"),s=0;s<n.length;s++)if(this._calculateSize(Ve,e,n[s]),Ve.x<2048)i.push(n[s]);else{var o=this.splitLongStringOver2048(n[s],e);i.push.apply(i,o)}return i},o.splitLongStringOver2048=function(t,e){var i=[],n=t,s=0,o=n.length/2,r=n.substring(s,o),a=n.substring(o),h=this._calculateSize(Ve,e,r),l=this._calculateSize(Ye,e,a),c=this._maxWidth;0===this._maxWidth&&(c=2047.9);for(var u=1*c;h.x>u;){if((o/=2)<1){o*=2;break}r=r.substring(s,o),a=n.substring(o),this._calculateSize(h,e,r)}for(var p=1e3,f=1;p&&s<t.length;){for(;p&&h.x<u;){var _=at(a);_&&_.length>0&&(f=_[0].length),o+=f,r=n.substring(s,o),a=n.substring(o),this._calculateSize(h,e,r),p--}for(;p&&r.length>=2&&h.x>u;)o-=f,r=n.substring(s,o),this._calculateSize(h,e,r),f=1,p--;if(r.length>=2){var d=ht(r);d&&d.length>0&&r!==d[0]&&(o-=d[0].length,r=n.substring(s,o))}if(i.push(r),s=o,o+=r.length,r=n.substring(s,o),a=n.substring(o),this._calculateSize(l,e,a),this._calculateSize(h,e,r),p--,l.x<2048&&h.x<u){i.push(r),s=t.length,o=t.length,r=a,""!==a&&i.push(r);break}}return i},o._measureText=function(t,e){var i=this,n=function(e){return i._calculateSize(Ve,t,e).x};return e?n(e):n},o._calculateSize=function(t,e,i){var s;0===this._labelSegmentsCache.length?(s=this._createFontLabel(i),this._labelSegmentsCache.push(s)):(s=this._labelSegmentsCache[0]).node.getComponent(rt).string=i,s.styleIndex=e,this._applyTextAttribute(s);var o=s.node._uiProps.uiTransformComp.contentSize;return n.set(t,o.x,o.y),t},o._onTouchEnded=function(t){for(var e,i=this,n=this.node.getComponents(z),s=function(){var s=e.value,o=s.clickHandler,r=s.clickParam;o&&i._containsTouchLocation(s,t.touch.getUILocation())&&(n.forEach((function(e){var i=e[o];e.enabledInHierarchy&&i&&i.call(e,t,r)})),t.propagationStopped=!0)},o=b(this._segments);!(e=o()).done;)s()},o._containsTouchLocation=function(t,e){var i=t.node.getComponent(q);return!!i&&i.getBoundingBoxToWorld().contains(e)},o._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if(i.name===je||i.name===Xe){i.parent=null;var n=Qe(i.name);n.node=i,i.name===je?(n.comp=i.getComponent(rt),Je.put(n)):(n.comp=i.getComponent(ot),qe.put(n)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},o._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];i.name!==je&&i.name!==Xe||(i.active=t)}},o._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var n=(i=this._labelSegmentsCache.pop()).node.getComponent(rt);n&&(n.string=t)}var s=i.comp;return s.verticalAlign!==this._verticalAlign&&(s.verticalAlign=this._verticalAlign),i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this.node.insertChild(i.node,this._labelChildrenNum++),this._applyTextAttribute(i),this._segments.push(i),i},o._updateRichTextWithMaxWidth=function(t,e,i){var n=e;if(this._lineOffsetX>0&&n+this._lineOffsetX>this._maxWidth)for(var s=0;this._lineOffsetX<=this._maxWidth;){var o=this._getFirstWordLen(t,s,t.length),r=t.substr(s,o),a=this._measureText(i,r);if(!(this._lineOffsetX+a<=this._maxWidth)){if(s>0){var h=t.substr(0,s);this._addLabelSegment(h,i),t=t.substr(s,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,s+=o}if(n>this._maxWidth)for(var l=lt(t,n,this._maxWidth,this._measureText(i)),c=0;c<l.length;++c){var u=l[c],p=this._addLabelSegment(u,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=p.width,l.length>1&&c<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},o._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},o._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},o._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;var s=i.style,o=n.style;if(s){if(o){if(!!o.outline!=!!s.outline)return!0;if(s.size!==o.size||s.italic!==o.italic||s.isImage!==o.isImage)return!0;if(s.src!==o.src||s.imageAlign!==o.imageAlign||s.imageHeight!==o.imageHeight||s.imageWidth!==o.imageWidth||s.imageOffset!==o.imageOffset)return!0}else if(s.size||s.italic||s.isImage||s.outline)return!0}else if(o&&(o.size||o.italic||o.isImage||o.outline))return!0}return!1},o._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,n=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(n){var s=this._createImage(n);switch(s.comp,e.imageAlign){case"top":s.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":s.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:s.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}e.imageOffset&&(s.imageOffset=e.imageOffset),s.node.layer=this.node.layer,this.node.insertChild(s.node,this._labelChildrenNum++),this._segments.push(s);var o=n.rect.clone(),r=1,h=o.width,l=o.height,c=e.imageWidth||0,u=e.imageHeight||0;u>0?(h*=r=u/l,l*=r):(h*=r=this._lineHeight/l,l*=r),c>0&&(h=c),this._maxWidth>0?(this._lineOffsetX+h>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=h):(this._lineOffsetX+=h,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),s.node._uiProps.uiTransformComp.setContentSize(h,l),s.lineCount=this._lineCount,s.clickHandler="",s.clickParam="";var p=e.event;p&&(s.clickHandler=p.click,s.clickParam=p.param)}else a(4400)}},o._updateTextDefaultColor=function(){for(var t=0;t<this._segments.length;++t){var e,i,n=this._segments[t],s=n.node.getComponent(rt);s&&(null!==(e=this._textArray[n.styleIndex])&&void 0!==e&&null!==(i=e.style)&&void 0!==i&&i.color||(s.color=this._fontColor))}},o._updateRichText=function(){if(this.enabledInHierarchy){var t=Ge.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var s=this._textArray[n],o=s.text;if(void 0!==o){if(""===o){if(s.style&&s.style.isNewLine){this._updateLineInfo();continue}if(s.style&&s.style.isImage&&this._imageAtlas){this._addRichTextImageElement(s);continue}}for(var r=(o=this.splitLongStringApproximatelyIn2048(o,n).join("\n")).split("\n"),a=0;a<r.length;++a){var h=r[a];if(""!==h)if(i=!1,this._maxWidth>0){var l=this._measureText(n,h);this._updateRichTextWithMaxWidth(h,l,n),r.length>1&&a<r.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(h,n),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),r.length>1&&a<r.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(o)&&a===r.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+ct)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},o._getFirstWordLen=function(t,e,i){var n=t.charAt(e);if(ut(n)||pt(n))return 1;for(var s=1,o=e+1;o<i&&(n=t.charAt(o),!pt(n)&&!ut(n));++o)s++;return s},o._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,n=this.node._uiProps.uiTransformComp,s=n.anchorX,o=n.anchorY,r=0;r<this._segments.length;++r){var a=this._segments[r],h=a.lineCount;h>e&&(t=0,e=h);var l=this._labelWidth*(.5*this._horizontalAlign-s);switch(this._horizontalAlign){case ft.LEFT:break;case ft.CENTER:l-=this._linesWidth[h-1]/2;break;case ft.RIGHT:l-=this._linesWidth[h-1]}var c=a.node.position;if(a.node.setPosition(t+l,this._lineHeight*(i-h)-this._labelHeight*o,c.z),h===e&&(t+=a.node._uiProps.uiTransformComp.width),a.node.getComponent(ot)){var u=a.node.position.clone(),p=this._lineHeight,f=this._lineHeight*(1+ct);switch(a.node._uiProps.uiTransformComp.anchorY){case 1:u.y+=p+(f-p)/2;break;case.5:u.y+=f/2;break;default:u.y+=(f-p)/2}if(a.imageOffset){var _=a.imageOffset.split(",");if(1===_.length&&_[0]){var d=parseFloat(_[0]);Number.isInteger(d)&&(u.y+=d)}else if(2===_.length){var m=parseFloat(_[0]),g=parseFloat(_[1]);Number.isInteger(m)&&(u.x+=m),Number.isInteger(g)&&(u.y+=g)}}a.node.position=u}var y=a.node.getComponent(Be);if(y){var C=a.node.position.clone();C.y-=y.width,a.node.position=C}}},o._convertLiteralColorValue=function(t){var e=t.toUpperCase();return s[e]?s[e]:(new s).fromHEX(t)},o._applyTextAttribute=function(t){var e=t.node.getComponent(rt);if(e){this._resetLabelState(e);var i,n=t.styleIndex;if(this._textArray[n]&&(i=this._textArray[n].style),i){if(i.color?e.color=this._convertLiteralColorValue(i.color):e.color=this._fontColor,e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var s=t.node.getComponent(Be);s||(s=t.node.addComponent(Be)),s.color=this._convertLiteralColorValue(i.outline.color),s.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var o=i.event;o&&(t.clickHandler=o.click||"",t.clickParam=o.param||"")}e.cacheMode=this._cacheMode,this._font instanceof _t&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0)}},o._applyLayer=function(){for(var t,e=b(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},o._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=this._fontColor,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},h(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontColor",get:function(){return this._fontColor},set:function(t){this._fontColor!==t&&(this._fontColor=t,this._updateTextDefaultColor())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(z)).HorizontalAlign=ft,Fe.VerticalAlign=dt,l((Ee=Fe).prototype,"horizontalAlign",[me],Object.getOwnPropertyDescriptor(Ee.prototype,"horizontalAlign"),Ee.prototype),l(Ee.prototype,"verticalAlign",[ge],Object.getOwnPropertyDescriptor(Ee.prototype,"verticalAlign"),Ee.prototype),l(Ee.prototype,"fontColor",[ye],Object.getOwnPropertyDescriptor(Ee.prototype,"fontColor"),Ee.prototype),l(Ee.prototype,"font",[Ce],Object.getOwnPropertyDescriptor(Ee.prototype,"font"),Ee.prototype),l(Ee.prototype,"cacheMode",[be],Object.getOwnPropertyDescriptor(Ee.prototype,"cacheMode"),Ee.prototype),l(Ee.prototype,"imageAtlas",[ve],Object.getOwnPropertyDescriptor(Ee.prototype,"imageAtlas"),Ee.prototype),Se=u(Ee.prototype,"_lineHeight",[d],(function(){return 40})),xe=u(Ee.prototype,"_string",[d],(function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"})),Re=u(Ee.prototype,"_horizontalAlign",[d],(function(){return ft.LEFT})),Le=u(Ee.prototype,"_verticalAlign",[d],(function(){return dt.TOP})),Ae=u(Ee.prototype,"_fontSize",[d],(function(){return 40})),Ie=u(Ee.prototype,"_fontColor",[d],(function(){return s.WHITE.clone()})),De=u(Ee.prototype,"_maxWidth",[d],(function(){return 0})),Oe=u(Ee.prototype,"_fontFamily",[d],(function(){return"Arial"})),Pe=u(Ee.prototype,"_font",[d],(function(){return null})),ke=u(Ee.prototype,"_isSystemFontUsed",[d],(function(){return!0})),we=u(Ee.prototype,"_userDefinedFont",[d],(function(){return null})),Me=u(Ee.prototype,"_cacheMode",[d],(function(){return mt.NONE})),Ne=u(Ee.prototype,"_imageAtlas",[d],(function(){return null})),He=u(Ee.prototype,"_handleTouchEvent",[d],(function(){return!0})),Te=Ee))||Te)||Te));p.RichText=$e;var ti=t("U",o("cc.UIMeshRenderer")(Ke=f(110)(Ke=function(t){function e(){var e;return(e=t.call(this)||this)._modelComponent=null,e._dirtyVersion=-1,e._internalId=-1,e.stencilStage=J.DISABLED,e._renderData=null,e._renderEntity=new j(X.DYNAMIC),e}i(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){N.addRenderer(this),this.markForUpdateRenderData()},n.onDisable=function(){N.removeRenderer(this),this.renderEntity.enabled=this._canRender()},n.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent?this.renderEntity.setNode(this.node):S("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},n.onDestroy=function(){this.renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent&&(this._modelComponent._sceneGetter=null)},n._render=function(t){if(this._modelComponent){var e=this._modelComponent._collectModels();this._modelComponent._detachFromScene();for(var i=0;i<e.length;i++)e[i].enabled&&t.commitModel(this,e[i],this._modelComponent.material);return!0}return!1},n.fillBuffers=function(t){this.enabled&&this._render(t)},n.updateRenderer=function(){},n._uploadRenderData=function(){},n.postUpdateAssembler=function(){},n.update=function(){this._fitUIRenderQueue()},n._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var n=i.passes,s=n.length,o=0;o<s;o++)n[o].setPriority(Z.MAX-11),i.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},o)}},n.markForUpdateRenderData=function(){N.markDirtyRenderer(this)},n.setNodeDirty=function(){},n.setTextureDirty=function(){},n._canRender=function(){return this.enabled&&null!==this._modelComponent},h(e,[{key:"modelComponent",get:function(){return this._modelComponent}},{key:"renderEntity",get:function(){return this._renderEntity}},{key:"renderData",get:function(){return this._renderData}}]),e}(z))||Ke)||Ke);p.UIMeshRenderer=ti;var ei,ii,ni,si,oi,ri,ai=K.Enum.NONE|K.Enum.UI_3D,hi=t("D",function(){function t(){this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=ai,this._inputAssembler=null,this._descriptorSet=null}var e=t.prototype;return e.destroy=function(){this._passes=[]},e.clear=function(){this._inputAssembler=null,this._descriptorSet=null,this.texture=null,this.sampler=null,this.textureHash=0,this.samplerHash=0,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=ai},e.fillPasses=function(t,e,i,n){if(t){var s=t.passes;if(!s)return;this._shaders.length=s.length;for(var o=0;o<s.length;o++){this._passes[o]||(this._passes[o]=new H(p.director.root));var r=s[o],a=this._passes[o];r.update(),e||(e=r.depthStencilState,i=0),a._initPassFromTarget(r,e,i),this._shaders[o]=a.getShaderVariant(n)}}},h(t,[{key:"inputAssembler",get:function(){return this._inputAssembler},set:function(t){this._inputAssembler=t}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(t){this._descriptorSet=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t}()),li=t("a",o("cc.UIStaticBatch")(ei=f(110)((ii=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._init=!1,e._bufferAccessor=null,e._dirty=!0,e._uiDrawBatchList=[],e}i(e,t);var n=e.prototype;return n.postUpdateAssembler=function(){},n.markAsDirty=function(){},n._requireDrawBatch=function(){var t=new hi;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},n._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},n._getBatcher=function(){return D.root&&D.root.batcher2D?D.root.batcher2D:(a(9301),null)},h(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(V),l(ii.prototype,"color",[c],Object.getOwnPropertyDescriptor(ii.prototype,"color"),ii.prototype),ei=ii))||ei)||ei),ci=t("b",o("cc.LabelShadow")(ni=f(110)(ni=v(rt)(ni=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var n=e.prototype;return n.onEnable=function(){this.node.getComponent(rt).enableShadow=!0},n.onDisable=function(){this.node.getComponent(rt).enableShadow=!1},h(e,[{key:"color",get:function(){return this.node.getComponent(rt).shadowColor},set:function(t){this.node.getComponent(rt).shadowColor=t}},{key:"offset",get:function(){return this.node.getComponent(rt).shadowOffset},set:function(t){this.node.getComponent(rt).shadowOffset=t}},{key:"blur",get:function(){return this.node.getComponent(rt).shadowBlur},set:function(t){this.node.getComponent(rt).shadowBlur=t}}]),e}(z))||ni)||ni)||ni),ui=t("c",o("cc.UIOpacity")(si=f(110)(si=x((oi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._setByParent=!1,e._opacity=ri&&ri(),e}i(e,t);var n=e.prototype;return n.setEntityLocalOpacityDirtyRecursively=function(){},e.setEntityLocalOpacityDirtyRecursively=function(t,i,n,s){if(t.isValid){var o=t._uiProps.uiComp,r=t.getComponent(e),a=n;o&&o.color?(o.renderEntity.colorDirty=i,r?(o.renderEntity.localOpacity=a*r.opacity/255,r._setByParent=s):o.renderEntity.localOpacity=a,o.node._uiProps.localOpacity=o.renderEntity.localOpacity,a=1):r&&(a=a*r.opacity/255,r._setByParent=s);for(var h=0;h<t.children.length;h++)e.setEntityLocalOpacityDirtyRecursively(t.children[h],i||a<1,a,!0)}},n.onEnable=function(){this._setByParent||(this.node._uiProps.localOpacity=this._opacity/255,this.setEntityLocalOpacityDirtyRecursively(!0))},n.onDisable=function(){this._setByParent||(this.node._uiProps.localOpacity=1,this.setEntityLocalOpacityDirtyRecursively(!0))},h(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=R(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255,this.setEntityLocalOpacityDirtyRecursively(!0))}}]),e}(z),ri=u(oi.prototype,"_opacity",[d],(function(){return 255})),si=oi))||si)||si)||si);p.MaskComponent=pe,L(pe,"cc.MaskComponent"),p.LabelComponent=rt,L(rt,"cc.LabelComponent"),p.LabelOutlineComponent=Be,L(Be,"cc.LabelOutlineComponent"),p.RichTextComponent=$e,L($e,"cc.RichTextComponent"),p.SpriteComponent=ot,L(ot,"cc.SpriteComponent"),p.UIModelComponent=ti,L(ti,"cc.UIModelComponent"),p.GraphicsComponent=re,L(re,"cc.GraphicsComponent"),L(li,"cc.UIStaticBatchComponent"),L(ui,"cc.UIOpacityComponent"),A(pe.prototype,"Mask",[{name:"graphics",newName:"subComp",target:pe.prototype,targetName:"Mask"}]),A(ae,"MaskType",[{name:"RECT",newName:"GRAPHICS_RECT",target:ae,targetName:"MaskType"},{name:"ELLIPSE",newName:"GRAPHICS_ELLIPSE",target:ae,targetName:"MaskType"},{name:"IMAGE_STENCIL",newName:"SPRITE_STENCIL",target:ae,targetName:"MaskType"}]),I(Be.prototype,"LabelOutline",[{name:"width",suggest:"Please use Label.outlineWidth instead."},{name:"color",suggest:"Please use Label.outlineColor instead."}]),I(ci.prototype,"LabelShadow",[{name:"color",suggest:"Please use Label.shadowColor instead."},{name:"offset",suggest:"Please use Label.shadowOffset instead."},{name:"blur",suggest:"Please use Label.shadowBlur instead."}])}}}));
