System.register(["./index-d48cc0ba.js","./sprite-renderer-a2b4676c.js","./director-39a00fed.js","./pipeline-state-manager-1c54311a.js","./node-event-2a6499e4.js","./deprecated-653e59b0.js","./buffer-barrier-a01f2732.js","./renderer-3b929285.js","./camera-component-f1519417.js","./create-mesh-746ae60b.js","./mesh-7036037d.js","./deprecated-f3d0b236.js","./model-renderer-2d8221ee.js","./touch-029b049b.js"],(function(t){"use strict";var e,i,n,s,r,o,h,a,c,l,p,m,u,_,d,f,v,w,b;return{setters:[function(t){e=t.bC,i=t.l,n=t.bG,s=t.u,r=t.bF,o=t.cM,h=t.e,a=t.w,c=t.ch,l=t.bE,p=t.bX,m=t.bI,u=t.cK,_=t.bj},function(t){d=t.c},function(t){f=t.aU},function(){},function(t){v=t.E,w=t.C},function(t){b=t.g},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var y;!function(t){t.NONE="none",t.LOADING="loading",t.LOADED="loaded",t.ERROR="error"}(y||(y={}));var E=function(){function t(t){this._componentEventList=new Map,this._state=y.NONE,this._wrapper=void 0,this._webview=null,this._loaded=!1,this._forceUpdate=!1,this._component=null,this._uiTrans=null,this._node=null,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(d),this.reset(),this.createWebView()}var i=t.prototype;return i.reset=function(){this._wrapper=null,this._webview=null,this._loaded=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._state=y.NONE,this._forceUpdate=!1},i.dispatchEvent=function(t){var e=this._componentEventList.get(t);if(e){this._state=t;for(var i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];e.call(this,n)}},i.destroy=function(){this.removeWebView(),this._wrapper=null,this._webview=null,this._loaded=!1,this._component=null,this._uiTrans=null,this._forceUpdate=!1,this._componentEventList.clear()},e(t,[{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"webview",get:function(){return this._webview}},{key:"state",get:function(){return this._state}},{key:"UICamera",get:function(){return f.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();i.internal.WebViewImpl=E;var g,L,O,R,D,I,x,j,k=n.document,A=s(),N=function(t){function e(e){return t.call(this,e)||this}r(e,t);var i=e.prototype;return i._bindDomEvent=function(){var t=this;this.webview&&this.webview.addEventListener("load",(function(e){t._forceUpdate=!0,t.dispatchEvent(y.LOADED);var i=e.target,n=i.contentDocument&&i.contentDocument.body;n&&n.innerHTML.includes("404")&&t.dispatchEvent(y.ERROR,n.innerHTML)}))},i.loadURL=function(t){this.webview&&(this.webview.src=t,this.dispatchEvent(y.LOADING))},i.createWebView=function(){var t=k.createElement("div");this._wrapper=t,t.id="webview-wrapper",t.style["-webkit-overflow"]="auto",t.style["-webkit-overflow-scrolling"]="touch",t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.style.transformOrigin="0px 100% 0px",t.style["-webkit-transform-origin"]="0px 100% 0px",b.container.appendChild(t);var e=k.createElement("iframe");this._webview=e,e.id="webview",e.style.border="none",e.style.width="100%",e.style.height="100%",t.appendChild(e),this._bindDomEvent()},i.removeWebView=function(){var t=this._wrapper;o(b.container,t)&&b.container.removeChild(t),this.reset()},i.enable=function(){this._wrapper&&(this._wrapper.style.visibility="visible")},i.disable=function(){this._wrapper&&(this._wrapper.style.visibility="hidden")},i.evaluateJS=function(t){if(this.webview){var e=this.webview.contentWindow;if(e)try{e.eval(t)}catch(t){this.dispatchEvent(y.ERROR,t),h(t)}}},i.setOnJSCallback=function(){a("The platform does not support")},i.setJavascriptInterfaceScheme=function(){a("The platform does not support")},i.syncMatrix=function(){if(this._wrapper&&this._uiTrans&&this._component&&"hidden"!==this._wrapper.style.visibility){var t=this.UICamera;if(t){this._component.node.getWorldMatrix(A),t.update(!0),t.worldMatrixToScreen(A,A,b.canvas.width,b.canvas.height);var e=this._uiTrans.contentSize,i=e.width,n=e.height;if(this._forceUpdate||this._m00!==A.m00||this._m01!==A.m01||this._m04!==A.m04||this._m05!==A.m05||this._m12!==A.m12||this._m13!==A.m13||this._w!==i||this._h!==n){this._m00=A.m00,this._m01=A.m01,this._m04=A.m04,this._m05=A.m05,this._m12=A.m12,this._m13=A.m13,this._w=i,this._h=n;var s=c.devicePixelRatio,r=1/s,o=1/s,h=b.container,a=A.m00*r,l=A.m01,p=A.m04,m=A.m05*o;this._wrapper.style.width=i+"px",this._wrapper.style.height=n+"px";var u=this._w*r,_=this._h*o,d=u*A.m00*this._uiTrans.anchorX,f=_*A.m05*this._uiTrans.anchorY,v=h&&h.style.paddingLeft?parseInt(h.style.paddingLeft):0,w=h&&h.style.paddingBottom?parseInt(h.style.paddingBottom):0,y="matrix("+a+","+-l+","+-p+","+m+","+(A.m12*r-d+v)+","+-(A.m13*o-f+w)+")";this._wrapper.style.transform=y,this._wrapper.style["-webkit-transform"]=y,this._forceUpdate=!1}}}},e}(E),T=function(){function t(){}return t.getImpl=function(t){return new N(t)},t}();i.internal.WebViewImplManager=T;var C=t("WebView",(g=l("cc.WebView"),L=u(d),O=p([v]),g(R=L(((j=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._url=I&&I(),e._impl=null,e.webviewEvents=x&&x(),e}r(i,t);var n=i.prototype;return n.setJavascriptInterfaceScheme=function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},n.setOnJSCallback=function(t){this._impl&&this._impl.setOnJSCallback(t)},n.evaluateJS=function(t){this._impl&&this._impl.evaluateJS(t)},n.__preload=function(){this._impl=T.getImpl(this),this._impl.componentEventList.set(y.LOADING,this.onLoading.bind(this)),this._impl.componentEventList.set(y.LOADED,this.onLoaded.bind(this)),this._impl.componentEventList.set(y.ERROR,this.onError.bind(this)),this._impl.loadURL(this._url)},n.onLoading=function(){v.emitEvents(this.webviewEvents,this,y.LOADING),this.node.emit(y.LOADING,this)},n.onLoaded=function(){v.emitEvents(this.webviewEvents,this,y.LOADED),this.node.emit(y.LOADED,this)},n.onError=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];v.emitEvents(this.webviewEvents,this,y.ERROR,e),this.node.emit(y.ERROR,this,e)},n.onEnable=function(){this._impl&&this._impl.enable()},n.onDisable=function(){this._impl&&this._impl.disable()},n.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},n.update=function(){this._impl&&this._impl.syncMatrix()},e(i,[{key:"url",get:function(){return this._url},set:function(t){this._url=t,this._impl&&this._impl.loadURL(t)}},{key:"nativeWebView",get:function(){return this._impl&&this._impl.webview||null}},{key:"state",get:function(){return this._impl?this._impl.state:y.NONE}}]),i}(w)).EventType=y,I=m((D=j).prototype,"_url",[_],(function(){return"https://cocos.com"})),x=m(D.prototype,"webviewEvents",[_,O],(function(){return[]})),R=D))||R)||R));i.internal.WebView=C}}}));
